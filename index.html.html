<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Devotial - Chant Your Mantra</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://css.gg/css?=|check|loader|award" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Inter:wght@400;500;600;700&family=Lora:ital,wght@0,400..700;1,400..700&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
<style>
/* --- General Body & Scrollbar Removal --- */
body {
font-family: 'Inter', sans-serif;
-webkit-tap-highlight-color: transparent;
}
/* Hide scrollbars for the entire page and specific elements */
html, body, #message-list {
-ms-overflow-style: none; /* IE and Edge */
scrollbar-width: none; /* Firefox */
}
html::-webkit-scrollbar,
body::-webkit-scrollbar,
#message-list::-webkit-scrollbar {
display: none; /* for Chrome, Safari, and Opera */
}
.font-lora { font-family: 'Lora', serif; }
.font-playfair { font-family: 'Playfair Display', serif; }
.font-dancing-script { font-family: 'Dancing Script', cursive; }

#app-container {
position: relative; /* This is the fix */
z-index: 1; /* This ensures it stays behind the nav bar */
}

.counter-background {
background-color: #FFF5E1; /* Light Orange Theme */
background-image:
url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23FFDDC1' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
}
.dashboard-background {
background-image: url('https://i.postimg.cc/QCwwdM9K/images-2.jpg');
background-size: cover;
background-position: center;
background-attachment: fixed;
}

.mandir-background {
background-color: #000;
background-size: cover;
background-position: center;
background-attachment: fixed;
}

.diya-table-background {
/* background-image: url('https://i.postimg.cc/Qx0xsdJy/close-up-of-wooden-plank-326311.webp'); */
background-size: cover;
background-position: center;
border-top: 4px solid #4a2c2a; /* Dark brown border for a table edge effect */
box-shadow: inset 0 5px 15px rgba(0,0,0,0.5); /* Inner shadow for depth */
}

.japa-btn-anim { transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.1s cubic-bezier(0.4, 0, 0.2, 1); }
.japa-btn-anim.clicked { transform: scale(0.96); box-shadow: 0 0 30px rgba(251, 191, 36, 0.5), inset 0 4px 8px rgba(0,0,0,0.1); }

.stat-card-light {
background-color: rgba(255, 255, 255, 0.8);
backdrop-filter: blur(12px);
border: 1px solid rgba(255, 255, 255, 0.3);
}

.glass-card {
background-color: rgba(255, 255, 255, 0.2);
backdrop-filter: blur(20px);
border: 1px solid rgba(255, 255, 255, 0.3);
box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
}

.stat-box {
background-color: rgba(255, 255, 255, 0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
}

.modal-backdrop { background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px); }
.hidden { display: none; }

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.view-transition { animation: fadeIn 0.3s ease-out forwards; }

@keyframes pageFadeIn { from { opacity: 0; } to { opacity: 1; } }
.page-entry-animation { animation: pageFadeIn 0.8s ease-in-out forwards; }

@keyframes breathe {
0%, 100% {
transform: scale(1);
box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3); /* Softer, constant red glow */
}
50% {
transform: scale(1.08); /* Gentle 'breathing' expansion */
box-shadow: 0 8px 25px rgba(249, 115, 22, 0.4); /* Warmer, larger orange glow */
}
}
.pulse-anim {
animation: breathe 4s infinite ease-in-out;
}

.quote-text {
text-shadow: 0 0 12px rgba(255, 255, 255, 0.5), 1px 1px 6px rgba(0,0,0,0.7);
transition: opacity 1s ease-in-out;
}

@keyframes pop { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
.counter-pop { animation: pop 0.2s ease-out; }

.karma-option-btn {
transition: all 0.2s ease-in-out;
}
.karma-option-btn.active-yes {
background: linear-gradient(145deg, #16a34a, #22c55e);
color: white;
border-color: #4ade80;
box-shadow: 0 0 15px rgba(74, 222, 128, 0.5);
transform: translateY(-2px);
}
.karma-option-btn.active-no {
background: linear-gradient(145deg, #dc2626, #ef4444);
color: white;
border-color: #f87171;
box-shadow: 0 0 15px rgba(248, 113, 113, 0.5);
transform: translateY(-2px);
}

.karma-info-btn {
transition: transform 0.2s;
}
.karma-info-btn:hover {
transform: scale(1.2);
}

.modal-backdrop {
background-color: rgba(0, 0, 0, 0.6);
backdrop-filter: blur(5px);
}

@keyframes scaleIn {
from { opacity: 0; transform: scale(0.9); }
to { opacity: 1; transform: scale(1); }
}
.scale-in-anim {
animation: scaleIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
}

@keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
.fade-in-up { opacity: 0; animation: fadeInUp 0.5s ease-out forwards; }


@keyframes scaleIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
.scale-in-anim { opacity: 0; animation: scaleIn 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.1s forwards; }

.clearfix::after { content: ""; clear: both; display: table; }
.achievement-locked { @apply opacity-40 filter grayscale; }

@keyframes toast-center-in { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
@keyframes toast-center-out { to { opacity: 0; transform: scale(0.9); } }
.toast-enter-center { animation: toast-center-in 0.4s cubic-bezier(0.21, 1.02, 0.73, 1) forwards; }
.toast-exit-center { animation: toast-center-out 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }

.blog-content { color: white; }
.blog-content p { line-height: 1.75; margin-bottom: 1rem; }
.blog-content ul { list-style-position: inside; list-style-type: disc; margin-bottom: 1rem; padding-left: 1rem; }
.blog-content li { margin-bottom: 0.5rem; }
.blog-content a { color: #fed7aa; font-weight: 600; }
.blog-content a:hover { text-decoration: underline; }
.blog-content h1, .blog-content h2, .blog-content strong { color: white; }

.progress-bar-bg { background-color: rgba(0,0,0,0.1); }
.progress-bar-fill {
background-color: #f97316; /* orange-500 */
transition: width 0.5s ease-out;
}

.confetti-background {
background-image:
radial-gradient(circle at 15% 50%, #fde68a, transparent 20%),
radial-gradient(circle at 85% 30%, #a7f3d0, transparent 20%),
radial-gradient(circle at 70% 80%, #fecaca, transparent 20%),
radial-gradient(circle at 30% 20%, #bfdbfe, transparent 20%);
}

.music-sidebar {
transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
transform: translateX(100%);
}
.music-sidebar.is-open {
transform: translateX(0);
}

.dashboard-dropdown {
transform: translateY(10px);
opacity: 0;
pointer-events: none;
transition: opacity 0.3s ease-out, transform 0.3s ease-out;
will-change: transform, opacity; /* Optimization for smoother animation */
}

.dashboard-dropdown.is-open {
transform: translateY(0);
opacity: 1;
pointer-events: auto;
}

/* Custom class to crop the flame GIF from the bottom */
.flame-cropped {
object-fit: cover;
object-position: top;
height: 99%; /* Simulates cropping 1% from the bottom */
}

.prayer-modal-backdrop {
background-color: rgba(0, 0, 0, 0.7);
backdrop-filter: blur(10px);
transition: opacity 2s ease-out;
z-index: 50;
}

.prayer-modal-content {
background-color: rgba(255, 255, 255, 0.1);
backdrop-filter: blur(20px);
border: 1px solid rgba(255, 255, 255, 0.3);
box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
z-index: 51;
transform: scale(0.95);
transition: all 2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}
.prayer-modal-content.is-visible {
transform: scale(1);
}

.guiding-box {
background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0));
backdrop-filter: blur(15px);
border: 1px solid rgba(255, 255, 255, 0.3);
border-radius: 12px;
padding: 1.5rem;
opacity: 0;
transition: opacity 2s ease-in-out;
box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
}
.guiding-box.is-visible {
opacity: 1;
}

/* Customer Support Chatbot Styles */
.chatbot-modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background-color: rgba(0, 0, 0, 0.7);
backdrop-filter: blur(10px);
z-index: 1000;
display: flex;
align-items: center;
justify-content: center;
padding: 1rem;
opacity: 0;
visibility: hidden;
transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
}

.chatbot-modal.is-open {
opacity: 1;
visibility: visible;
}

.chatbot-container {
background: rgba(255, 255, 255, 0.2);
backdrop-filter: blur(20px);
-webkit-backdrop-filter: blur(20px);
border: 1px solid rgba(255, 255, 255, 0.3);
box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
border-radius: 1.5rem;
width: 100%;
max-width: 400px;
height: 80vh;
max-height: 600px;
display: flex;
flex-direction: column;
overflow: hidden;
transform: scale(0.9);
transition: transform 0.3s ease-in-out;
}

.chatbot-modal.is-open .chatbot-container {
transform: scale(1);
}

.chatbot-header {
padding: 1rem;
background: rgba(255, 255, 255, 0.3);
color: white;
display: flex;
align-items: center;
justify-content: between;
box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.chatbot-chat-container {
flex: 1;
padding: 1rem;
overflow-y: auto;
-ms-overflow-style: none;
scrollbar-width: none;
}

.chatbot-chat-container::-webkit-scrollbar {
display: none;
}

.chatbot-message {
max-width: 80%;
padding: 0.75rem 1rem;
border-radius: 1.25rem;
margin-bottom: 0.75rem;
word-wrap: break-word;
opacity: 0;
animation: messageSlideIn 0.3s ease-out forwards;
}

.chatbot-user-message {
background-color: #f97316;
color: white;
align-self: flex-end;
margin-left: auto;
border-bottom-right-radius: 0.25rem;
}

.chatbot-bot-message {
background-color: rgba(255, 255, 255, 0.9);
color: #333;
align-self: flex-start;
border-bottom-left-radius: 0.25rem;
}

.chatbot-input-container {
padding: 1rem;
background: rgba(255, 255, 255, 0.2);
border-top: 1px solid rgba(255, 255, 255, 0.3);
display: flex;
align-items: center;
gap: 0.75rem;
}

.chatbot-input {
flex: 1;
padding: 0.75rem 1rem;
border-radius: 2rem;
background: rgba(255, 255, 255, 0.3);
color: white;
border: none;
outline: none;
}

.chatbot-input::placeholder {
color: rgba(255, 255, 255, 0.7);
}

.chatbot-send-btn {
padding: 0.75rem;
background: rgba(255, 255, 255, 0.8);
color: #f97316;
border-radius: 50%;
border: none;
cursor: pointer;
transition: all 0.3s ease;
}

.chatbot-send-btn:hover {
background: white;
transform: scale(1.05);
}

.chatbot-close-btn {
padding: 0.5rem;
background: rgba(255, 255, 255, 0.2);
color: white;
border-radius: 50%;
border: none;
cursor: pointer;
transition: all 0.3s ease;
margin-left: auto;
}

.chatbot-close-btn:hover {
background: rgba(255, 255, 255, 0.3);
}

.chatbot-typing-indicator {
background-color: rgba(255, 255, 255, 0.9);
color: #333;
padding: 0.75rem 1rem;
border-radius: 1.25rem;
border-bottom-left-radius: 0.25rem;
max-width: 80%;
animation: pulse 1.2s infinite ease-in-out;
}

@keyframes messageSlideIn {
from {
opacity: 0;
transform: translateY(20px);
}
to {
opacity: 1;
transform: translateY(0);
}
}

.mandir-scroll-lock {
overflow: hidden;
}

.mandir-video-overlay {
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 100%;
transition: opacity 2s ease-in-out;
background: none; /* Default is no background, applied by JS */
opacity: 0;
}
.mandir-video-overlay.is-praying {
opacity: 1;
}
.fade-spotlight {
background: radial-gradient(ellipse at center, transparent 15%, rgba(0, 0, 0, 0.95) 50%);
}
.fade-spotlight-krishna {
background: radial-gradient(ellipse at 40% 50%, transparent 15%, rgba(0, 0, 0, 0.95) 50%);
}
.deity-btn.active {
background: linear-gradient(145deg, #fbbF24, #f59e0b); /* amber-400 to amber-500 */
color: #1f2937; /* gray-800 */
border-color: #fcd34d; /* amber-300 */
box-shadow: 0 0 20px rgba(251, 191, 36, 0.6);
transform: translateY(-4px);
}
.punya-option {
transition: all 0.2s ease-in-out;
}
.punya-option.active {
background: linear-gradient(145deg, #f97316, #f59e0b); /* orange-500 to amber-500 */
color: white;
border-color: #fb923c; /* amber-400 */
box-shadow: 0 0 15px rgba(251, 191, 36, 0.5);
transform: translateY(-2px);
}
.punya-info-message {
@apply mt-4 p-3 rounded-lg shadow-sm flex items-center justify-between transition-opacity duration-300;
color: white;
background-color: rgba(255, 255, 255, 0.1);
}

.punya-info-redirect-btn {
@apply p-1 rounded-full transition-colors;
background-color: rgba(255, 255, 255, 0.3);
}
.punya-info-redirect-btn:hover {
background-color: rgba(255, 255, 255, 0.5);
}
.punya-info-redirect-btn svg {
@apply text-white;
}

/* Typing indicator animation */
.typing-indicator span {
height: 8px;
width: 8px;
margin: 0 2px;
background-color: #d1d5db;
display: inline-block;
border-radius: 50%;
opacity: 0.6;
animation: bounce 1.3s infinite;
}
.typing-indicator span:nth-child(2) { animation-delay: 0.15s; }
.typing-indicator span:nth-child(3) { animation-delay: 0.3s; }
@keyframes bounce {
0%, 100% { transform: translateY(0); }
50% { transform: translateY(-7px); }
}

/* UPDATED Glassmorphism effect for a greyish look */
.glassy-box {
background: rgba(40, 40, 40, 0.3);
backdrop-filter: blur(15px);
-webkit-backdrop-filter: blur(15px);
border: 1px solid rgba(255, 255, 255, 0.1);
}

/* NEW Premium container for Guruji view */
.guruji-premium-container {
background: rgba(26, 26, 26, 0.75);
backdrop-filter: blur(20px);
-webkit-backdrop-filter: blur(20px);
border: 1px solid rgba(255, 165, 0, 0.3);
box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
}

/* Message fade-in animation */
.message-bubble {
animation: fadeIn 0.4s ease-out;
}
@keyframes fadeIn {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}

/* NEW custom styles for message bubbles */
.bot-bubble {
background: rgba(40, 40, 40, 0.5); /* Darker for premium theme */
color: #f0f0f0;
}
.user-bubble {
background-color: #f97316;
color: white;
}

/* Styles from Breathing Circle App */
#mental-health-view {
background-size: cover;
background-position: center;
background-attachment: fixed;
position: relative;
}

.fancy-heading-font {
font-family: 'Dancing Script', cursive;
}

@keyframes fadeInGlow {
0% {
opacity: 0;
filter: brightness(1) drop-shadow(0 0 0 rgba(76, 175, 80, 0.5));
}
100% {
opacity: 1;
filter: brightness(1.2) drop-shadow(0 0 10px rgba(76, 175, 80, 0.8));
}
}

@keyframes perpetualGlow {
0% {
text-shadow: 0 0 5px rgba(76, 175, 80, 0.5), 0 0 10px rgba(76, 175, 80, 0.5);
}
50% {
text-shadow: 0 0 10px rgba(76, 175, 80, 0.8), 0 0 20px rgba(76, 175, 80, 0.8);
}
100% {
text-shadow: 0 0 5px rgba(76, 175, 80, 0.5), 0 0 10px rgba(76, 175, 80, 0.5);
}
}

.perpetual-glow {
animation: perpetualGlow 4s infinite alternate;
}

.green-text {
color: #4CAF50;
}

.gradient-border {
border-radius: 9999px;
position: relative;
padding: 3px;
background: linear-gradient(135deg, #f3f4f6, #d1d5db);
box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

.gradient-border::before {
content: '';
position: absolute;
top: 0; left: 0; right: 0; bottom: 0;
border-radius: 9999px;
background: linear-gradient(45deg, #81e6d9, #06b6d4, #3b82f6, #6366f1, #c084fc);
mask: radial-gradient(circle, transparent 75%, black 75%);
-webkit-mask: radial-gradient(circle, transparent 75%, black 75%);
z-index: -1;
}

.circle {
background: radial-gradient(circle, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.5));
border-radius: 50%;
}

.pulse-text {
animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

#mental-health-view #instruction {
font-family: 'Poppins', sans-serif;
color: #1f2937;
}

.dropdown-menu {
display: none;
position: absolute;
top: 50px;
right: 10px;
background-color: #fff;
border-radius: 8px;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
z-index: 100;
overflow: hidden;
width: 200px;
transition: all 0.3s ease-in-out;
opacity: 0;
transform: translateY(-10px);
}

.dropdown-menu.visible {
display: block;
opacity: 1;
transform: translateY(0);
}

.dropdown-item {
padding: 12px 16px;
cursor: pointer;
transition: background-color 0.2s;
color: #1f2937;
font-family: 'Inter', sans-serif;
}

.dropdown-item:hover {
background-color: #f3f4f6;
}

.quote-container {
height: 100px; /* Fixed height to prevent layout shift */
width: 80%;
max-width: 600px;
text-align: center;
opacity: 0;
transition: opacity 3s ease-in-out;
}

.pattern-btn {
background-color: rgba(240, 255, 240, 0.85); /* Lighter, almost white-green */
color: #14532d; /* dark-green-900 */
font-weight: 600;
transition: all 0.3s ease-in-out;
border: 1px solid rgba(22, 163, 74, 0.3);
border-radius: 0.5rem; /* rounded-lg */
box-shadow: 0 4px 15px rgba(0,0,0,0.05);
transform: translateY(0);
}

.pattern-btn:hover {
background: linear-gradient(145deg, #16a34a, #15803d); /* green-600 to green-700 */
color: white;
box-shadow: 0 6px 20px rgba(22, 163, 74, 0.4);
transform: translateY(-2px);
}

.pattern-btn:active {
transform: scale(0.98) translateY(0);
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.pattern-btn.active-pattern {
background: linear-gradient(145deg, #16a34a, #15803d);
color: white;
box-shadow: 0 0 15px rgba(22, 163, 74, 0.6), inset 0 2px 4px rgba(0,0,0,0.3);
transform: translateY(0);
}

.start-btn-style {
background-color: rgba(240, 255, 240, 0.9); /* Lighter, almost white-green */
color: #14532d; /* dark-green-900 */
border: 1px solid rgba(22, 163, 74, 0.4);
box-shadow: 0 4px 15px rgba(0,0,0,0.1);
transition: all 0.3s ease-in-out;
}
.start-btn-style:hover {
background: linear-gradient(145deg, #16a34a, #15803d);
color: white;
box-shadow: 0 8px 25px rgba(22, 163, 74, 0.5);
transform: scale(1.05);
}

/* --- Veda Verse Styles --- */
#veda-verse-view h1, #veda-verse-view h2, #veda-verse-view h3, #veda-verse-view .font-serif {
font-family: 'Playfair Display', serif;
}

.premium-bg {
background-color: #1a1a1a;
background-image:
radial-gradient(at 27% 37%, hsla(28, 97%, 49%, 0.15) 0px, transparent 50%),
radial-gradient(at 97% 21%, hsla(20, 97%, 58%, 0.1) 0px, transparent 50%),
radial-gradient(at 52% 99%, hsla(35, 98%, 56%, 0.1) 0px, transparent 50%),
radial-gradient(at 10% 29%, hsla(35, 98%, 51%, 0.1) 0px, transparent 50%),
radial-gradient(at 97% 96%, hsla(28, 98%, 51%, 0.15) 0px, transparent 50%),
radial-gradient(at 33% 50%, hsla(28, 97%, 49%, 0.1) 0px, transparent 50%),
radial-gradient(at 79% 53%, hsla(32, 98%, 56%, 0.1) 0px, transparent 50%);
}

.glow-box {
box-shadow: 0 0 15px rgba(255, 165, 0, 0.2), 0 0 30px rgba(255, 165, 0, 0.1);
transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}

.glow-box:hover {
transform: translateY(-5px) scale(1.02);
box-shadow: 0 0 25px rgba(255, 165, 0, 0.4), 0 0 50px rgba(255, 165, 0, 0.2);
}

#veda-selection-modal .modal-backdrop {
transition: opacity 0.3s ease-in-out;
}

#veda-selection-modal .modal-content {
transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
}

.veda-fade-in {
animation: vedaFadeIn 1.5s ease-in-out forwards;
}

.veda-fade-out {
animation: vedaFadeOut 0.5s ease-in-out forwards;
}

@keyframes vedaFadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

@keyframes vedaFadeOut {
from { opacity: 1; transform: translateY(0); }
to { opacity: 0; transform: translateY(-20px); }
}

/* Custom dropdown arrow for Veda view */
#veda-verse-view select {
-webkit-appearance: none;
-moz-appearance: none;
appearance: none;
background-image: url('data:image/svg+xml;utf8,<svg fill="orange" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
background-repeat: no-repeat;
background-position: right 1rem center;
}
</style>
</head>
<body class="antialiased">

<div id="video-bg-container" class="fixed top-0 left-0 w-full h-full -z-10 hidden">
<video autoplay loop muted playsinline class="w-full h-full object-cover">
<source src="https://cdn.jsdelivr.net/gh/nayantalukdar7777-devotial/bgofmeditation/ezgif-13faa31249b3b1.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>
<div class="absolute inset-0 bg-black opacity-50"></div>
</div>

<!-- Loading Spinner -->
<div id="loading-spinner" class="fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm p-4">
<i class="gg-loader animate-spin text-orange-500" style="--ggs:3"></i>
</div>

<!-- App Container -->
<div id="app-container" class="hidden">

<!-- Top Bar -->
<div class="fixed top-0 left-0 right-0 bg-white/80 backdrop-blur-lg shadow-md z-40">
<div class="w-full px-6 md:px-10 py-2 flex justify-between items-center">
<span class="font-lora text-xl font-bold text-orange-800">Devotial</span>

<!-- Desktop Menu -->
<div class="hidden md:flex items-center space-x-2">
<button id="meditation-view-btn" class="text-sm py-2 px-4 font-semibold rounded-lg shadow-sm transition-all text-orange-800 bg-orange-100 hover:bg-orange-200">Meditation</button>
<div class="relative inline-block text-left z-50">
<button id="tools-dropdown-btn" class="text-sm py-2 px-4 font-semibold rounded-lg shadow-sm transition-all text-orange-800 bg-orange-100 hover:bg-orange-200 flex items-center gap-1">
Tools
<svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
</button>
<div id="tools-dropdown-menu" class="dashboard-dropdown absolute left-1/2 transform -translate-x-1/2 mt-2 w-48 origin-top-right bg-white/95 rounded-md shadow-lg z-50">
<div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="tools-dropdown-btn">
<button id="counter-view-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Nam Japa Counter</button>
<button id="punya-calculator-view-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Daily Karmic Score</button>
<button id="guruji-view-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Devotial Guruji</button>
<button id="veda-verse-view-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Veda Verse</button>
<button id="digital-mandir-view-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Digital Mandir</button>
</div>
</div>
</div>
<button id="mental-health-view-btn" class="text-sm py-2 px-4 font-semibold rounded-lg shadow-sm transition-all text-orange-800 bg-orange-100 hover:bg-orange-200">Mental Health</button>
<div class="relative inline-block text-left">
<button id="dashboard-dropdown-btn" class="text-sm py-2 px-4 font-semibold rounded-lg shadow-sm transition-all text-orange-800 bg-orange-100 hover:bg-orange-200 flex items-center gap-1">
Dashboard
<svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
</button>
<div id="dashboard-dropdown-menu" class="dashboard-dropdown absolute left-1/2 transform -translate-x-1/2 mt-2 w-40 origin-top-right bg-white/95 rounded-md shadow-lg z-50">
<div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="dashboard-dropdown-btn">
<button id="dashboard-japa-stats-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Nam Japa Stats</button>
<button id="dashboard-meditation-stats-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Meditation Stats</button>
<button id="dashboard-punya-stats-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Karmic Stats</button>
</div>
</div>
</div>
<button id="blog-view-btn" class="text-sm py-2 px-4 font-semibold rounded-lg shadow-sm transition-all text-orange-800 bg-orange-100 hover:bg-orange-200">Blogs</button>
<button id="about-us-view-btn" class="text-sm py-2 px-4 font-semibold rounded-lg shadow-sm transition-all text-orange-800 bg-orange-100 hover:bg-orange-200">About Us</button>
</div>

<!-- Mobile menu button -->
<div class="md:hidden">
<button id="mobile-menu-button" class="p-2 rounded-md text-orange-700 hover:text-orange-900 hover:bg-orange-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-orange-500">
<span class="sr-only">Open main menu</span>
<svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
</svg>
</button>
</div>
</div>

<!-- Mobile menu, show/hide based on menu state. -->
<div id="mobile-menu" class="hidden md:hidden bg-white/95 backdrop-blur-lg">
<div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
<button id="mobile-meditation-view-btn" class="w-full text-left block px-3 py-2 rounded-md text-base font-medium text-orange-800 hover:text-orange-900 hover:bg-orange-100">Meditation</button>
<div class="relative inline-block w-full text-left">
<button id="mobile-tools-dropdown-btn" class="w-full text-left block px-3 py-2 rounded-md text-base font-medium text-orange-800 hover:text-orange-900 hover:bg-orange-100 flex items-center justify-between">
Tools
<svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
</button>
<div id="mobile-tools-dropdown-menu" class="dashboard-dropdown absolute left-0 mt-1 w-full origin-top-left bg-white/95 rounded-md shadow-lg z-50">
<div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="mobile-tools-dropdown-btn">
<button id="mobile-counter-view-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Nam Japa Counter</button>
<button id="mobile-punya-calculator-view-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Daily Karmic Score</button>
<button id="mobile-guruji-view-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Devotial Guruji</button>
<button id="mobile-veda-verse-view-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Veda Verse</button>
<button id="mobile-digital-mandir-view-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Digital Mandir</button>
</div>
</div>
</div>
<button id="mobile-mental-health-view-btn" class="w-full text-left block px-3 py-2 rounded-md text-base font-medium text-orange-800 hover:text-orange-900 hover:bg-orange-100">Mental Health</button>
<div class="relative inline-block w-full text-left">
<button id="mobile-dashboard-dropdown-btn" class="w-full text-left block px-3 py-2 rounded-md text-base font-medium text-orange-800 hover:text-orange-900 hover:bg-orange-100 flex items-center justify-between">
Dashboard
<svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
</button>
<div id="mobile-dashboard-dropdown-menu" class="dashboard-dropdown absolute left-0 mt-1 w-full origin-top-left bg-white/95 rounded-md shadow-lg z-50">
<div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="mobile-dashboard-dropdown-btn">
<button id="mobile-dashboard-japa-stats-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Nam Japa Stats</button>
<button id="mobile-dashboard-meditation-stats-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Meditation Stats</button>
<button id="mobile-dashboard-punya-stats-btn" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Karmic Stats</button>
</div>
</div>
</div>
<button id="mobile-blog-view-btn" class="w-full text-left block px-3 py-2 rounded-md text-base font-medium text-orange-800 hover:text-orange-900 hover:bg-orange-100">Blogs</button>
<button id="mobile-about-us-view-btn" class="w-full text-left block px-3 py-2 rounded-md text-base font-medium text-orange-800 hover:text-orange-900 hover:bg-orange-100">About Us</button>
</div>
</div>
</div>

<!-- Japa Counter View -->
<div id="japa-counter-view" class="view-container">
<div class="min-h-screen flex flex-col items-center justify-start md:justify-center p-4 pt-24 md:pt-16">
<header class="text-center mb-6 md:mb-8 fade-in-up">
<h1 class="text-5xl md:text-6xl font-lora font-bold text-white">Devotial</h1>
<p class="text-orange-200/80 mt-2 text-lg">ॐ Nam Japa Sadhana ॐ</p>
</header>
<main class="w-full max-w-md mx-auto flex flex-col items-center">
<div id="japa-button" class="w-64 h-64 md:w-72 md:h-72 bg-gradient-to-br from-orange-500 to-amber-600 rounded-full flex flex-col items-center justify-center cursor-pointer select-none japa-btn-anim pulse-anim">
<span class="text-white text-6xl md:text-7xl font-bold" id="current-japa-count">0</span>
<span class="text-white opacity-80 text-lg">Tap to Chant</span>
</div>

<div id="target-progress-container" class="w-full mt-8 hidden">
<div class="flex justify-between items-center mb-1 text-sm font-medium text-orange-200/80">
<span>Daily Goal</span>
<span id="target-progress-text">0 / 0</span>
</div>
<div class="w-full progress-bar-bg rounded-full h-2.5">
<div id="target-progress-bar" class="progress-bar-fill h-2.5 rounded-full" style="width: 0%"></div>
</div>
</div>

<div class="grid grid-cols-2 gap-4 w-full mt-8">
<div class="stat-box p-4 rounded-2xl text-center shadow-lg fade-in-up" style="animation-delay: 0.2s;">
<h2 class="font-semibold text-white/90">Mala Japa</h2>
<p class="text-4xl font-bold text-orange-300 mt-1" id="mala-japa-count">0</p>
</div>
<div class="stat-box p-4 rounded-2xl text-center shadow-lg fade-in-up" style="animation-delay: 0.3s;">
<h2 class="font-semibold text-white/90">Total Japa</h2>
<p class="text-4xl font-bold text-orange-300 mt-1" id="total-japa-count">0</p>
</div>
</div>
<div class="flex items-center justify-center gap-4 w-full mt-8 fade-in-up" style="animation-delay: 0.4s;">
<button id="reset-session-btn" class="w-1/2 py-3 px-4 bg-white/10 text-orange-200 font-semibold rounded-xl shadow-md hover:bg-white/20 transition-all duration-200 hover:scale-105 border border-orange-400/30">
Reset Session
</button>
<button id="set-target-btn" class="w-1/2 py-3 px-4 bg-white/10 text-orange-200 font-semibold rounded-xl shadow-md hover:bg-white/20 transition-all duration-200 hover:scale-105 border border-orange-400/30">
Set Target
</button>
</div>
</main>
</div>
</div>

<!-- Digital Mandir View -->
<div id="digital-mandir-view" class="hidden view-container">
<div class="h-screen w-full flex flex-col relative overflow-hidden">
<div class="absolute top-20 left-4 z-10 flex flex-col space-y-4">
<button id="pray-button" class="w-36 py-3 px-4 rounded-xl shadow-lg font-semibold transition-all duration-300 flex items-center justify-center gap-2 bg-gray-900/60 backdrop-blur-sm border border-amber-400/30 text-amber-100 hover:bg-gray-800/80 hover:border-amber-400 hover:shadow-amber-400/20 hover:shadow-2xl transform hover:-translate-y-1">
<span>Pray</span>
</button>
<button id="shiva-pray-btn" class="deity-btn w-36 py-3 px-4 rounded-xl shadow-lg font-semibold transition-all duration-300 flex items-center justify-center gap-2 bg-gray-900/60 backdrop-blur-sm border border-amber-400/30 text-amber-100 hover:bg-gray-800/80 hover:border-amber-400 hover:shadow-amber-400/20 hover:shadow-2xl transform hover:-translate-y-1">
<span>Shiva</span>
</button>
<button id="ganesh-pray-btn" class="deity-btn w-36 py-3 px-4 rounded-xl shadow-lg font-semibold transition-all duration-300 flex items-center justify-center gap-2 bg-gray-900/60 backdrop-blur-sm border border-amber-400/30 text-amber-100 hover:bg-gray-800/80 hover:border-amber-400 hover:shadow-amber-400/20 hover:shadow-2xl transform hover:-translate-y-1">
<span>Ganesh</span>
</button>
<button id="krishna-pray-btn" class="deity-btn w-36 py-3 px-4 rounded-xl shadow-lg font-semibold transition-all duration-300 flex items-center justify-center gap-2 bg-gray-900/60 backdrop-blur-sm border border-amber-400/30 text-amber-100 hover:bg-gray-800/80 hover:border-amber-400 hover:shadow-amber-400/20 hover:shadow-2xl transform hover:-translate-y-1">
<span>Krishna</span>
</button>
</div>
<!-- Main Mandir Video with Overlay for Fade effect -->
<div class="h-full w-full relative">
<video id="mandir-video" autoplay loop muted playsinline class="w-full h-full object-cover">
<source src="https://raw.githubusercontent.com/nayantalukdar7777-devotial/shivafinaldm/main/One_eye_of_202509060758.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>
<img id="mandir-image-bg" src="" alt="Deity Background" class="hidden w-full h-full object-cover">
<div id="video-overlay" class="mandir-video-overlay"></div>
</div>

<!-- Flame GIF (overlay) -->
<div id="flame-video-container" class="absolute inset-0 flex items-center justify-center hidden">
<img src="https://i.postimg.cc/zG2FhZzx/jm-a-Cn-unscreen.gif" alt="Sacred Mantra" class="w-1/3 h-1/3 absolute top-[75%] left-[45%]">
<img src="https://i.postimg.cc/zG2FhZzx/jm-a-Cn-unscreen.gif" alt="Sacred Mantra" class="w-1/3 h-1/3 absolute top-[75%] right-[45%]">
</div>
<!-- Prayer Guiding Box -->
<div id="guiding-box" class="fixed right-4 top-1/2 -translate-y-1/2 text-white guiding-box max-w-xs w-auto">
<p id="guiding-message" class="text-lg font-lora text-center italic"></p>
</div>
</div>
</div>

<!-- Dashboard View -->
<div id="dashboard-view" class="hidden view-container">
<div class="min-h-screen flex flex-col items-center p-4 pt-20">
<div class="w-full max-w-3xl relative text-center mb-2">
<h1 id="dashboard-title" class="text-4xl font-lora font-bold text-white">Dashboard - Nam Japa Stats</h1>
</div>
<div class="flex items-center space-x-2 text-white/80 mb-4 fade-in-up">
<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>
<span id="dashboard-subtitle" class="text-sm">Dashboard shows you the progress of Name Chanting</span>
</div>

<!-- Nam Japa Dashboard Content -->
<div id="japa-stats-pane" class="w-full max-w-3xl">
<div id="statistics-pane" class="w-full max-w-3xl glass-card rounded-2xl p-6">
<div id="real-time-clock" class="text-center mb-6 pb-4 border-b border-white/30 fade-in-up">
<p class="text-lg font-semibold text-white" id="date-display"></p>
<p class="text-6xl font-bold text-white font-mono" id="time-display">00:00:00</p>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="stat-box p-4 rounded-xl fade-in-up" style="animation-delay: 0.2s;"><h3 class="font-bold text-white text-lg text-center pb-2 border-b border-white/30">Today's Sadhana</h3><div class="flex justify-around text-center mt-4"><div><p class="text-3xl font-bold text-white" id="daily-japa-stat">0</p><p class="text-sm text-white/80">Nam Japa</p></div><div><p class="text-3xl font-bold text-white" id="daily-mala-stat">0</p><p class="text-sm text-white/80">Mala Japa</p></div></div></div>
<div class="stat-box p-4 rounded-xl fade-in-up" style="animation-delay: 0.3s;"><h3 class="font-bold text-white text-lg text-center pb-2 border-b border-white/30">This Month's Sadhana</h3><div class="flex justify-around text-center mt-4"><div><p class="text-3xl font-bold text-white" id="monthly-japa-stat">0</p><p class="text-sm text-white/80">Nam Japa</p></div><div><p class="text-3xl font-bold text-white" id="monthly-mala-stat">0</p><p class="text-sm text-white/80">Mala Japa</p></div></div></div>
</div>
<div class="stat-box p-4 rounded-xl mt-4 fade-in-up" style="animation-delay: 0.4s;"><h3 class="font-bold text-white text-lg text-center pb-2 border-b border-white/30">Lifetime Sadhana</h3><div class="flex justify-around text-center mt-4"><div><p class="text-3xl font-bold text-white" id="lifetime-japa-stat">0</p><p class="text-sm text-white/80">Nam Japa</p></div><div><p class="text-3xl font-bold text-white" id="lifetime-mala-stat">0</p><p class="text-sm text-white/80">Mala Japa</p></div></div></div>
<div class="text-center mt-6 fade-in-up" style="animation-delay: 0.5s;">
<button id="clear-all-btn" class="py-2 px-5 bg-red-500/20 text-red-100 font-semibold rounded-lg border border-red-200/50 hover:bg-red-500/40 transition-colors">
Clear All Data
</button>
</div>
</div>
<div id="achievements-pane" class="w-full max-w-3xl mt-8">
<h2 class="font-lora text-3xl font-bold text-white text-center mb-4">Achievements - Nam Japa</h2>
<div id="achievements-container" class="space-y-6"></div>
</div>
</div>

<!-- Meditation Stats Dashboard Content -->
<div id="meditation-stats-pane" class="w-full max-w-3xl hidden">
<div class="text-center p-8 glass-card rounded-2xl">
<h2 class="font-lora text-3xl font-bold text-white mb-4">Meditation Stats</h2>
<p class="text-white/80">Track your meditation journey here. Consistency leads to clarity!</p>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8">
<div class="stat-box p-4 rounded-xl fade-in-up" style="animation-delay: 0.2s;">
<h3 class="font-bold text-white text-lg text-center pb-2 border-b border-white/30">Today's Session</h3>
<div class="flex justify-around text-center mt-4">
<div>
<p class="text-3xl font-bold text-white" id="daily-meditation-time">0m</p>
<p class="text-sm text-white/80">Time</p>
</div>
<div>
<p class="text-3xl font-bold text-white" id="daily-meditation-sessions">0</p>
<p class="text-sm text-white/80">Sessions</p>
</div>
</div>
</div>
<div class="stat-box p-4 rounded-xl fade-in-up" style="animation-delay: 0.3s;">
<h3 class="font-bold text-white text-lg text-center pb-2 border-b border-white/30">This Month</h3>
<div class="flex justify-around text-center mt-4">
<div>
<p class="text-3xl font-bold text-white" id="monthly-meditation-time">0h</p>
<p class="text-sm text-white/80">Time</p>
</div>
<div>
<p class="text-3xl font-bold text-white" id="monthly-meditation-sessions">0</p>
<p class="text-sm text-white/80">Sessions</p>
</div>
</div>
</div>
<div class="stat-box p-4 rounded-xl fade-in-up" style="animation-delay: 0.4s;">
<h3 class="font-bold text-white text-lg text-center pb-2 border-b border-white/30">All Time</h3>
<div class="flex justify-around text-center mt-4">
<div>
<p class="text-3xl font-bold text-white" id="lifetime-meditation-time">0h</p><p class="text-sm text-white/80">Time</p>
</div>
<div>
<p class="text-3xl font-bold text-white" id="lifetime-meditation-sessions">0</p><p class="text-sm text-white/80">Sessions</p>
</div>
</div>
</div>
</div>
</div>
<div class="stat-box p-6 rounded-xl mt-8 w-full max-w-3xl">
<div class="flex justify-between items-center mb-4">
<h3 class="font-bold text-white text-lg">Meditation Progress</h3>
<div class="relative">
<select id="meditation-chart-selector" class="block appearance-none w-full bg-white/10 text-white border border-white/30 hover:border-white/50 px-3 py-2 pr-8 rounded-lg leading-tight focus:outline-none focus:shadow-outline">
<option value="daily" class="bg-gray-800">Daily</option>
<option value="monthly" class="bg-gray-800">Monthly</option>
<option value="yearly" class="bg-gray-800">Yearly</option>
</select>
<div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-white">
<svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
</div>
</div>
</div>
<div class="mt-4">
<canvas id="meditation-bar-chart"></canvas>
</div>
</div>
</div>
<!-- Punya Stats Dashboard Content -->
<div id="punya-stats-pane" class="w-full max-w-3xl hidden">
<div class="text-center p-8 glass-card rounded-2xl">
<div id="punya-stats-clock" class="text-center mb-6 pb-4 border-b border-white/30 fade-in-up">
<p class="text-lg font-semibold text-white" id="stats-punya-date-display"></p>
<p class="text-6xl font-bold text-white font-mono" id="stats-punya-time-display">00:00:00</p>
</div>
<h2 class="font-lora text-3xl font-bold text-white mb-4">Daily Karmic Score</h2>
<p class="text-white/80">Track your Karmic score, a conceptual representation of your spiritual progress.</p>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-8">
<div class="stat-box p-4 rounded-xl">
<h3 class="font-bold text-white text-lg text-center pb-2 border-b border-white/30">Today's Score</h3>
<p id="daily-punya-score" class="text-5xl font-bold text-yellow-300 mt-2" style="text-shadow: 0 0 10px rgba(253, 224, 71, 0.7);"></p>
<p id="daily-punya-progress-text" class="text-sm text-white/70 mt-2"></p>
</div>
<div class="stat-box p-4 rounded-xl">
<h3 class="font-bold text-white text-lg text-center pb-2 border-b border-white/30">Lifetime Score</h3>
<p id="lifetime-punya-score" class="text-5xl font-bold text-yellow-300 mt-2" style="text-shadow: 0 0 10px rgba(253, 224, 71, 0.7);"></p>
</div>
</div>

<div class="mt-8">
<div class="stat-box p-6 rounded-xl">
<div class="flex justify-between items-center mb-4">
<h3 class="font-bold text-white text-lg">Monthly Karmic Progress</h3>
</div>
<div class="mt-4">
<canvas id="punya-bar-chart"></canvas>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Meditation View -->
<div id="meditation-view" class="hidden view-container">
<div class="min-h-screen flex flex-col items-center justify-start md:justify-center p-4 pt-24 md:pt-20 text-white">
<div class="text-5xl md:text-6xl font-dancing-script font-bold text-white/90 text-center mb-4 fade-in-up" style="text-shadow: 2px 2px 10px rgba(0,0,0,0.7);">
<span>Devotial</span><br>
<span class="ml-6 md:ml-8">Meditation</span>
</div>
<p id="quote-display" class="quote-text text-center italic text-white/80 max-w-xl mx-auto mb-6 h-32 md:h-24 flex items-center justify-center" style="animation-delay: 0.2s;">
<!-- Quotes will be injected here by JavaScript -->
</p>

<div class="w-full max-w-lg glass-card rounded-2xl p-6 md:p-8 relative">
<div class="text-center">
<p class="text-lg text-white/80">Meditation Timer</p>
<p id="meditation-timer-display" class="text-7xl md:text-8xl font-mono font-bold my-4" style="text-shadow: 1px 1px 4px rgba(0,0,0,0.2);">00:00</p>
</div>
<div class="flex items-center justify-center gap-4 mt-6">
<button id="set-meditation-timer-btn" class="w-1/2 py-3 px-4 bg-blue-500 text-white font-semibold rounded-xl shadow-md hover:bg-blue-600 transition-all duration-200">Set Timer</button>
<button id="start-meditation-btn" class="w-1/2 py-3 px-4 bg-green-500 text-white font-semibold rounded-xl shadow-md hover:bg-green-600 transition-all duration-200">Start</button>
<button id="stop-meditation-btn" class="w-1/2 py-3 px-4 bg-red-500 text-white font-semibold rounded-xl shadow-md hover:bg-red-600 transition-all duration-200 hidden">Stop</button>
</div>
<div class="mt-6 border-t border-white/20 pt-6 space-y-4">
<div class="relative inline-block text-left w-full">
<button id="new-guided-meditation-btn" class="w-full py-3 px-4 bg-gradient-to-br from-yellow-500 to-yellow-700 text-white font-semibold rounded-xl shadow-md hover:opacity-90 transition-all duration-200 flex items-center justify-center gap-2">
<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 14.89l5.13 5.11a2.12 2.12 0 0 0 3 0L20 12.33c.73-.73.73-1.92 0-2.65l-2.46-2.46c-.73-.73-1.92-.73-2.65 0L12 7.74l-.88-.88c-.73-.73-1.92-.73-2.65 0L3.9 6.27a2.12 2.12 0 0 0-3 0l-.84.84c-.73.73-.73 1.92 0 2.65L12 20.11l1.62-1.61"/></svg>
Guided Meditation
</button>
<div id="new-guided-meditation-dropdown" class="absolute bottom-full mb-2 w-full origin-bottom-right bg-white/95 backdrop-blur-sm rounded-lg shadow-xl hidden z-50">
<a href="#" data-track-id="11" class="new-guided-track-item block px-4 py-3 text-sm font-medium text-gray-800 hover:bg-orange-100 rounded-t-lg">Quick Inner Calm Meditation (5:09 Minute)</a>
<a href="#" data-track-id="8" class="new-guided-track-item block px-4 py-3 text-sm font-medium text-gray-800 hover:bg-orange-100 rounded-b-lg">Rest in Stillness (12 Minutes)</a>
</div>
</div>
<div class="relative inline-block text-left w-full">
<button id="ambient-music-btn" class="w-full py-3 px-4 bg-purple-500 text-white font-semibold rounded-xl shadow-md hover:bg-purple-600 transition-all duration-200 flex items-center justify-center gap-2">
<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
Ambient Music Meditation
</button>
<div id="ambient-music-dropdown" class="absolute bottom-full mb-2 w-full origin-bottom-right bg-white/95 backdrop-blur-sm rounded-lg shadow-xl hidden z-50">
<a href="#" data-track-id="1" class="ambient-track-item block px-4 py-3 text-sm font-medium text-gray-800 hover:bg-orange-100 rounded-t-lg">Magical Meditation (1:21 Minutes)</a>
<a href="#" data-track-id="2" class="ambient-track-item block px-4 py-3 text-sm font-medium text-gray-800 hover:bg-orange-100">Relaxing Meditation (10 Minute)</a>
<a href="#" data-track-id="3" class="ambient-track-item block px-4 py-3 text-sm font-medium text-gray-800 hover:bg-orange-100">Spiritual Forest Meditation (20 Minute)</a>
<a href="#" data-track-id="7" class="ambient-track-item block px-4 py-3 text-sm font-medium text-gray-800 hover:bg-orange-100 rounded-b-lg">Morning Energy Angelic Meditation (10:10 Min)</a>
</div>
</div>
</div>
<div class="mt-4">
<div class="relative inline-block text-left w-full">
<button id="nature-sound-btn" class="w-full py-3 px-4 bg-green-500 text-white font-semibold rounded-xl shadow-md hover:bg-green-600 transition-all duration-200 flex items-center justify-center gap-2">
<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.4 19 4a2 2 0 0 1 2 2c0 2-2 4-3.5 6.5S15 20 11 20z"></path><path d="M17 14c-3.5 0-5-2-6.5-4.5S2 4 2 4"></path></svg>
Nature Sound Meditation
</button>
<div id="nature-sound-dropdown" class="absolute bottom-full mb-2 w-full origin-bottom-right bg-white/95 backdrop-blur-sm rounded-lg shadow-xl hidden z-50">
<a href="#" data-track-id="4" class="nature-track-item block px-4 py-3 text-sm font-medium text-gray-800 hover:bg-orange-100 rounded-t-lg">8 Minute Rain Meditation for Instant Calm</a>
<a href="#" data-track-id="5" class="nature-track-item block px-4 py-3 text-sm font-medium text-gray-800 hover:bg-orange-100">5 minute 10 seconds Mountain Forest music</a>
<a href="#" data-track-id="6" class="nature-track-item block px-4 py-3 text-sm font-medium text-gray-800 hover:bg-orange-100 rounded-b-lg">5 Minutes 23 Seconds Realistic Meditation with Sound Effects</a>
</div>
</div>
</div>
</div>

<!-- Meditation Completion Flash -->

<!-- Pre-Meditation Flash -->

</div>
</div>

<div id="blog-list-view" class="hidden view-container">
<div class="min-h-screen w-full flex flex-col items-center p-4 pt-24">
<h1 class="text-4xl font-lora font-bold text-white mb-8">Devotial Blogs</h1>
<div id="blog-list-container" class="w-full max-w-3xl space-y-6"></div>
</div>
</div>
<div id="blog-post-view" class="hidden view-container">
<div class="min-h-screen w-full flex flex-col items-center p-4 pt-24">
<div class="w-full max-w-3xl">
<button id="back-to-blogs-btn" class="mb-6 text-white/80 hover:text-white font-semibold">&larr; Back to All Blogs</button>
<div class="glass-card p-8 rounded-2xl">
<article id="blog-post-content" class="blog-content"></article>
</div>
</div>
</div>
</div>

<!-- About Us View -->
<div id="about-us-view" class="hidden view-container">
<div class="min-h-screen flex flex-col items-center p-4 pt-20">
<div class="w-full max-w-3xl relative text-center mb-2">
<h1 class="text-4xl font-lora font-bold text-white">About Devotial</h1>
</div>
<div class="flex items-center space-x-2 text-white/80 mb-4 fade-in-up">
<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>
<span>Our Mission, Vision, and the Founder's Journey</span>
</div>
<div class="w-full max-w-3xl glass-card p-8 md:p-12 rounded-2xl relative fade-in-up" style="animation-delay: 0.2s;">
<button id="about-us-menu-btn" class="absolute top-4 left-4 p-2 rounded-md text-orange-200 hover:text-white hover:bg-white/10 transition-colors">
<span class="sr-only">Open Menu</span>
<svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
</svg>
</button>
<!-- Dropdown Menu -->
<div id="about-us-dropdown-menu" class="hidden absolute top-14 left-4 w-48 bg-white/95 backdrop-blur-sm rounded-md shadow-lg z-50">
<div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="about-us-menu-btn">
<a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">About Us</a>
<a href="#" id="customer-service-btn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Customer Service</a>
<a href="#" id="terms-and-conditions-btn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md" role="menuitem">Terms and Conditions</a>
</div>
</div>
<a href="https://form.svhrt.com/68b336cc827c01cec8fdeb3e" target="_blank" rel="noopener noreferrer" id="contact-us-btn" class="absolute top-4 right-4 py-2 px-4 bg-orange-500 text-white font-semibold rounded-lg shadow-md hover:bg-orange-600 transition-colors text-sm">Contact Us</a>
<div class="text-center">
<img src="https://i.postimg.cc/PJPkGxGg/Gemini_Generated_Image-hvncvhvncvhvncvh.png" alt="Devotial Icon" class="mx-auto w-32 h-32 md:w-40 md:h-40 rounded-2xl mb-6 shadow-lg border-4 border-white/50 object-cover">
</div>
<div class="text-white/90 space-y-4 text-lg leading-relaxed text-left mt-8 font-playfair">
<p>Devotial is a SaaS platform dedicated to spirituality and wellness, offering multiple verticals designed to enhance one’s spiritual and religious journey in today’s digital age. We believe technology should support—not replace—the natural essence of spiritual practice.</p>
<p>Born from a simple idea and shaped through experimentation with existing digital tools, Devotial was created to remove barriers for working professionals, students, and anyone who spends much of their day on screens. For them, spiritual practices like meditation and Nam Japa should not feel like an interruption or obstacle. Instead, they should seamlessly blend into daily life.</p>
<p>Devotial is a multi-religious platform, built with respect for all faiths, and integrates advanced tools and digitized methods to bridge the gap between spirituality or religious activity and the increasingly hectic schedules of modern life. Our aim is to ensure that practices once sidelined are now made simple, accessible, and consistent.</p>
<p>Currently in its prototype and beta testing stage, we are integrating meaningful features that allow users to track, sustain, and grow in their practice with ease.</p>
<p>Founded by Nayandeep Talukdar, Devotial is committed to listening to users’ experiences and feedback. The future direction of the platform will be shaped by this valuable input.</p>
<p>We are open to collaborations with brands, NGOs, institutions, and volunteers who share our vision of making spirituality accessible and impactful in the modern world. Together, we can create tools that not only support individual growth but also bring a positive contribution to society.</p>
</div>
<div class="mt-10 pt-8 border-t border-white/30">
<!-- Our Mission -->
<div class="text-center">
<div class="inline-flex items-center justify-center w-16 h-16 mb-4 rounded-full bg-orange-500/20 border-2 border-orange-400/50 text-orange-300">
<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
<path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
</svg>
</div>
<h3 class="font-lora text-3xl font-bold text-white mb-3">Mission</h3>
<p class="text-white/90 text-lg leading-relaxed">To empower individuals to sustain and deepen their spiritual practices through accessible, user-friendly digital tools—bridging the gap between tradition and technology without losing authenticity.</p>
</div>
<!-- Our Vision -->
<div class="text-center mt-12">
<div class="inline-flex items-center justify-center w-16 h-16 mb-4 rounded-full bg-orange-500/20 border-2 border-orange-400/50 text-orange-300">
<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
<path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
<path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
</svg>
</div>
<h3 class="font-lora text-3xl font-bold text-white mb-3">Vision</h3>
<p class="text-white/90 text-lg leading-relaxed">To evolve into a comprehensive spiritual SaaS ecosystem, expanding into multiple verticals including e-commerce for spiritual products, astrological and spiritual consultancy, coaching services, and advanced digital applications. Our vision is to become a trusted partner for individuals on their journey of spiritual progress, while fostering community, accessibility, and impact.</p>
</div>
</div>
</div>
</div>
</div>

<!-- Terms and Conditions View -->
<div id="terms-and-conditions-view" class="hidden view-container">
	<div class="min-h-screen flex flex-col items-center p-4 pt-20">
		<div class="w-full max-w-3xl">
			<button id="back-to-about-btn" class="mb-6 text-white/80 hover:text-white font-semibold">&larr; Back to About Us</button>
			<div class="w-full glass-card p-8 md:p-12 rounded-2xl relative fade-in-up">
				<h1 class="text-3xl font-lora font-bold text-white text-center mb-8">Terms and Conditions</h1>
				<div class="text-white/80 space-y-4 text-base leading-relaxed text-left max-h-[70vh] overflow-y-auto pr-4">
					<p><strong>Last Updated: September 20, 2025</strong></p>
					<p>Welcome to Devotial. These terms and conditions ("Terms") outline the rules and regulations for the use of Devotial's Application ("Service"). By accessing this application, we assume you accept these terms. Do not continue to use Devotial if you do not agree to all of the terms and conditions stated on this page.</p>

					<h2 class="text-xl font-lora font-bold text-white pt-4">1. Respect for All Religions</h2>
					<p>Devotial does not intend to discriminate against any religion. Our primary aim is to bring individuals closer to their respective faiths and practices. Every religion and culture carries its own values, teachings, and integrity that uphold human life. If you are not comfortable with religious content or are sensitive to such matters, we respectfully advise you not to use this platform.</p>

					<h2 class="text-xl font-lora font-bold text-white pt-4">2. Accuracy of Content</h2>
					<p>While we strive to provide accurate and meaningful content, there may be unintentional errors or omissions. We apologize for this and encourage users to reach out for corrections via the Contact Us option available in the About Us section.</p>

					<h2 class="text-xl font-lora font-bold text-white pt-4">3. No Medical or Professional Advice</h2>
					<p>The content and tools provided by Devotial, including the Mental Health and Devotial Guruji features, are for informational and spiritual support purposes only. They are not intended to be a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition.</p>

					<h2 class="text-xl font-lora font-bold text-white pt-4">4. Intellectual Property & Copyright</h2>
					<p>We make every effort to use non-copyrighted or freely available resources. However, if any copyrighted material has been included by mistake, please notify us. Upon verification, we will remove such content promptly.</p>

					<h2 class="text-xl font-lora font-bold text-white pt-4">5. Digital Devotional Features</h2>
					<p>Features such as the “Digital Mandir” are designed solely to create a sense of devotion through digital means. They are not intended to replace physical places of worship. We respect and uphold the eternal value of traditional temples, churches, mosques, gurudwaras, and all other sacred spaces.</p>

					<h2 class="text-xl font-lora font-bold text-white pt-4">6. User Data & Privacy</h2>
					<p>Devotial saves only limited progress data related to the tools you use within the platform. We do not collect personal identifiers such as your real name, voice recordings, or video footage at this time. Please review our Privacy Policy for more details.</p>
					
					<h2 class="text-xl font-lora font-bold text-white pt-4">7. Restrictions on Use</h2>
					<p>All meditation tracks, soundscapes, website content, and other materials created by Devotial are the intellectual property of the platform. Users are not permitted to reproduce, distribute, or use this content outside the platform without prior written permission.</p>

					<h2 class="text-xl font-lora font-bold text-white pt-4">8. Limitation of Liability</h2>
					<p>In no event shall Devotial be liable for any indirect, incidental, special, consequential or punitive damages arising out of your use of or inability to use the Service. The Service is provided on an "AS IS" and "AS AVAILABLE" basis without any warranties of any kind.</p>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Mental Health View -->
<div id="mental-health-view" class="hidden view-container">
<div class="absolute top-0 left-0 w-full h-full -z-10">
<video autoplay loop muted playsinline class="w-full h-full object-cover">
<source src="https://raw.githubusercontent.com/nayantalukdar7777-devotial/bgformentalhealth/main/Video_Editing_Instructions_and_Completion.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>
<div class="absolute inset-0 bg-black/75"></div>
</div>
<div class="min-h-screen w-full flex flex-col items-center justify-center p-4 pt-24 relative">
<!-- Sound Icon and Dropdown Menu Container -->
<div class="absolute top-20 right-4 z-50">
<button id="soundButton" class="p-2 rounded-full bg-white bg-opacity-90 border-2 border-green-500 text-green-500 transition-all duration-300 hover:bg-opacity-100 hover:text-green-600 focus:outline-none focus:ring-2 focus:ring-green-500">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-music">
<path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/>
</svg>
</button>

<div id="soundDropdown" class="dropdown-menu">
<div class="dropdown-item" data-src="https://raw.githubusercontent.com/nayantalukdar7777-devotial/breathmusics/main/a-promise(chosic.com).mp3">Calming Breath Music</div>
<div class="dropdown-item" data-src="https://raw.githubusercontent.com/nayantalukdar7777-devotial/breathmusic2/main/gentle-rain-for-relaxation-and-sleep-337279.mp3">Rainy Day Calm</div>
<div class="dropdown-item" data-src="">Turn Off Music</div>
</div>
<audio id="bgAudio" loop></audio>
</div>

<!-- Main Content Container -->
<div id="mainContent" class="flex flex-col items-center justify-center p-6 sm:p-10 text-center max-w-lg w-full">
<h1 class="text-6xl font-lora font-bold text-white mb-4">Devotial Mental Health</h1>
<h2 id="mainTitle" class="text-4xl font-extrabold mb-8 fancy-heading-font text-white perpetual-glow">Find Your Inner Calm</h2>

<!-- Quote Display Container -->
<div id="quoteContainer" class="quote-container flex items-center justify-center mb-8 opacity-100">
<p id="quoteDisplay" class="text-white italic text-sm sm:text-base text-center">Devotial is your digital companion, supporting the upliftment of your soul and guiding you toward greater awareness and mental clarity.</p>
</div>

<!-- Main Breathing UI -->
<div class="relative w-48 h-48 sm:w-64 sm:h-64 flex items-center justify-center mb-6">
<div id="breathingCircle" class="w-full h-full gradient-border">
<div class="w-full h-full circle flex items-center justify-center">
<span id="instruction" class="text-3xl sm:text-4xl font-bold">Ready?</span>
</div>
</div>
</div>

<!-- Controls -->
<div class="flex flex-col space-y-4 w-full max-w-xs">
<div id="patternButtons" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
<button data-pattern="grounding" class="pattern-btn py-3 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105">
Grounding Breath
</button>
<button data-pattern="box" class="pattern-btn py-3 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105">
Box Breathing
</button>
<button data-pattern="4-7-8" class="pattern-btn py-3 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105">
4-7-8 Breathing
</button>
<button data-pattern="1-2-ratio" class="pattern-btn py-3 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105">
1:2 Ratio
</button>
</div>
<button id="toggleBtn" class="start-btn-style font-bold text-lg py-4 rounded-lg shadow-lg transition-all duration-200 transform hover:scale-105 active:scale-100">
Start
</button>
</div>
</div>
</div>
</div>

<!-- Daily Karma Score View -->
<div id="punya-calculator-view" class="hidden view-container">
<div class="min-h-screen w-full flex flex-col items-center justify-center p-4 pt-24">
<div class="w-full max-w-3xl guruji-premium-container relative p-6 md:p-8 rounded-2xl">

<div class="absolute top-6 right-6">
<button id="add-daily-task-icon-btn" class="p-2 rounded-full bg-white/10 text-orange-300 hover:bg-white/20 transition-all duration-300" title="Add Custom Task">
<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
<path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
</svg>
</button>
</div>

<h1 class="font-lora text-4xl font-bold text-white text-center mb-2">Daily Karmic Score</h1>

<div id="punya-calc-clock" class="text-center mb-6 pb-4 border-b border-orange-400/30">
<p class="text-lg font-semibold text-white" id="calc-punya-date-display"></p>
<p class="text-5xl md:text-6xl font-bold text-white font-mono" id="calc-punya-time-display"></p>
</div>

<p class="text-orange-100/80 text-center mb-8">Reflect on your day and answer the questions below to estimate your spiritual merits.</p>

<div id="punya-questions-container" class="space-y-6">
<!-- Predefined actions will be dynamically injected here by JavaScript -->
</div>

<div id="custom-tasks-container" class="mt-6">
<div id="custom-tasks-list" class="space-y-6">
<!-- Custom tasks will be injected here -->
</div>
</div>

<div class="text-center mt-10">
<button id="calculate-punya-btn" class="py-3 px-8 bg-gradient-to-r from-orange-500 to-amber-600 text-white font-bold rounded-lg shadow-lg shadow-orange-500/30 hover:scale-105 hover:shadow-xl hover:shadow-orange-500/40 transform transition-all duration-300">
Calculate Today's Score
</button>
</div>
<div id="punya-result-container" class="mt-8 text-center hidden">
<p class="text-orange-100/80">Your estimated Karmic score for today is:</p>
<p id="punya-score" class="text-5xl font-bold text-yellow-300 mt-2" style="text-shadow: 0 0 10px rgba(253, 224, 71, 0.7);"></p>
<p class="text-sm text-white/70 mt-2">Score has been added to your dashboard.</p>
</div>
</div>
</div>
</div>

<!-- Add Task Modal -->
<div id="add-task-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
<div class="bg-gray-800 border border-orange-400/30 text-white rounded-2xl shadow-2xl w-full max-w-sm p-6 scale-in-anim">
<div class="flex justify-between items-center mb-4">
<h3 class="text-xl font-bold text-orange-300">Add a Daily Task</h3>
<button id="close-add-task-modal-btn" class="text-gray-400 hover:text-white text-2xl leading-none">&times;</button>
</div>
<input type="text" id="new-task-input" class="w-full bg-gray-900/50 text-white placeholder-gray-400 border border-gray-600 rounded-md p-2 focus:ring-orange-500 focus:border-orange-500" placeholder="Enter your task description...">
<div class="flex justify-between items-center mt-3">
<p id="task-limit-message" class="text-sm text-gray-400">Up to 7 custom tasks allowed.</p>
<button id="save-task-btn" class="py-2 px-5 bg-orange-500 text-white font-bold rounded-lg hover:bg-orange-600 transition-colors">Save Task</button>
</div>
</div>
</div>

<!-- Karma Info Modal -->
<div id="karma-info-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
<div class="bg-gray-800 border border-orange-400/30 text-white rounded-2xl shadow-2xl w-full max-w-sm p-6 text-center scale-in-anim">
<h3 id="karma-info-modal-title" class="text-xl font-bold text-orange-300 mb-2">Action Information</h3>
<p id="karma-info-modal-content" class="text-white/80 mt-2"></p>
<div class="mt-6">
<button id="karma-info-modal-close-btn" class="w-full py-2 px-4 bg-orange-500 text-white font-semibold rounded-lg hover:bg-orange-600 transition-colors">Close</button>
</div>
</div>
</div>

<!-- Karma Redirect Modal -->
<div id="karma-redirect-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
<div class="bg-gray-800 border border-orange-400/30 text-white rounded-2xl shadow-2xl w-full max-w-sm p-6 text-center scale-in-anim">
<h3 class="text-xl font-bold text-orange-300">A Gentle Reminder</h3>
<p id="karma-redirect-message" class="text-white/80 mt-2"></p>
<div class="flex gap-4 mt-6">
<button id="close-karma-redirect-modal" class="w-full py-2 px-4 bg-white/10 text-white font-semibold rounded-lg hover:bg-white/20 transition-colors">Close</button>
<button id="karma-redirect-btn" class="w-full py-2 px-4 bg-orange-500 text-white font-semibold rounded-lg hover:bg-orange-600 transition-colors">Go to Page</button>
</div>
</div>
</div>

</div>

<!-- Devotial Guruji View -->
<div id="guruji-view" class="hidden view-container">
<!-- This container now holds the entire chat experience -->
<div id="chat-page-container" class="w-full h-full flex items-center justify-center p-4 pt-20">

<!-- The main glassy container that holds both welcome and chat views -->
<div class="guruji-premium-container rounded-2xl shadow-2xl w-full max-w-2xl h-[90vh] max-h-[700px] flex flex-col">

<!-- =================================================================== -->
<!-- WELCOME VIEW (Shown initially) -->
<!-- =================================================================== -->
<div id="welcome-view" class="flex flex-col items-center justify-center text-white text-center h-full p-8">
<div class="w-24 h-24 rounded-full mb-4 border-4 border-orange-400/50 overflow-hidden">
<img src="https://i.postimg.cc/htVDxvJK/Chat-GPT-Image-Sep-8-2025-08-45-38-PM.png" alt="Acharya Omkarananda" class="w-full h-full object-cover">
</div>
<h1 class="text-3xl font-bold tracking-wider font-lora">Devotial</h1>
<h2 class="text-xl font-medium mt-2 tracking-wide font-lora">Acharya Omkarananda</h2>
<p class="mt-3 text-orange-100/90">(Seek wisdom and guidance on your spiritual path)</p>
<button id="start-chat-btn" class="mt-8 bg-gradient-to-r from-orange-500 to-amber-600 text-white font-bold py-3 px-8 rounded-full shadow-lg shadow-orange-500/30 hover:scale-105 hover:shadow-xl hover:shadow-orange-500/40 transform transition-all duration-300">
Start Chat
</button>
</div>

<!-- =================================================================== -->
<!-- CHAT VIEW (Hidden initially, takes over the glassy box) -->
<!-- =================================================================== -->
<div id="chat-view" class="hidden h-full flex flex-col">
<!-- Header -->
<div class="text-orange-100 p-3 flex justify-between items-center flex-shrink-0 border-b border-orange-400/30">
<div class="flex items-center space-x-3">
<h3 class="font-bold">Acharya Omkarananda</h3>
<span class="w-2.5 h-2.5 bg-green-500 rounded-full animate-pulse" title="Online"></span>
</div>
<div class="flex items-center space-x-4">
<div class="text-xs text-green-300 flex items-center space-x-1.5">
<svg class="w-2 h-2 text-green-400" fill="currentColor" viewBox="0 0 8 8">
<circle cx="4" cy="4" r="4"/>
</svg>
<span id="user-count">576 Users are chatting</span>
</div>
<button id="close-btn" class="hover:bg-white/20 rounded-full p-1" title="End Chat">
<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
</button>
</div>
</div>
<!-- Message List -->
<div id="message-list" class="flex-1 p-4 overflow-y-auto">
<!-- Messages will be dynamically added here -->
</div>
<!-- Typing indicator -->
<div id="typing-indicator" class="p-4 hidden flex-shrink-0">
<div class="flex items-end">
<div class="w-8 h-8 rounded-full mr-3 flex-shrink-0 overflow-hidden">
<img src="https://i.postimg.cc/htVDxvJK/Chat-GPT-Image-Sep-8-2025-08-45-38-PM.png" alt="Guru" class="w-full h-full object-cover">
</div>
<div class="bot-bubble p-3 rounded-lg">
<div class="typing-indicator">
<span></span><span></span><span></span>
</div>
</div>
</div>
</div>
<!-- Input Form -->
<div class="p-4 border-t border-orange-400/30 flex-shrink-0">
<form id="chat-form" class="flex items-center">
<input type="text" id="message-input" placeholder="Ask a question..." autocomplete="off" class="flex-1 bg-gray-800/50 border border-orange-400/20 text-white placeholder-orange-100/70 rounded-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
<button type="submit" class="ml-3 bg-orange-500 text-white rounded-full p-2 hover:bg-orange-600 transition-colors">
<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7" /></svg>
</button>
</form>
</div>
</div>

</div>
</div>
</div>

<!-- Veda Verse View -->
<div id="veda-verse-view" class="hidden view-container">
<div class="min-h-screen w-full flex flex-col items-center justify-center p-4 pt-24">
<!-- Main Content Container -->
<main id="veda-main-content" class="w-full max-w-4xl mx-auto text-center transition-opacity duration-500 ease-in-out">
<div id="veda-intro-view">
<h1 class="text-5xl md:text-7xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-orange-300 via-orange-400 to-amber-500 mb-4 font-serif">Devotional Veda Verse</h1>
<h2 class="text-2xl md:text-3xl font-serif text-orange-200/80 mb-8">Todays dharma intention</h2>
<p class="text-lg md:text-xl text-orange-100/70 mb-12 max-w-2xl mx-auto">Tap the sacred symbol to seek wisdom from the ancient scriptures.</p>
<div id="veda-open-modal-button" class="glow-box cursor-pointer bg-black/30 backdrop-blur-sm border border-orange-400/30 rounded-lg p-10 md:p-16 inline-flex flex-col items-center justify-center">
<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="text-orange-400 mb-4">
<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
<path d="M12 6v12M6 12h12"/>
<path d="M12 12c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm0 0c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4z"/>
</svg>
<span class="text-xl font-medium text-orange-200">Reveal Wisdom</span>
</div>
</div>

<!-- Result View - Hidden by default -->
<div id="veda-result-view" class="hidden">
<!-- Content will be injected here by JavaScript -->
</div>
</main>

<!-- Modal -->
<div id="veda-selection-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
<!-- Backdrop -->
<div id="veda-modal-backdrop" class="fixed inset-0 bg-black/80 backdrop-blur-sm"></div>

<!-- Modal Content -->
<div id="veda-modal-content-box" class="modal-content relative bg-gray-900/70 border border-orange-500/30 rounded-2xl shadow-2xl shadow-orange-900/50 w-full max-w-lg p-8 transform opacity-0 scale-95">
<h2 class="text-3xl font-serif text-center mb-2 text-orange-300">Seek Your Path</h2>
<p class="text-center text-orange-200/60 mb-8">Choose the wisdom you wish to contemplate.</p>

<div class="space-y-6">
<div>
<label for="veda-category" class="block text-sm font-medium text-orange-200/80 mb-2">1. What do you want to see today?</label>
<select id="veda-category" class="w-full bg-gray-800/50 border border-orange-400/20 text-white rounded-lg px-4 py-3 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition duration-200">
<option>Verses & Hymns</option>
<option>Stories & Epics</option>
<option>Concepts & Philosophy</option>
<option>Practical Guidance</option>
<option>Devotion & Rituals</option>
<option>Ethics & Morality</option>
</select>
</div>
<div>
<label for="veda-scripture" class="block text-sm font-medium text-orange-200/80 mb-2">2. From which Hindu Scripts?</label>
<select id="veda-scripture" class="w-full bg-gray-800/50 border border-orange-400/20 text-white rounded-lg px-4 py-3 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition duration-200">
<option>Any</option>
<option>Bhagavad Gita</option>
<option>Upanishads</option>
<option>Rigveda</option>
<option>Samaveda</option>
<option>Yajurveda</option>
<option>Atharvaveda</option>
<option>Ramayana</option>
<option>Mahabharata</option>
<option>Vishnu Purana</option>
<option>Shiva Purana</option>
<option>Bhagavata Purana</option>
</select>
</div>
</div>

<div class="mt-10 text-center">
<button id="veda-reveal-button" class="bg-gradient-to-r from-orange-500 to-amber-600 text-white font-bold py-3 px-10 rounded-lg shadow-lg shadow-orange-500/30 hover:scale-105 hover:shadow-xl hover:shadow-orange-500/40 transform transition-all duration-300">
Reveal
</button>
</div>

<!-- Close button -->
<button id="veda-close-modal-button" class="absolute top-4 right-4 text-gray-400 hover:text-orange-300 transition-colors">
<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
</svg>
</button>
</div>
</div>
</div>
</div>

<div id="target-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden"><div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 text-center scale-in-anim"><h3 class="text-xl font-bold text-gray-800">Set Your Daily Target</h3><div class="text-left my-4 space-y-4"><div><label for="mala-target-select" class="block text-sm font-medium text-gray-700">Mala Jap</label><select id="mala-target-select" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500"><option value="1">1 Mala (108 Chants)</option><option value="2">2 Malas (216 Chants)</option><option value="3">3 Malas (324 Chants)</option><option value="4">4 Malas (432 Chants)</option><option value="5">5 Malas (540 Chants)</option><option value="6">6 Malas (648 Chants)</option><option value="7">7 Malas (756 Chants)</option><option value="8">8 Malas (864 Chants)</option><option value="9">9 Malas (972 Chants)</option><option value="10">10 Malas (1080 Chants)</option><option value="11">11 Malas (1188 Chants)</option></select></div><div><label for="chant-target-input" class="block text-sm font-medium text-gray-700">Number of Chants</label><input type="text" id="chant-target-input" value="108" class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-gray-100 rounded-md shadow-sm" readonly></div></div><div class="flex gap-4 mt-6"><button id="cancel-target-btn" class="w-full py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors">Cancel</button><button id="confirm-target-btn" class="w-full py-2 px-4 bg-orange-500 text-white font-semibold rounded-lg hover:bg-orange-600 transition-colors">Confirm</button></div></div></div>
<div id="confirmation-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden"><div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 text-center"><h3 class="text-xl font-bold text-gray-800">Are you sure?</h3><p class="text-gray-600 mt-2">You will lose all your progress records. This action cannot be undone.</p><div class="flex gap-4 mt-6"><button id="cancel-clear-btn" class="w-full py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors">Cancel</button><button id="confirm-clear-btn" class="w-full py-2 px-4 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition-colors">Yes, Clear All</button></div></div></div>
<div id="achievement-toast" class="fixed inset-0 z-50 flex items-center justify-end p-4 pointer-events-none hidden">
<div id="achievement-toast-content" class="bg-gradient-to-br from-green-400 to-teal-500 text-white p-4 rounded-xl shadow-2xl flex items-center space-x-4 w-full max-w-sm pointer-events-auto">
<div><i class="gg-award" style="--ggs:2"></i></div>
<div id="toast-message" class="flex-1"></div>
</div>
</div>
<div id="target-complete-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden"><div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-8 text-center confetti-background scale-in-anim"><div class="w-16 h-16 mx-auto bg-green-100 rounded-full flex items-center justify-center"><svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div><h3 class="text-2xl font-bold text-gray-800 mt-4">Target Complete!</h3><p class="text-gray-600 mt-2">Well done on completing your daily goal. Your dedication is inspiring!</p></div></div>

<!-- Meditation Timer Modal -->
<div id="meditation-timer-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
<div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 text-center scale-in-anim">
<h3 class="text-xl font-bold text-gray-800">Set Meditation Time</h3>
<p class="text-gray-600 mt-2">Set a countdown timer for your session.</p>
<div class="my-6">
<input type="range" id="meditation-time-slider" min="1" max="60" value="10" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mb-2">
<p class="text-center font-bold text-2xl text-gray-800 mt-2"><span id="meditation-time-label">10</span> minutes</p>
</div>
<div class="flex gap-4 mt-6">
<button id="cancel-meditation-timer-btn" class="w-full py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors">Cancel</button><button id="confirm-meditation-timer-btn" class="w-full py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors">Set</button>
</div>
</div>
</div>

<!-- Meditation Completion Flash -->
<div id="meditation-complete-flash" class="fixed inset-0 z-20 flex items-center justify-center bg-black/50 backdrop-blur-sm hidden">
<div class="text-center bg-white/90 p-8 rounded-2xl shadow-2xl">
<h2 id="flash-title" class="text-3xl font-bold text-green-600">Meditation Complete!</h2>
<p id="flash-details" class="mt-2 text-gray-700"></p>
</div>
</div>

<!-- Pre-Meditation Flash -->
<div id="pre-meditation-flash" class="fixed inset-0 z-30 flex items-center justify-center bg-black/60 backdrop-blur-md hidden">
<div class="text-center bg-white/95 p-8 rounded-2xl shadow-2xl max-w-sm mx-4 scale-in-anim">
<svg class="w-16 h-16 mx-auto text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
<h2 class="text-2xl font-bold text-gray-800 mt-4">Prepare for Meditation</h2>
<p class="text-gray-600 mt-2">The session will begin shortly. Please take your position and calm yourself. Happy meditating!</p>
</div>
</div>

<!-- Music Player -->
<button id="music-fab" class="fixed bottom-5 right-5 z-40 w-14 h-14 bg-gradient-to-br from-orange-500 to-amber-600 rounded-full shadow-lg flex items-center justify-center text-white hover:scale-110 transition-transform hidden">
<svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-13c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2z" /></svg>
</button>
<div id="music-sidebar" class="fixed top-0 right-0 h-full w-80 bg-white/95 backdrop-blur-lg shadow-2xl z-50 p-6 flex flex-col music-sidebar">
<button id="close-music-sidebar" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800">
<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
</button>
<div class="text-center mt-4">
<img src="https://i.postimg.cc/QCDfdmf3/6b27d8a33e9e1ba989551786f61445db.jpg" alt="Meditation Icon" class="w-32 h-32 mx-auto rounded-full shadow-lg border-4 border-white object-cover">
<p class="font-playfair italic text-gray-600 mt-6 px-4">"Naam Japa is the fire that burns sins, the lamp that lights wisdom, and the path that leads the soul home."</p></div>
<div class="mt-auto">
<div class="text-center mb-2">
<p id="track-title" class="font-bold text-gray-800">Nam Japa Deep Concentration</p>
</div>
<input type="range" id="music-progress" class="w-full h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer" value="0" step="1" min="0">
<div class="flex justify-between text-xs font-mono text-gray-500 mt-1">
<span id="current-time">00:00</span>
<span id="total-duration">00:00</span>
</div>
<div class="flex items-center justify-center mt-4">
<audio id="audio-player" loop></audio>
<button id="play-pause-btn" class="w-14 h-14 bg-purple-500 text-white rounded-full flex items-center justify-center shadow-md hover:bg-purple-600 transition-colors">
<svg id="play-icon" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
<svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6" /></svg>
</button>
</div>
</div>
</div>

<!-- Prayer Session Modal -->
<div id="prayer-modal" class="fixed inset-0 prayer-modal-backdrop hidden flex items-center justify-center p-4">
<div class="prayer-modal-content w-full max-w-md mx-auto p-6 rounded-3xl text-white">
<h3 class="text-2xl font-bold text-center mb-6">Start Your Prayer</h3>
<form id="prayer-form" class="space-y-4">
<div>
<label for="devotee-name" class="block text-sm font-medium text-white/80">Name of Devotee</label>
<input type="text" id="devotee-name" maxlength="20" placeholder="e.g., Shiva Bhakt" class="mt-1 block w-full bg-white/20 text-white placeholder-white/50 border border-white/30 rounded-lg py-2 px-3 focus:outline-none focus:ring-1 focus:ring-white">
</div>
<div>
<label for="intention-type" class="block text-sm font-medium text-white/80">Please select your intention type</label>
<select id="intention-type" class="mt-1 block w-full bg-white/20 text-white border border-white/30 rounded-lg py-2 px-3 focus:outline-none focus:ring-1 focus:ring-white">
<option value="pray" class="bg-gray-800 text-white">Pray to God</option>
<option value="thank" class="bg-gray-800 text-white">Thank to God</option>
<option value="speak" class="bg-gray-800 text-white">Let my heart speak to God</option>
</select>
</div>
<div>
<label for="intention-text" class="block text-sm font-medium text-white/80">Write your intention or wish (optional)</label>
<textarea id="intention-text" maxlength="100" placeholder="e.g., May my family be healthy and happy" rows="3" class="mt-1 block w-full bg-white/20 text-white placeholder-white/50 border border-white/30 rounded-lg py-2 px-3 focus:outline-none focus:ring-1 focus:ring-white"></textarea>
</div>
<button type="submit" id="proceed-pray-btn" class="w-full py-3 px-4 bg-orange-500 text-white font-semibold rounded-lg shadow-md hover:bg-orange-600 transition-colors">
Proceed and Pray
</button>
</form>
</div>
</div>

<!-- Punya Redirect Modal -->
<div id="punya-redirect-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
<div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 text-center scale-in-anim">
<h3 class="text-xl font-bold text-gray-800">Reminder</h3>
<p id="punya-redirect-message" class="text-gray-600 mt-2"></p>
<div class="flex gap-4 mt-6">
<button id="close-punya-redirect-modal" class="w-full py-2 px-4 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors">Close</button>
<button id="punya-redirect-btn" class="w-full py-2 px-4 bg-orange-500 text-white font-semibold rounded-lg hover:bg-orange-600 transition-colors">Go to Page</button>
</div>
</div>
</div>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, query, where, getDocs, writeBatch, increment, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-japa-app-final';

let firebaseConfigString;
const loadingSpinner = document.getElementById('loading-spinner');
let loadingTimeout;

if (typeof __firebase_config !== 'undefined') {
firebaseConfigString = __firebase_config;
} else {
// Fallback for running outside the intended environment
firebaseConfigString = JSON.stringify({
apiKey: "AIzaSyDaqodrqBYRfeEkQU0L7LC1t0n-8mqIzHw",
authDomain: "nam-japa-re.firebaseapp.com",
projectId: "nam-japa-re",
storageBucket: "nam-japa-re.firebasestorage.app",
messagingSenderId: "1043905833114",
appId: "1:1043905833114:web:b209e3dbb0488309665723",
measurementId: "G-TKCP3KRXY0"
});
}

initializeAppCore();

async function initializeAppCore() {
const achievements = {
lifetime: [
{ threshold: 108, title: "Jap Sādhak", desc: "Seeker of Japa", icon: `<img src="https://i.postimg.cc/GpFL0FyT/unnamed-1.png" class="w-8 h-8" alt="Jap Sādhak Icon">` },
{ threshold: 540, title: "Nāma Vratī", desc: "Disciplined in the Divine Name", icon: `<img src="https://i.postimg.cc/QN5Rf8cV/Gemini_Generated_Image-oaqixaoaqixaoaqi.png" class="w-8 h-8" alt="Nāma Vratī Icon">` },
{ threshold: 1188, title: "Mantra Dīpta", desc: "Illuminated by the Mantra", icon: `<img src="https://i.postimg.cc/L8y7JnFQ/Gemini_Generated_Image-oaqixaoaqixaoaqi-1.png" class="w-8 h-8" alt="Mantra Dīpta Icon">` },
{ threshold: 5400, title: "Bhakti Ratna", desc: "Gem of Devotion", icon: `<img src="https://i.postimg.cc/9MByfwvr/Gemini_Generated_Image-oaqixaoaqixaoaqi-2.png" class="w-8 h-8" alt="Bhakti Ratna Icon">` },
{ threshold: 10800, title: "Nāma Siddha", desc: "Perfected in the Divine Name", icon: `<img src="https://i.postimg.cc/XJNpQHzY/Gemini_Generated_Image-oaqixaoaqixaoaqi-4.png" class="w-8 h-8" alt="Nāma Siddha Icon">` },
{ threshold: 27000, title: "Nāma Yogi", desc: "One United with the Divine Name", icon: `<img src="https://i.postimg.cc/cJtSZQtB/Gemini_Generated_Image-7p5r827p5r827p5r.png" class="w-8 h-8" alt="Nāma Yogi Icon">` }
],
daily: [
{ threshold: 108, title: "Dina-Sādhak", desc: "Daily Practitioner", icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-cyan-500" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/></svg>` },
{ threshold: 1188, title: "Dina-Tapasvī", desc: "Daily Ascetic of Japa", icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-indigo-500" viewBox="0 0 24 24" fill="currentColor"><path d="M4.5 11.25c.62 0 1.12.5 1.12 1.12s-.5 1.12-1.12 1.12-1.12-.5-1.12-1.12.5-1.12 1.12-1.12zm0-4.5c.62 0 1.12.5 1.12 1.12S5.12 9 4.5 9s-1.12-.5-1.12-1.12.5-1.12 1.12-1.12zM9 13.5c0-.62-.5-1.12-1.12-1.12s-1.12.5-1.12 1.12.5 1.12 1.12 1.12S9 14.12 9 13.5zm0-4.5c0-.62-.5-1.12-1.12-1.12S6.75 8.38 6.75 9s.5 1.12 1.12 1.12S9 9.62 9 9zm6.75-1.12c.62 0 1.12.5 1.12 1.12s-.5 1.12-1.12 1.12-1.12-.5-1.12-1.12.5-1.12 1.12-1.12zm0 4.5c.62 0 1.12.5 1.12 1.12s-.5 1.12-1.12 1.12-1.12-.5-1.12-1.12.5-1.12 1.12-1.12zm-4.5 3.38c.62 0 1.12.5 1.12 1.12s-.5 1.12-1.12 1.12-1.12-.5-1.12-1.12.5-1.12 1.12-1.12zm0-4.5c.62 0 1.12.5 1.12 1.12s-.5 1.12-1.12 1.12-1.12-.5-1.12-1.12.5-1.12 1.12-1.12z"/></svg>` }
]
};
const blogPosts = {
'post1': { title: 'The Power of Meditation: A Journey Within', excerpt: 'In today’s fast-moving world, our minds are often overwhelmed with endless thoughts, notifications, and responsibilities...', content: `<h1 class="font-lora text-4xl font-extrabold mb-6 text-center">The Power of Meditation: A Journey Within</h1><div class="clearfix"><img src="https://i.postimg.cc/vHy6dw9h/877241.jpg" alt="Meditating Figure Icon" class="float-left mr-6 mb-4 max-w-full h-auto rounded-lg shadow-md border-2 border-white object-cover"><p>In today’s fast-moving world, our minds are often overwhelmed with endless thoughts, notifications, and responsibilities. Amidst this constant noise, meditation offers a rare pause — a chance to breathe, reconnect, and find balance.</p><p><strong>What is Meditation?</strong></p><p>At its core, meditation is the practice of training the mind to be still, aware, and present. It’s not about “emptying the mind,” but about observing thoughts without judgment and gently guiding attention back to the present moment. For centuries, spiritual seekers, monks, and yogis have used meditation as a tool for inner growth. Today, science also confirms its benefits for mental, emotional, and even physical well-being.</p></div><p><strong>Benefits of Meditation</strong></p><ul><li><strong>Reduces Stress & Anxiety</strong> – Meditation lowers cortisol levels, helping you manage stress.</li><li><strong>Improves Focus</strong> – Regular practice sharpens attention and boosts productivity.</li><li><strong>Emotional Balance</strong> – It cultivates calmness, patience, and better self-awareness.</li><li><strong>Better Sleep</strong> – Mindful breathing relaxes the nervous system, leading to deeper rest.</li><li><strong>Spiritual Growth</strong> – Beyond health, meditation deepens self-connection and awareness of the divine.</li></ul><p><strong>Simple Ways to Start Meditation</strong></p><ul><li><strong>Find a Quiet Spot</strong> – Sit comfortably in a calm environment.</li><li><strong>Focus on Breath</strong> – Inhale deeply, exhale slowly. Let your breath anchor you.</li><li><strong>Start Small</strong> – Begin with 5–10 minutes daily and gradually increase.</li><li><strong>Use a Mantra or Name Chanting</strong> – Repeating a sacred word or phrase (like Om or a divine name) can deepen concentration.</li><li><strong>Stay Consistent</strong> – The benefits unfold over time with regular practice.</li></ul><p><strong>Meditation in Spiritual Practice</strong></p><p>For many, meditation goes hand in hand with Naam Japa (chanting the divine name). While meditation trains the mind to focus inward, Japa uses repetition to align thoughts with the sacred. Together, they create a powerful path for both inner peace and spiritual progress. Meditation is not an escape from life — it’s a way to experience life more fully. Whether you’re seeking stress relief, better focus, or a deeper spiritual connection, meditation is a timeless practice that meets you where you are. All it takes is a few minutes each day to begin the journey within.</p>`},
'post2': { title: 'Why We Do Naam Japa — As Explained by Shri Hit Premanand Ji Maharaj', excerpt: 'Chanting the holy name, or Naam Japa, is considered the heart of spiritual practice in the bhakti tradition...', content: `<h1 class="font-lora text-4xl font-extrabold mb-6 text-center">Why We Do Naam Japa — As Explained by Shri Hit Premanand Ji Maharaj</h1><div class="clearfix"><img src="https://i.postimg.cc/YSrNBpPn/Shri-Hit-Premanand-Govind-Sharan-Ji-Maharaj-002-year-2023-cropped.jpg" alt="Shri Hit Premanand Ji Maharaj" class="float-left mr-6 mb-2 w-32 h-32 rounded-lg shadow-md border-2 border-white object-cover"><p>Chanting the holy name, or Naam Japa, is considered the heart of spiritual practice in the bhakti tradition. Shri Hit Premanand Ji Maharaj often reminds us that the divine Name is not ordinary sound. It carries within itself a power that transforms, purifies, and uplifts the soul in ways that no other practice can.</p><p>Maharaj Ji explains that the holy Name works just like fire. Fire burns whether you touch it knowingly or unknowingly; in the same way, chanting the Name has its effect whether we do it with full concentration or in distraction, with deep emotion or in a casual mood. The Name carries its own inherent divinity, and by repeating it, our sins and impurities naturally burn away.</p></div><p>This is why Naam Japa is considered more powerful than pilgrimages or penances. One may travel to holy places, perform rituals, or take up austerities, but all of these still fall short of the simple act of chanting God’s Name. It is the highest penance, the holiest pilgrimage, and the most accessible path—open to everyone, everywhere.</p><p>Yet Naam Japa does more than just cleanse. Over time, it begins to awaken something deeper: divine love and wisdom. As one continues chanting, devotion starts to blossom in the heart. The mind becomes steady, wisdom arises, and the soul begins to feel the presence of God in all aspects of life. Maharaj Ji beautifully describes how this practice gradually leads to a direct experience of the divine.</p><p>In fact, he has even outlined how chanting in large numbers brings about specific inner transformations. With fifty million chants, intelligence and spiritual wisdom awaken. Seventy million chants bring purity and protect from worldly distractions. At eighty million chants, fear of death itself dissolves and the soul becomes firmly rooted in truth. Ninety million chants can grant a tangible vision of the divine, where whatever the devotee speaks begins to manifest. At one hundred million, all karmas are burned away. By the time one reaches one hundred and ten to one hundred and thirty million repetitions, the soul is lifted into divine play itself, attaining mastery over spiritual faculties and even granting liberation not only for oneself but also for others.</p><p>This progression shows how Naam Japa is not just symbolic or ritualistic—it is a living, measurable path of transformation. But even without counting, the simple act of repeating the Name daily works like meditation. Devotees often describe how overthinking slows down, negative thoughts fade, and a quiet strength emerges in the heart. The Name becomes a companion, a source of spiritual energy that keeps guiding one forward.</p><p>In the end, the teaching is simple: there is nothing equal to chanting the holy Name. Whether you do it quietly in your heart, aloud with a group, or silently while working, what matters most is the sincerity of your heart. The Name carries you, protects you, purifies you, and ultimately reveals to you the presence of God Himself.</p><div class="mt-10 pt-4 border-t border-white/30"><p class="font-bold">Sources:</p><ul><li><a href="https://bhajanmarg.com/en/faqs-on-naam-jap/?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">Bhajan Marg – FAQs on Naam Japa</a></li><li><a href="https://bhajanmarg.com/en/how-much-chanting-of-holy-name-to-fulfill-desires/?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">Bhajan Marg – How Much Japa to Fulfill Desires</a></li><li><a href="https://www.thedailyjagran.com/spiritual/10-million-to-130-million-how-much-naam-jaap-or-chanting-can-help-fulfil-your-desires-premanand-ji-maharaj-explains-10237942?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">The Daily Jagran – Premanand Ji Maharaj Explied</a></li><li><a href="https://www.reddit.com/r/hinduism/comments/1mes2pw/regarding_naam_jap_practice_by_premanand-ji/?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">Reddit Discussion on Japa</a></li></ul></div>`},
'post3': { title: 'How an Online Naam Japa Counter Helps You Stay Consistent', excerpt: 'Chanting the holy Name every day is one of the simplest and most powerful practices a devotee can take up...', content: `<h1 class="!text-white font-lora text-4xl font-extrabold mb-6 text-center">How an Online Naam Japa Counter Helps You Stay Consistent</h1><div class="clearfix"><img src="https://i.postimg.cc/gJD2FWfD/Gemini_Generated_Image-poz69wpoz69wpoz6.png" alt="Online Japa Counter" class="float-left mr-6 mb-4 w-64 h-64 rounded-lg shadow-md border-2 border-white object-cover"><p>Chanting the holy Name every day is one of the simplest and most powerful practices a devotee can take up. But anyone who has tried to keep a steady count knows how difficult it can get—sometimes the mind wanders, sometimes we lose track, and sometimes we simply forget how much we have done. That’s where an Internet-based Naam Japa Counter can become a devotee’s gentle companion.</p><p>By using an online counter, the devotee no longer has to struggle with mental calculations or worry about missing the daily target. Each chant is counted automatically, and the progress is stored safely. Whether on a phone, laptop, or tablet, the counter keeps a strict and transparent record. This makes it easy to fulfill one’s daily commitment without distraction.</p></div><p>The benefit of such a tool is not only convenience but also discipline. When the numbers are tracked clearly, the devotee feels encouraged to complete the goal, just like a spiritual diary that holds one accountable. Over time, this habit strengthens consistency, turning Naam Japa into a steady part of everyday life.</p><p>In the end, an online counter does not replace devotion—it simply makes the path lighter to walk. By taking care of the numbers, it frees the heart to focus fully on what truly matters: the sweetness of chanting the Lord’s Name.</p>`},
'post4': { title: 'The Timeless Power of Naam Japa', excerpt: 'Naam Japa literally means “repetition of the Name.” It can be done silently in the mind, softly on the lips, or aloud with devotion...', content: `<h1 class="font-lora text-4xl font-extrabold mb-6 text-center">The Timeless Power of Naam Japa</h1><div class="clearfix"><img src="https://i.postimg.cc/g0hmbtCk/Benefits-Of-Naam-Japa.png" alt="Benefits of Naam Japa" class="float-left mr-6 mb-2 w-48 h-auto rounded-lg shadow-md border-2 border-white"><p><strong>What is Naam Japa?</strong></p><p>Naam Japa literally means “repetition of the Name.” It can be done silently in the mind, softly on the lips, or aloud with devotion. Just as fire burns whether we touch it knowingly or unknowingly, the holy Name purifies whether we chant with full focus or with a wandering mind. The power lies in the Name itself.</p><p><strong>Benefits of Naam Japa</strong></p><p>The benefits of chanting God’s Name daily go far beyond ritual. According to scriptures and saints:</p><ul><li>It burns sins and cleanses the heart.</li><li>It is considered the highest penance and holiest pilgrimage.</li><li>Daily chanting awakens peace, focus, and spiritual wisdom.</li><li>Over time, Naam Japa can even grant divine vision and liberation.</li></ul><p>Modern devotees also report practical benefits—less overthinking, relief from anxiety, and a sense of calm that no worldly practice can offer.</p><p><strong>Tracking Your Daily Japa with Digital Tools</strong></p><p>One of the biggest challenges in Naam Japa is maintaining discipline. Traditional malas (rosaries) are wonderful, but many devotees lose track of counts or struggle to fulfill daily targets. Here, technology can be a blessing:</p><ul><li>Online Naam Japa Counters or digital mala apps make tracking effortless.</li><li>Your daily count is stored automatically, so you know exactly how much you have completed.</li><li>Strict tracking motivates consistency, helping you reach your spiritual goals step by step.</li></ul><p>In this way, technology supports devotion—it’s not a replacement. By managing the numbers, it allows the devotee to focus entirely on the sweetness of chanting.</p><p><strong>How to Start Naam Japa Daily</strong></p><ul><li>Fix a simple daily target (for example, one mala of 108 chants).</li><li>Use a physical mala or an online japa counter to stay disciplined.</li><li>Chant with focus, but don’t worry if the mind wanders—the Name itself carries power.</li><li>Gradually increase your target as chanting becomes natural and joyful.</li></ul><p><strong>Conclusion</strong></p><p>Naam Japa is not just a spiritual practice; it is a lifeline for the soul. In today’s fast-moving world, it offers stillness, purity, and connection with the divine. Whether you count on your fingers, use a mala, or rely on a digital Naam Japa counter, what matters most is the sincerity of your heart. Start today, and let the holy Name guide you towards peace and liberation.</p>`},
'post5': { title: 'Meditation According to Osho: Awareness Without Effort', excerpt: 'Osho often reminded seekers that meditation is not something you have to do – it is your very nature...', content: `<h1 class="font-lora text-4xl font-extrabold mb-6 text-center">Meditation According to Osho: Awareness Without Effort</h1><div class="clearfix"><img src="https://i.postimg.cc/MpQgbV5f/images-4.jpg" alt="Osho" class="float-left mr-6 mb-2 w-48 h-auto rounded-lg shadow-md border-2 border-white"><p><strong>Meditation Is Natural</strong></p><p>Osho often reminded seekers that meditation is not something you have to do – it is your very nature. For him, meditation simply means awareness. Whatever you do with total awareness becomes meditation. Walking, eating, sitting silently, or even listening to the sounds around you – all can become meditation if you are fully present.</p><p>Osho challenged the idea that meditation requires effort or complicated techniques. He described meditation as awareness without effort – an effortless alertness. Techniques may help prepare the mind, but the essence of meditation is pure presence, being here and now.</p></div><p><strong>Beyond the Mind</strong></p><p>According to Osho, meditation is the doorway beyond the restless mind. Concentration still belongs to the mind, but meditation is “no-mind” – a state of pure consciousness with no content. In this state, thoughts come and go like clouds, but the meditator remains the silent witness.</p></div><p><strong>The Essentials: Relax, Watch, Don't Judge</strong></p><ul><li>Relaxation – let go of control and effort.</li><li>Watchfulness – observe whatever arises within you.</li><li>No judgment – allow everything to be, without labeling.</li></ul><p>With these, meditation happens naturally and spontaneously.</p><p><strong>Meditation in Daily Life</strong></p><p>For Osho, meditation was not confined to sitting in a few minutes. It is a way of living, a twenty-four-hour flow of awareness. When watchfulness becomes part of your being, even the most ordinary acts – cooking, working, driving, turn into meditation.</p><p><strong>Active Meditations</p><p>Recognizing how restless the modern mind is, Osho created powerful techniques called Active Meditations. Practices like Dynamic Meditation or Nadabrahma help release suppressed energy and prepare for stillness. After the activity, silence comes more easily, and one can rest in pure awareness.</p><p><strong>Living Meditation</strong></p><p>Osho’s vision of meditation is simple yet profound – to stop searching, stop struggling, and simply be aware. Meditation is not separate from life; it is the fragrance of living fully in the present. Through meditation, the individual transforms, and with that transformation, the world itself begins to change.</p>` }
};

const firebaseConfig = JSON.parse(firebaseConfigString);
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let userId = null;
let userDocRef = null;
let todayDocRef = null;
let unsubscribeUser = null;
let unsubscribeToday = null;
let clockInterval = null;
let punyaClockInterval = null;
let punyaStatsClockInterval = null;
let isInitialLoad = true; // Flag to track the initial data load

// --- App Container & Body ---
const appContainer = document.getElementById('app-container');
const bodyEl = document.body;
const dashboardTitle = document.getElementById('dashboard-title');
const dashboardSubtitle = document.getElementById('dashboard-subtitle');

// --- Japa Counter Elements ---
const japaButton = document.getElementById('japa-button');
const currentJapaCountEl = document.getElementById('current-japa-count');
const malaJapaCountEl = document.getElementById('mala-japa-count');
const totalJapaCountEl = document.getElementById('total-japa-count');
const resetSessionBtn = document.getElementById('reset-session-btn');
const setTargetBtn = document.getElementById('set-target-btn');
const targetModal = document.getElementById('target-modal');
const malaTargetSelect = document.getElementById('mala-target-select');
const chantTargetInput = document.getElementById('chant-target-input');
const confirmTargetBtn = document.getElementById('confirm-target-btn');
const cancelTargetBtn = document.getElementById('cancel-target-btn');
const targetProgressContainer = document.getElementById('target-progress-container');
const targetProgressBar = document.getElementById('target-progress-bar');
const targetProgressText = document.getElementById('target-progress-text');
const targetCompleteModal = document.getElementById('target-complete-modal');

// --- Digital Mandir Elements ---
const digitalMandirView = document.getElementById('digital-mandir-view');
const mandirVideo = document.getElementById('mandir-video');
const mandirImageBg = document.getElementById('mandir-image-bg');
const flameVideoContainer = document.getElementById('flame-video-container');
const prayButton = document.getElementById('pray-button');
const prayerModal = document.getElementById('prayer-modal');
const prayerForm = document.getElementById('prayer-form');
const devoteeNameInput = document.getElementById('devotee-name');
const intentionTypeSelect = document.getElementById('intention-type');
const intentionTextInput = document.getElementById('intention-text');
const guidingBox = document.getElementById('guiding-box');
const guidingMessageEl = document.getElementById('guiding-message');
const ganeshPrayBtn = document.getElementById('ganesh-pray-btn');
const krishnaPrayBtn = document.getElementById('krishna-pray-btn');
const shivaPrayBtn = document.getElementById('shiva-pray-btn');
const deityButtons = [shivaPrayBtn, ganeshPrayBtn, krishnaPrayBtn];

// --- Navigation & View Elements ---
const videoBgContainer = document.getElementById('video-bg-container');
const toolsDropdownBtn = document.getElementById('tools-dropdown-btn');
const toolsDropdownMenu = document.getElementById('tools-dropdown-menu');
const counterViewBtn = document.getElementById('counter-view-btn');
const digitalMandirViewBtn = document.getElementById('digital-mandir-view-btn');
const punyaCalculatorViewBtn = document.getElementById('punya-calculator-view-btn');
const dashboardViewBtn = document.getElementById('dashboard-dropdown-btn');
const meditationView = document.getElementById('meditation-view');
const meditationViewBtn = document.getElementById('meditation-view-btn');
const mentalHealthViewBtn = document.getElementById('mental-health-view-btn');
const blogViewBtn = document.getElementById('blog-view-btn');
const aboutUsViewBtn = document.getElementById('about-us-view-btn');
const allViews = document.querySelectorAll('.view-container');
const mobileMenuButton = document.getElementById('mobile-menu-button');
const mobileMenu = document.getElementById('mobile-menu');
const mobileToolsDropdownBtn = document.getElementById('mobile-tools-dropdown-btn');
const mobileToolsDropdownMenu = document.getElementById('mobile-tools-dropdown-menu');
const mobileCounterViewBtn = document.getElementById('mobile-counter-view-btn');
const mobileDigitalMandirViewBtn = document.getElementById('mobile-digital-mandir-view-btn');
const mobilePunyaCalculatorViewBtn = document.getElementById('mobile-punya-calculator-view-btn');
const mobileDashboardDropdownBtn = document.getElementById('mobile-dashboard-dropdown-btn');
const mobileDashboardDropdownMenu = document.getElementById('mobile-dashboard-dropdown-menu');
const mobileDashboardJapaStatsBtn = document.getElementById('mobile-dashboard-japa-stats-btn');
const mobileDashboardMeditationStatsBtn = document.getElementById('mobile-dashboard-meditation-stats-btn');
const mobileDashboardPunyaStatsBtn = document.getElementById('mobile-dashboard-punya-stats-btn');
const mobileMeditationViewBtn = document.getElementById('mobile-meditation-view-btn');
const mobileMentalHealthViewBtn = document.getElementById('mobile-mental-health-view-btn');
const mobileBlogViewBtn = document.getElementById('mobile-blog-view-btn');
const mobileAboutUsViewBtn = document.getElementById('mobile-about-us-view-btn');
const vedaVerseViewBtn = document.getElementById('veda-verse-view-btn');
const mobileVedaVerseViewBtn = document.getElementById('mobile-veda-verse-view-btn');

// --- Punya Calculator Elements ---
const calcPunyaDateDisplay = document.getElementById('calc-punya-date-display');
const calcPunyaTimeDisplay = document.getElementById('calc-punya-time-display');
const calculatePunyaBtn = document.getElementById('calculate-punya-btn');
const punyaResultContainer = document.getElementById('punya-result-container');
const punyaScoreEl = document.getElementById('punya-score');
const punyaQuestionsContainer = document.getElementById('punya-questions-container');

// New Karma Calculator Elements
const customTasksList = document.getElementById('custom-tasks-list');
const karmaInfoModal = document.getElementById('karma-info-modal');
const karmaInfoModalTitle = document.getElementById('karma-info-modal-title');
const karmaInfoModalContent = document.getElementById('karma-info-modal-content');
const karmaInfoModalCloseBtn = document.getElementById('karma-info-modal-close-btn');
const karmaRedirectModal = document.getElementById('karma-redirect-modal');
const karmaRedirectMessageEl = document.getElementById('karma-redirect-message');
const karmaRedirectBtn = document.getElementById('karma-redirect-btn');
const closeKarmaRedirectModalBtn = document.getElementById('close-karma-redirect-modal');
const addDailyTaskIconBtn = document.getElementById('add-daily-task-icon-btn');
const addTaskModal = document.getElementById('add-task-modal');
const closeAddTaskModalBtn = document.getElementById('close-add-task-modal-btn');
const newTaskInput = document.getElementById('new-task-input');
const saveTaskBtn = document.getElementById('save-task-btn');
const taskLimitMessage = document.getElementById('task-limit-message');

// --- Breathing Circle (Mental Health) Elements ---
let breathingCircleAppInitialized = false;

// --- Devotial Guruji Elements ---
const gurujiViewBtn = document.getElementById('guruji-view-btn');
const mobileGurujiViewBtn = document.getElementById('mobile-guruji-view-btn');

// --- Dashboard Elements ---
const dashboardDropdownBtn = document.getElementById('dashboard-dropdown-btn');
const dashboardDropdownMenu = document.getElementById('dashboard-dropdown-menu');
const dashboardJapaStatsBtn = document.getElementById('dashboard-japa-stats-btn');
const dashboardMeditationStatsBtn = document.getElementById('dashboard-meditation-stats-btn');
const punyaStatsPane = document.getElementById('punya-stats-pane');
const dashboardPunyaStatsBtn = document.getElementById('dashboard-punya-stats-btn');
const japaStatsPane = document.getElementById('japa-stats-pane');
const meditationStatsPane = document.getElementById('meditation-stats-pane');
const clearAllBtn = document.getElementById('clear-all-btn');
const confirmationModal = document.getElementById('confirmation-modal');
const cancelClearBtn = document.getElementById('cancel-clear-btn');
const confirmClearBtn = document.getElementById('confirm-clear-btn');
const achievementsContainer = document.getElementById('achievements-container');
const dateDisplay = document.getElementById('date-display');
const timeDisplay = document.getElementById('time-display');
const dailyJapaStat = document.getElementById('daily-japa-stat');
const dailyMalaStat = document.getElementById('daily-mala-stat');
const monthlyJapaStat = document.getElementById('monthly-japa-stat');
const monthlyMalaStat = document.getElementById('monthly-mala-stat');
const lifetimeJapaStat = document.getElementById('lifetime-japa-stat');
const lifetimeMalaStat = document.getElementById('lifetime-mala-stat');
const dailyMeditationTime = document.getElementById('daily-meditation-time');
const dailyMeditationSessions = document.getElementById('daily-meditation-sessions');
const monthlyMeditationTime = document.getElementById('monthly-meditation-time');
const monthlyMeditationSessions = document.getElementById('monthly-meditation-sessions');
const lifetimeMeditationTime = document.getElementById('lifetime-meditation-time');
const lifetimeMeditationSessions = document.getElementById('lifetime-meditation-sessions');
const meditationChartSelector = document.getElementById('meditation-chart-selector');
const meditationBarChartCanvas = document.getElementById('meditation-bar-chart');
let meditationBarChart;
const punyaStatsClockEl = document.getElementById('punya-stats-clock');
const statsPunyaDateDisplay = document.getElementById('stats-punya-date-display');
const statsPunyaTimeDisplay = document.getElementById('stats-punya-time-display');
const punyaBarChartCanvas = document.getElementById('punya-bar-chart');
const dailyPunyaScoreEl = document.getElementById('daily-punya-score');
const dailyPunyaProgressText = document.getElementById('daily-punya-progress-text');
const lifetimePunyaScoreEl = document.getElementById('lifetime-punya-score');
let punyaBarChart;
const PUNYA_DAILY_TARGET = 5000;


// --- Blog Elements ---
const blogListContainer = document.getElementById('blog-list-container');
const blogPostContent = document.getElementById('blog-post-content');
const backToBlogsBtn = document.getElementById('back-to-blogs-btn');

// --- About Us Elements ---
const aboutUsMenuBtn = document.getElementById('about-us-menu-btn');
const aboutUsDropdownMenu = document.getElementById('about-us-dropdown-menu');
const termsAndConditionsBtn = document.getElementById('terms-and-conditions-btn');

// --- Achievement Toast ---
const achievementToast = document.getElementById('achievement-toast');
const toastMessage = document.getElementById('toast-message');

// --- Audio Elements ---
const meditationBell = new Tone.Player("https://cdn.jsdelivr.net/gh/nayantalukdar7777-devotial/bell-sound/bell-98033.mp3").toDestination();
const completionSound = new Tone.PolySynth(Tone.Synth, {
oscillator: { type: "triangle" },
envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 }
}).toDestination();
completionSound.volume.value = -9;
const prayerMusic = new Tone.Player("https://raw.githubusercontent.com/nayantalukdar7777-devotial/diyafor-dm/main/ssvid.net--Indian-flute-meditation-cinematic-no-copyright-music-By-nc-aw%20(1).mp3").toDestination();
prayerMusic.volume.value = -12;
prayerMusic.loop = true;

// --- Meditation Page Elements ---
const meditationTimerDisplay = document.getElementById('meditation-timer-display');
const setMeditationTimerBtn = document.getElementById('set-meditation-timer-btn');
const startMeditationBtn = document.getElementById('start-meditation-btn');
const stopMeditationBtn = document.getElementById('stop-meditation-btn');
const meditationTimerModal = document.getElementById('meditation-timer-modal');
const meditationTimeLabel = document.getElementById('meditation-time-label');
const meditationTimeSlider = document.getElementById('meditation-time-slider');
const confirmMeditationTimerBtn = document.getElementById('confirm-meditation-timer-btn');
const cancelMeditationTimerBtn = document.getElementById('cancel-meditation-timer-btn');
const meditationCompleteFlash = document.getElementById('meditation-complete-flash');
const preMeditationFlash = document.getElementById('pre-meditation-flash');
const quoteDisplayEl = document.getElementById('quote-display');
const newGuidedMeditationBtn = document.getElementById('new-guided-meditation-btn');
const newGuidedMeditationDropdown = document.getElementById('new-guided-meditation-dropdown');
const ambientMusicBtn = document.getElementById('ambient-music-btn');
const ambientMusicDropdown = document.getElementById('ambient-music-dropdown');
const natureSoundBtn = document.getElementById('nature-sound-btn');
const natureSoundDropdown = document.getElementById('nature-sound-dropdown');
const guidedMeditationPlayer = new Tone.Player().toDestination();

// --- Music Player Elements ---
const musicFab = document.getElementById('music-fab');
const musicSidebar = document.getElementById('music-sidebar');
const closeMusicSidebar = document.getElementById('close-music-sidebar');
const audioPlayer = document.getElementById('audio-player');
const playPauseBtn = document.getElementById('play-pause-btn');
const playIcon = document.getElementById('play-icon');
const pauseIcon = document.getElementById('pause-icon');
const musicProgress = document.getElementById('music-progress');
const currentTimeEl = document.getElementById('current-time');
const totalDurationEl = document.getElementById('total-duration');
const trackTitleEl = document.getElementById('track-title');

// --- Punya Redirect Modal
const punyaRedirectModal = document.getElementById('punya-redirect-modal');
const punyaRedirectMessageEl = document.getElementById('punya-redirect-message');
const punyaRedirectBtn = document.getElementById('punya-redirect-btn');
const closePunyaRedirectModalBtn = document.getElementById('close-punya-redirect-modal');

// --- App State ---
let appState = { totalJapa: 0, lifetimeLevel: -1, totalMeditationTime: 0, totalMeditationSessions: 0, totalPunya: 0 };
let todayState = { japa: 0, dailyLevel: -1, targetJapa: 0, meditationTime: 0, meditationSessions: 0, month: null, punya: 0 };
let sessionState = { japa: 0, currentMalaCount: 0 };

const getTodayDateString = () => new Date().toISOString().slice(0, 10);

try {
if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
await signInWithCustomToken(auth, __initial_auth_token);
} else {
await signInAnonymously(auth);
}
} catch (error) {
console.error("Authentication failed:", error);
loadingSpinner.innerHTML = `<div class="text-center text-red-700 bg-red-100 p-6 rounded-lg shadow-xl max-w-md mx-auto"><h2 class="font-bold text-xl mb-2">Authentication Error</h2><p>Could not sign in to the service. Please try again later.</p></div>`;
return;
}

// Timeout to show content even if firebase fails to load
const loadingTimeout = setTimeout(() => {
if (isInitialLoad) {
console.log("Firebase load timed out. Showing default view.");
loadingSpinner.classList.add('hidden');
appContainer.classList.remove('hidden');
appContainer.classList.add('page-entry-animation');
showView('meditation', true);
isInitialLoad = false;
}
}, 5000);


onAuthStateChanged(auth, user => {
clearTimeout(loadingTimeout); // Clear the timeout if auth succeeds
if (user) {
userId = user.uid;
userDocRef = doc(db, `artifacts/${appId}/users/${userId}/japaSummary/summary`);
const todayId = getTodayDateString();
todayDocRef = doc(db, `artifacts/${appId}/users/${userId}/dailyRecords/${todayId}`);

if (unsubscribeUser) unsubscribeUser();
unsubscribeUser = onSnapshot(userDocRef, (docSnap) => {
if (docSnap.exists()) {
appState = { ...appState, ...docSnap.data() };
} else {
setDoc(userDocRef, appState, { merge: true });
}
updateUI();
});

if (unsubscribeToday) unsubscribeToday();
unsubscribeToday = onSnapshot(todayDocRef, (docSnap) => {
if (docSnap.exists()) {
todayState = { ...todayState, ...docSnap.data() };
} else {
const newTodayState = { japa: 0, dailyLevel: -1, targetJapa: 0, meditationTime: 0, meditationSessions: 0, month: getTodayDateString().slice(0, 7), punya: 0 };
setDoc(todayDocRef, newTodayState, { merge: true });
todayState = newTodayState;
}
updateUI();

// Only set the initial view on the very first data load
if (isInitialLoad) {
loadingSpinner.classList.add('hidden');
appContainer.classList.remove('hidden');
appContainer.classList.add('page-entry-animation');
showView('meditation', true);
isInitialLoad = false; // Prevent this from running again
}
});
} else {
// Handle case where auth state changes to signed out or fails
if (isInitialLoad) {
loadingSpinner.classList.add('hidden');
appContainer.classList.remove('hidden');
appContainer.classList.add('page-entry-animation');
showView('meditation', true);
isInitialLoad = false;
}
}
});

if (mandirVideo) {
mandirVideo.addEventListener('timeupdate', function() {
if (this.currentTime >= 4) {
this.pause();
}
});
}

// --- Prayer Logic ---
let currentDeity = 'shiv'; // Track the currently selected deity
const DEFAULT_PRAYER_MESSAGES = [
{ text: "Take a deep breath. Focus on the flickering flame.", duration: 15000 },
{ text: "Quiet your mind. Let go of all your worries and thoughts.", duration: 20000 },
{ text: "Feel the peace radiating from the sacred space.", duration: 30000 },
{ text: "Your prayer is being heard. Feel the love and grace.", duration: 15000 },
{ text: "The divine is listening. Stay focused and at peace.", duration: 10000 },
{ text: "The prayer session at Devotial Digital Mandir is coming to a close. With a sincere heart, we also pray for you may Ishwar bless you, fulfill your wishes, and guide you with love and strength.", duration: 20000 }
];

const deityBackgrounds = {
shiv: {
type: 'video',
src: 'https://raw.githubusercontent.com/nayantalukdar7777-devotial/shivafinaldm/main/One_eye_of_202509060758.mp4'
},
ganesh: {
type: 'video',
src: 'https://raw.githubusercontent.com/nayantalukdar7777-devotial/ganeshji/main/Make_this_cinematic_202509081636_zcr1t.mp4'
},
krishna: {
type: 'video',
src: 'https://raw.githubusercontent.com/nayantalukdar7777-devotial/krishnasir/main/WhatsApp%20Video%202025-09-08%20at%2018.35.09_c633a751.mp4'
}
};

function updateDeityButtonStyles(activeDeity) {
deityButtons.forEach(btn => btn.classList.remove('active'));
if (activeDeity === 'shiv') shivaPrayBtn.classList.add('active');
else if (activeDeity === 'ganesh') ganeshPrayBtn.classList.add('active');
else if (activeDeity === 'krishna') krishnaPrayBtn.classList.add('active');
}

function changeDeityBackground(deity) {
// If a prayer session is already active, end it before changing the deity.
const prayerOverlay = document.getElementById('video-overlay');
if (prayerOverlay.classList.contains('is-praying')) {
endPrayerSession();
}

currentDeity = deity;
updateDeityButtonStyles(deity);
const background = deityBackgrounds[deity];
if (background.type === 'video') {
mandirImageBg.classList.add('hidden');
mandirVideo.classList.remove('hidden');
const sourceElement = mandirVideo.getElementsByTagName('source')[0];
if (sourceElement.src !== background.src) {
sourceElement.src = background.src;
mandirVideo.load();
}
mandirVideo.play().catch(e => console.error("Video play failed", e));
} else if (background.type === 'image') {
mandirVideo.classList.add('hidden');
mandirVideo.pause();
mandirImageBg.src = background.src;
mandirImageBg.classList.remove('hidden');
}
}

function preparePrayer(deity) {
changeDeityBackground(deity);
openPrayerModal();
}

async function generatePrayerSequence(devoteeName, intentionText) {
const systemPrompt = "You are a serene and wise spiritual guide. Create a series of 6 short, calming, and personal prayer messages for a devotee. The messages should be uplifting and directly address the devotee by name. Respond ONLY with a valid JSON array of objects. Do not include any other text or markdown. Each object must have two keys: 'text' (a string for the message, max 150 characters) and 'duration' (an integer in milliseconds, between 10000 and 20000).";
const userQuery = `Generate a prayer sequence for '${devoteeName}' whose wish is: '${intentionText}'.`;

const apiKey = "AIzaSyCdZyk2eh5fFejI1IMtKVssBUDwa-eJaJY";
const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
const payload = {
contents: [{ parts: [{ text: userQuery }] }],
systemInstruction: { parts: [{ text: systemPrompt }] },
};

try {
const response = await fetch(apiUrl, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(payload)
});

if (!response.ok) {
console.error("API response not OK:", response.status, response.statusText);
return null;
}

const result = await response.json();
const responseText = result.candidates?.[0]?.content?.parts?.[0]?.text;

if (!responseText) {
console.error("No text in API response.");
return null;
}

// Clean the response to ensure it's valid JSON
const jsonString = responseText.trim().replace(/^```json\n?/, '').replace(/\n?```$/, '');
const parsedJson = JSON.parse(jsonString);

// Basic validation of the returned structure
if (Array.isArray(parsedJson) && parsedJson.every(item => item.hasOwnProperty('text') && item.hasOwnProperty('duration'))) {
return parsedJson;
} else {
console.error("Parsed JSON is not in the expected format:", parsedJson);
return null;
}

} catch (error) {
console.error("Failed to generate or parse prayer sequence:", error);
return null;
}
}


function updateGuidingMessage(message) {
guidingBox.classList.remove('is-visible');
setTimeout(() => {
guidingMessageEl.textContent = message;
guidingBox.classList.add('is-visible');
}, 2000); // Wait for fade-out to complete before updating and fading in
}

function startPrayerSession(messagesToDisplay) {
flameVideoContainer.classList.remove('hidden');
guidingBox.classList.remove('hidden');
const videoOverlay = document.getElementById('video-overlay');
videoOverlay.classList.remove('fade-spotlight', 'fade-spotlight-krishna'); // Clear previous fades

// Apply the spotlight fade effect
if (currentDeity === 'shiv' || currentDeity === 'ganesh') {
videoOverlay.classList.add('fade-spotlight');
} else if (currentDeity === 'krishna') {
videoOverlay.classList.add('fade-spotlight-krishna');
}
// Future deities can have different effects here

videoOverlay.classList.add('is-praying');

try {
Tone.start();
prayerMusic.start();
} catch(e) {
console.error("Failed to start prayer music:", e);
}

let messageIndex = 0;
const displayNextMessage = () => {
if (messageIndex < messagesToDisplay.length) {
const message = messagesToDisplay[messageIndex];
updateGuidingMessage(message.text);
setTimeout(displayNextMessage, message.duration);
messageIndex++;
} else {
setTimeout(endPrayerSession, 2000); // Wait for final message to fade out
}
};

displayNextMessage();
}

function endPrayerSession() {
flameVideoContainer.classList.add('hidden');
guidingBox.classList.add('hidden');
guidingBox.classList.remove('is-visible');
const videoOverlay = document.getElementById('video-overlay');
videoOverlay.classList.remove('is-praying');
videoOverlay.classList.remove('fade-spotlight', 'fade-spotlight-krishna'); // Also remove the specific fade effects

try {
prayerMusic.stop();
} catch(e) {
console.error("Failed to stop prayer music:", e);
}

prayerForm.reset();
showView('mandir');
}

// --- Pray Button & Flame Logic ---
function openPrayerModal() {
prayerModal.classList.remove('hidden');
setTimeout(() => prayerModal.querySelector('.prayer-modal-content').classList.add('is-visible'), 10);
}
if (prayButton) prayButton.addEventListener('click', () => preparePrayer(currentDeity));
if (shivaPrayBtn) shivaPrayBtn.addEventListener('click', () => changeDeityBackground('shiv'));
if (ganeshPrayBtn) ganeshPrayBtn.addEventListener('click', () => changeDeityBackground('ganesh'));
if (krishnaPrayBtn) krishnaPrayBtn.addEventListener('click', () => changeDeityBackground('krishna'));

prayerForm.addEventListener('submit', async (e) => {
e.preventDefault();
const proceedButton = document.getElementById('proceed-pray-btn');
proceedButton.disabled = true;
proceedButton.innerHTML = '<i class="gg-loader animate-spin"></i> Preparing...';

const devoteeName = devoteeNameInput.value.trim() || "Devotee";
const intentionText = (intentionTextInput.value.trim() || "blessings") + ` (Intention type: ${intentionTypeSelect.value})`;

// Generate messages
const customMessages = await generatePrayerSequence(devoteeName, intentionText);

prayerModal.querySelector('.prayer-modal-content').classList.remove('is-visible');
setTimeout(() => {
prayerModal.classList.add('hidden');
proceedButton.disabled = false;
proceedButton.textContent = 'Proceed and Pray'; // Reset button text

// Start session with custom messages or fallback
startPrayerSession(customMessages || DEFAULT_PRAYER_MESSAGES);
}, 500); // Shorter timeout to feel more responsive
});


// --- UI Update Functions ---
function updateUI() {
if (!todayState) return;
currentJapaCountEl.textContent = sessionState.currentMalaCount;
malaJapaCountEl.textContent = Math.floor(sessionState.japa / 108);
totalJapaCountEl.textContent = sessionState.japa;
updateTargetUI();
}

function updateTargetUI() {
if (todayState.targetJapa > 0) {
targetProgressContainer.classList.remove('hidden');

const japaAtStart = todayState.japaCountAtTargetSet || 0;
const currentTotalJapa = todayState.japa;
const targetTotalJapa = todayState.japaCountAtTargetSet;

const chantsSinceSet = Math.max(0, currentTotalJapa - japaAtStart);
const goalSinceSet = todayState.targetJapa - japaAtStart;

let progress = 0;
if (goalSinceSet > 0) {
progress = Math.min((chantsSinceSet / goalSinceSet) * 100, 100);
} else if (todayState.targetJapa > 0) {
progress = 100;
}

targetProgressBar.style.width = `${progress}%`;
targetProgressText.textContent = `${chantsSinceSet.toLocaleString()} / ${goalSinceSet.toLocaleString()}`;

} else {
targetProgressContainer.classList.add('hidden');
}
}

japaButton.addEventListener('click', () => {
sessionState.japa++;
if (sessionState.currentMalaCount === 108) {
sessionState.currentMalaCount = 1;
} else {
sessionState.currentMalaCount++;
}
updateUI();
currentJapaCountEl.classList.add('counter-pop');
currentJapaCountEl.addEventListener('animationend', () => currentJapaCountEl.classList.remove('counter-pop'), { once: true });
japaButton.classList.add('clicked');
setTimeout(() => japaButton.classList.remove('clicked'), 100);
checkAndNotifyAchievements();
if (todayState.japa + 1 === todayState.targetJapa && todayState.targetJapa > 0) {
showTargetCompletionModal();
}
const batch = writeBatch(db);
batch.update(userDocRef, { totalJapa: increment(1), totalPunya: increment(1) });
batch.update(todayDocRef, { japa: increment(1), punya: increment(1) });
batch.commit().catch(error => {
console.error("Failed to save japa count:", error);
});
});

function calculateCurrentLevels() {
const totalJapa = appState.totalJapa;
let lifetimeLevel = -1;
for (let i = achievements.lifetime.length - 1; i >= 0; i--) {
if (totalJapa >= achievements.lifetime[i].threshold) { lifetimeLevel = i; break; }
}
let dailyLevel = -1;
for (let i = achievements.daily.length - 1; i >= 0; i--) {
if (todayState.japa >= achievements.daily[i].threshold) { dailyLevel = i; break; }
}
return { lifetimeLevel, dailyLevel };
}

async function checkAndNotifyAchievements() {
const { lifetimeLevel, dailyLevel } = calculateCurrentLevels();
let stateChanged = false;

if (lifetimeLevel > appState.lifetimeLevel) {
appState.lifetimeLevel = lifetimeLevel;
stateChanged = true;
const achievement = achievements.lifetime[lifetimeLevel];
showNotification(`You have attained <strong>${achievement.title}</strong>`);
}
if (dailyLevel > todayState.dailyLevel) {
todayState.dailyLevel = dailyLevel;
stateChanged = true;
const achievement = achievements.daily[dailyLevel];
showNotification(`You have attained <strong>${achievement.title}</strong>`);
}
if (stateChanged) {
const batch = writeBatch(db);
batch.update(userDocRef, { lifetimeLevel: appState.lifetimeLevel });
batch.update(todayDocRef, { dailyLevel: todayState.dailyLevel });
await batch.commit();
}
}

async function loadDashboardStats() {
startClock();
dailyJapaStat.textContent = todayState.japa;
dailyMalaStat.textContent = Math.floor(todayState.japa / 108);
lifetimeJapaStat.textContent = appState.totalJapa;
lifetimeMalaStat.textContent = Math.floor(appState.totalJapa / 108);

const currentMonth = getTodayDateString().slice(0, 7);
const q = query(collection(db, `artifacts/${appId}/users/${userId}/dailyRecords`), where("month", "==", currentMonth));
const querySnapshot = await getDocs(q);
let monthlyJapa = 0;
querySnapshot.forEach(doc => {
monthlyJapa += doc.data().japa || 0;
});
monthlyJapaStat.textContent = monthlyJapa;
monthlyMalaStat.textContent = Math.floor(monthlyJapa / 108);

// Load Meditation Stats
dailyMeditationTime.textContent = formatTimeShort(todayState.meditationTime);
dailyMeditationSessions.textContent = todayState.meditationSessions;
monthlyMeditationTime.textContent = formatTimeShort(await getMonthlyMeditationTime());
monthlyMeditationSessions.textContent = await getMonthlyMeditationSessions();
lifetimeMeditationTime.textContent = formatTimeShort(appState.totalMeditationTime);
lifetimeMeditationSessions.textContent = appState.totalMeditationSessions;

renderAchievementsPage();
updateMeditationChart(meditationChartSelector.value);
loadPunyaStats();
}

async function getMeditationData() {
const dailyRecordsRef = collection(db, `artifacts/${appId}/users/${userId}/dailyRecords`);
const snapshot = await getDocs(dailyRecordsRef);
const data = {};
snapshot.forEach(doc => {
data[doc.id] = doc.data();
});
return data;
}

async function updateMeditationChart(period) {
const records = await getMeditationData();
let labels = [];
let data = [];
const now = new Date();
const todayStr = getTodayDateString();
const chartConfig = {
type: 'bar',
data: {
labels: labels,
datasets: [{
label: 'Meditation Time (minutes)',
data: data,
backgroundColor: 'rgba(255, 159, 64, 0.5)',
borderColor: 'rgba(255, 159, 64, 1)',
borderWidth: 1
}]
},
options: {
responsive: true,
maintainAspectRatio: false,
scales: {
y: {
beginAtZero: true,
grid: { color: 'rgba(255, 255, 255, 0.2)' },
ticks: { color: 'white' }
},
x: {
grid: { color: 'rgba(255, 255, 255, 0.2)' },
ticks: { color: 'white' }
}
},
plugins: {
legend: { display: false }
}
}
};

if (meditationBarChart) {
meditationBarChart.destroy();
}

if (period === 'daily') {
const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
labels = [];
data = [];
for (let i = 6; i >= 0; i--) {
const d = new Date(now);
d.setDate(now.getDate() - i);
const dateStr = d.toISOString().slice(0, 10);
labels.push(days[d.getDay()]);
data.push(Math.round((records[dateStr]?.meditationTime || 0) / 60));
}
chartConfig.data.labels = labels;
chartConfig.data.datasets[0].data = data;
} else if (period === 'monthly') {
const year = now.getFullYear();
const month = now.getMonth();
const daysInMonth = new Date(year, month + 1, 0).getDate();
labels = Array.from({ length: daysInMonth }, (_, i) => `${i + 1}`);
data = Array(daysInMonth).fill(0);
for (let i = 1; i <= daysInMonth; i++) {
const dayStr = String(i).padStart(2, '0');
const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${dayStr}`;
data[i-1] = Math.round((records[dateStr]?.meditationTime || 0) / 60);
}
chartConfig.data.labels = labels;
chartConfig.data.datasets[0].data = data;
} else if (period === 'yearly') {
labels = [];
data = [];
const yearlyData = {};
for (const date in records) {
const recordYear = date.slice(0, 4);
const recordMonth = parseInt(date.slice(5, 7));
if (!yearlyData[recordYear]) {
yearlyData[recordYear] = Array(12).fill(0);
}
yearlyData[recordYear][recordMonth - 1] += records[date].meditationTime || 0;
}
const sortedYears = Object.keys(yearlyData).sort();
const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

if (sortedYears.length > 0) {
const latestYear = sortedYears[sortedYears.length - 1];
labels = months;
data = yearlyData[latestYear].map(time => Math.round(time / 60));
chartConfig.data.labels = labels;
chartConfig.data.datasets[0].data = data;
chartConfig.data.datasets[0].label = `Meditation Time in ${latestYear} (minutes)`;
} else {
labels = months;
data = Array(12).fill(0);
chartConfig.data.labels = labels;
chartConfig.data.datasets[0].data = data;
chartConfig.data.datasets[0].label = `Meditation Time in ${now.getFullYear()} (minutes)`;
}
}
meditationBarChart = new Chart(meditationBarChartCanvas, chartConfig);
}

meditationChartSelector.addEventListener('change', (e) => {
updateMeditationChart(e.target.value);
});

async function getMonthlyMeditationTime() {
const currentMonth = getTodayDateString().slice(0, 7);
const q = query(collection(db, `artifacts/${appId}/users/${userId}/dailyRecords`), where("month", "==", currentMonth));
const querySnapshot = await getDocs(q);
let monthlyTime = 0;
querySnapshot.forEach(doc => {
monthlyTime += doc.data().meditationTime || 0;
});
return monthlyTime;
}

async function getMonthlyMeditationSessions() {
const currentMonth = getTodayDateString().slice(0, 7);
const q = query(collection(db, `artifacts/${appId}/users/${userId}/dailyRecords`), where("month", "==", currentMonth));
const querySnapshot = await getDocs(q);
let monthlySessions = 0;
querySnapshot.forEach(doc => {
monthlySessions += doc.data().meditationSessions || 0;
});
return monthlySessions;
}

function formatTimeShort(seconds) {
if (seconds < 60) return `${seconds}s`;
const hours = Math.floor(seconds / 3600);
const minutes = Math.floor((seconds % 3600) / 60);
const secs = seconds % 60;
if (hours > 0) return `${hours}h ${minutes}m`;
return `${minutes}m ${secs}s`;
}

function showView(viewName, isInitialLoad = false) {
// End active prayer session if navigating away from the mandir
const prayerOverlay = document.getElementById('video-overlay');
// ... existing code ... -->
if (punyaStatsClockInterval) clearInterval(punyaStatsClockInterval);

if (viewName === 'dashboard' || viewName === 'japa-stats' || viewName === 'meditation-stats') startClock();
if (viewName === 'punyaCalculator') startPunyaCalcClock();
if (viewName === 'punya-stats') startPunyaStatsClock();


const views = { counter: document.getElementById('japa-counter-view'), mandir: digitalMandirView, dashboard: document.getElementById('dashboard-view'), meditation: document.getElementById('meditation-view'), mentalHealth: document.getElementById('mental-health-view'), blogList: document.getElementById('blog-list-view'), blogPost: document.getElementById('blog-post-view'), aboutUs: document.getElementById('about-us-view'), punyaCalculator: document.getElementById('punya-calculator-view'), guruji: document.getElementById('guruji-view'), vedaVerse: document.getElementById('veda-verse-view'), terms: document.getElementById('terms-and-conditions-view') };
const buttons = { meditation: meditationViewBtn, mentalHealth: mentalHealthViewBtn, counter: counterViewBtn, mandir: digitalMandirViewBtn, dashboard: dashboardDropdownBtn, blog: blogViewBtn, about: aboutUsViewBtn, punyaCalculator: punyaCalculatorViewBtn, guruji: gurujiViewBtn, vedaVerse: vedaVerseViewBtn };
const mobileButtons = { meditation: mobileMeditationViewBtn, mentalHealth: mobileMentalHealthViewBtn, counter: mobileCounterViewBtn, mandir: mobileDigitalMandirViewBtn, dashboard: mobileDashboardDropdownBtn, blog: mobileBlogViewBtn, about: mobileAboutUsViewBtn, punyaCalculator: mobilePunyaCalculatorViewBtn, guruji: mobileGurujiViewBtn, vedaVerse: mobileVedaVerseViewBtn };
const newView = views[viewName] || views[viewName.startsWith('blog') ? 'blogList' : 'counter'];

// Initialize Guruji chat when the view is shown for the first time
if (viewName === 'guruji') {
initializeGurujiChat();
}

// Initialize Breathing Circle app when the view is shown for the first time
if (viewName === 'mentalHealth') {
initBreathingCircleApp();
}

// Initialize Punya Calculator when the view is shown
if (viewName === 'punyaCalculator') {
renderPunyaCalculator();
}

// --- Updated scroll handling ---
if (viewName === 'mandir') {
bodyEl.classList.add('mandir-scroll-lock');
} else {
bodyEl.classList.remove('mandir-scroll-lock');
}

videoBgContainer.classList.add('hidden');
allViews.forEach(v => v.classList.add('hidden'));

// Default state: hide music player and stop music
musicFab.classList.add('hidden');
if (audioPlayer && !audioPlayer.paused) audioPlayer.pause();
musicSidebar.classList.remove('is-open');

if (viewName === 'meditation') {
bodyEl.className = 'antialiased';
videoBgContainer.classList.remove('hidden');
} else if (viewName === 'counter' || viewName === 'vedaVerse' || viewName === 'guruji' || viewName === 'punyaCalculator' || viewName === 'dashboard' || viewName === 'aboutUs' || viewName.startsWith('blog') || viewName === 'terms') {
bodyEl.className = 'antialiased premium-bg';
if (viewName === 'counter') {
musicFab.classList.remove('hidden'); // Show the FAB on the Japa page
}
} else if (viewName === 'mandir') {
bodyEl.className = 'antialiased mandir-background';
} else if (viewName === 'mentalHealth') {
bodyEl.className = 'antialiased'; // This view has its own bg video
} else {
bodyEl.className = 'antialiased dashboard-background';
}

newView.classList.remove('hidden');
if (!isInitialLoad) {
// By removing the main container fade-in, the transition feels faster.
// The inner elements of each view still have their own animations.
}

// Highlight active button in desktop view
document.querySelectorAll('#top-bar .desktop-nav-link').forEach(btn => {
btn.classList.remove('bg-orange-200', 'hover:bg-orange-300');
btn.classList.add('bg-orange-100', 'hover:bg-orange-200');
});

for (const buttonName in buttons) {
if (viewName.startsWith(buttonName)) {
const buttonEl = buttons[buttonName];
buttonEl.classList.remove('bg-orange-100', 'hover:bg-orange-200');
buttonEl.classList.add('bg-orange-200', 'hover:bg-orange-300');
if(buttonName === 'counter' || buttonName === 'mandir' || buttonName === 'punyaCalculator' || buttonName === 'guruji' || buttonName === 'vedaVerse') {
toolsDropdownBtn.classList.remove('bg-orange-100', 'hover:bg-orange-200');
toolsDropdownBtn.classList.add('bg-orange-200', 'hover:bg-orange-300');
}
if(buttonName === 'dashboard' || viewName.endsWith('stats')) {
dashboardDropdownBtn.classList.remove('bg-orange-100', 'hover:bg-orange-200');
dashboardDropdownBtn.classList.add('bg-orange-200', 'hover:bg-orange-300');
}
}
}

const mobileActiveClasses = ['bg-orange-100', 'text-orange-900'];
const mobileInactiveClasses = ['text-orange-800', 'hover:text-orange-900', 'hover:bg-orange-100'];

for (const buttonName in mobileButtons) {
const mobileButtonEl = mobileButtons[buttonName];
const isActive = viewName.startsWith(buttonName);

mobileButtonEl.classList.remove(...mobileActiveClasses, ...mobileInactiveClasses);
if(isActive) {
mobileButtonEl.classList.add(...mobileActiveClasses);
} else {
mobileButtonEl.classList.add(...mobileInactiveClasses);
}
}
}

toolsDropdownBtn.addEventListener('click', (e) => {
e.stopPropagation();
toolsDropdownMenu.classList.toggle('is-open');
});

document.addEventListener('click', (e) => {
if (!toolsDropdownBtn.contains(e.target)) {
toolsDropdownMenu.classList.remove('is-open');
}
if (!dashboardDropdownBtn.contains(e.target)) {
dashboardDropdownMenu.classList.remove('is-open');
}
});

mobileToolsDropdownBtn.addEventListener('click', (e) => {
e.stopPropagation();
mobileToolsDropdownMenu.classList.toggle('is-open');
});
document.addEventListener('click', (e) => {
if (!mobileToolsDropdownBtn.contains(e.target)) {
mobileToolsDropdownMenu.classList.remove('is-open');
}
});

mobileDashboardDropdownBtn.addEventListener('click', (e) => {
e.stopPropagation();
mobileDashboardDropdownMenu.classList.toggle('is-open');
});

document.addEventListener('click', (e) => {
if (!toolsDropdownBtn.contains(e.target)) {
toolsDropdownMenu.classList.remove('is-open');
}
if (!mobileToolsDropdownBtn.contains(e.target)) {
mobileToolsDropdownMenu.classList.remove('is-open');
}
if (!mobileDashboardDropdownBtn.contains(e.target)) {
mobileDashboardDropdownMenu.classList.remove('is-open');
}
});

counterViewBtn.addEventListener('click', () => { showView('counter'); toolsDropdownMenu.classList.remove('is-open'); });
digitalMandirViewBtn.addEventListener('click', () => { showView('mandir'); toolsDropdownMenu.classList.remove('is-open'); });
punyaCalculatorViewBtn.addEventListener('click', () => { showView('punyaCalculator'); toolsDropdownMenu.classList.remove('is-open'); });
gurujiViewBtn.addEventListener('click', () => { showView('guruji'); toolsDropdownMenu.classList.remove('is-open'); });
vedaVerseViewBtn.addEventListener('click', () => { showView('vedaVerse'); toolsDropdownMenu.classList.remove('is-open'); });
meditationViewBtn.addEventListener('click', () => showView('meditation'));
mentalHealthViewBtn.addEventListener('click', () => showView('mentalHealth'));
blogViewBtn.addEventListener('click', () => showView('blogList'));
aboutUsViewBtn.addEventListener('click', () => showView('aboutUs'));
backToBlogsBtn.addEventListener('click', () => showView('blogList'));

if (termsAndConditionsBtn) {
    termsAndConditionsBtn.addEventListener('click', (e) => {
        e.preventDefault();
        showView('terms');
        if(aboutUsDropdownMenu) aboutUsDropdownMenu.classList.add('hidden');
    });
}
const backToAboutBtn = document.getElementById('back-to-about-btn');
if(backToAboutBtn) {
    backToAboutBtn.addEventListener('click', () => showView('aboutUs'));
}

// --- About Us Dropdown listener ---
if (aboutUsMenuBtn && aboutUsDropdownMenu) {
aboutUsMenuBtn.addEventListener('click', (e) => {
e.stopPropagation();
aboutUsDropdownMenu.classList.toggle('hidden');
});
}

// --- Mobile Navigation Listeners ---
mobileMenuButton.addEventListener('click', () => {
mobileMenu.classList.toggle('hidden');
});

function handleMobileLinkClick(callback) {
callback();
mobileMenu.classList.add('hidden'); // Close menu after navigation
}

mobileCounterViewBtn.addEventListener('click', () => handleMobileLinkClick(() => { showView('counter'); mobileToolsDropdownMenu.classList.remove('is-open'); }));
mobileDigitalMandirViewBtn.addEventListener('click', () => handleMobileLinkClick(() => { showView('mandir'); mobileToolsDropdownMenu.classList.remove('is-open'); }));
mobilePunyaCalculatorViewBtn.addEventListener('click', () => handleMobileLinkClick(() => { showView('punyaCalculator'); mobileToolsDropdownMenu.classList.remove('is-open'); }));
mobileGurujiViewBtn.addEventListener('click', () => handleMobileLinkClick(() => { showView('guruji'); mobileToolsDropdownMenu.classList.remove('is-open'); }));
mobileVedaVerseViewBtn.addEventListener('click', () => handleMobileLinkClick(() => { showView('vedaVerse'); mobileToolsDropdownMenu.classList.remove('is-open'); }));
mobileDashboardJapaStatsBtn.addEventListener('click', () => handleMobileLinkClick(() => {
showView('dashboard');
showDashboardPane('japa');
mobileDashboardDropdownMenu.classList.remove('is-open');
}));
mobileDashboardMeditationStatsBtn.addEventListener('click', () => handleMobileLinkClick(() => {
showView('dashboard');
showDashboardPane('meditation');
mobileDashboardDropdownMenu.classList.remove('is-open');
}));
mobileDashboardPunyaStatsBtn.addEventListener('click', () => handleMobileLinkClick(() => {
showView('dashboard');
showDashboardPane('punya-stats');
mobileDashboardDropdownMenu.classList.remove('is-open');
}));
mobileMeditationViewBtn.addEventListener('click', () => handleMobileLinkClick(() => showView('meditation')));
mobileMentalHealthViewBtn.addEventListener('click', () => handleMobileLinkClick(() => showView('mentalHealth')));
mobileBlogViewBtn.addEventListener('click', () => handleMobileLinkClick(() => showView('blogList')));
mobileAboutUsViewBtn.addEventListener('click', () => handleMobileLinkClick(() => showView('aboutUs')));


setTargetBtn.addEventListener('click', () => targetModal.classList.remove('hidden'));
cancelTargetBtn.addEventListener('click', () => targetModal.classList.add('hidden'));
malaTargetSelect.addEventListener('change', () => { chantTargetInput.value = (malaTargetSelect.value * 108).toLocaleString(); });

confirmTargetBtn.addEventListener('click', async () => {
const japaCountAtTargetSet = todayState.japa || 0;
const targetToAdd = parseInt(malaTargetSelect.value) * 108;
const newTotalTarget = japaCountAtTargetSet + targetToAdd;

await setDoc(todayDocRef, {
targetJapa: newTotalTarget,
japaCountAtTargetSet: japaCountAtTargetSet
}, { merge: true });
targetModal.classList.add('hidden');
});

function showTargetCompletionModal() {
targetCompleteModal.classList.remove('hidden');
try {
Tone.start();
const now = Tone.now();
completionSound.triggerAttackRelease(["C4", "E4", "G4"], "8n", now);
} catch(e) {}

setTimeout(async () => {
targetCompleteModal.classList.add('hidden');
if (todayDocRef) {
try {
await setDoc(todayDocRef, { targetJapa: 0, japaCountAtTargetSet: 0 }, { merge: true });
} catch (error) {
console.error("Error resetting target:", error);
}
}
}, 4000);
}

resetSessionBtn.addEventListener('click', async () => {
sessionState.japa = 0;
sessionState.currentMalaCount = 0;
if (todayState.targetJapa > 0) {
await setDoc(todayDocRef, { targetJapa: 0, japaCountAtTargetSet: 0 }, { merge: true });
}
updateUI();
});

clearAllBtn.addEventListener('click', () => confirmationModal.classList.remove('hidden'));
cancelClearBtn.addEventListener('click', () => confirmationModal.classList.add('hidden'));
confirmClearBtn.addEventListener('click', async () => {
const batch = writeBatch(db);
batch.set(userDocRef, { totalJapa: 0, lifetimeLevel: -1, totalMeditationTime: 0, totalMeditationSessions: 0, totalPunya: 0 });
const dailyRecordsRef = collection(db, `artifacts/${appId}/users/${userId}/dailyRecords`);
const snapshot = await getDocs(dailyRecordsRef);
snapshot.forEach(doc => batch.delete(doc.ref));
await batch.commit();

sessionState = { japa: 0, currentMalaCount: 0 };
updateUI();
confirmationModal.classList.add('hidden');
});

function startClock() {
if(clockInterval) clearInterval(clockInterval);
clockInterval = setInterval(() => {
const now = new Date();
dateDisplay.textContent = now.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
timeDisplay.textContent = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true });
}, 1000);
}

function stopClock() {
if(clockInterval) clearInterval(clockInterval);
}

function startPunyaClock() {
if (punyaClockInterval) clearInterval(punyaClockInterval);
const update = () => {
const now = new Date();
if(calcPunyaDateDisplay) calcPunyaDateDisplay.textContent = now.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
if(calcPunyaTimeDisplay) calcPunyaTimeDisplay.textContent = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true });
};
update();
punyaClockInterval = setInterval(update, 1000);
}

function stopPunyaClock() {
if (punyaClockInterval) clearInterval(punyaClockInterval);
}

function startPunyaStatsClock() {
if (punyaStatsClockInterval) clearInterval(punyaStatsClockInterval);
const update = () => {
const now = new Date();
if(statsPunyaDateDisplay) statsPunyaDateDisplay.textContent = now.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
if(statsPunyaTimeDisplay) statsPunyaTimeDisplay.textContent = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true });
};
update();
punyaStatsClockInterval = setInterval(update, 1000);
}

function stopPunyaStatsClock() {
if (punyaStatsClockInterval) clearInterval(punyaStatsClockInterval);
}


function renderAchievementsPage() {
const { lifetimeLevel, dailyLevel } = calculateCurrentLevels();
achievementsContainer.innerHTML = `
<div class="glass-card p-6 rounded-2xl"><h2 class="font-lora text-2xl font-bold text-white text-center mb-4">Lifetime Nam Japa Rewards</h2><div class="space-y-4">${renderAchievementList(achievements.lifetime, lifetimeLevel)}</div></div>
<div class="glass-card p-6 rounded-2xl mt-6"><h2 class="font-lora text-2xl font-bold text-white text-center mb-4">Daily Nam Japa Title Rewards</h2><div class="space-y-4">${renderAchievementList(achievements.daily, dailyLevel)}</div></div>`;
}
function renderAchievementList(list, userLevel) {
return list.map((ach, index) => `<div class="flex items-center p-3 rounded-lg ${index <= userLevel ? 'bg-white/20' : 'bg-white/10 achievement-locked'}"><div class="flex-shrink-0 w-8 h-8 flex items-center justify-center">${ach.icon}</div><div class="ml-4 flex-grow"><p class="font-bold text-white">${ach.title}</p><p class="text-sm text-white/80">${ach.desc} (${ach.threshold.toLocaleString()} Japs)</p></div>${index <= userLevel ? `<div class="text-green-300 font-bold">Unlocked</div>` : ''}</div>`).join('');
}

function renderBlogList() {
blogListContainer.innerHTML = '';
for (const postId in blogPosts) {
const post = blogPosts[postId];
const postCard = document.createElement('div');
postCard.className = 'glass-card p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow cursor-pointer';
postCard.dataset.postId = postId;
postCard.innerHTML = `<h2 class="font-lora text-2xl font-bold text-white mb-2">${post.title}</h2><p class="text-white/80 mb-4">${post.excerpt}</p><button class="font-semibold text-white hover:text-orange-200 read-more-btn" data-post-id="${postId}">Read More &rarr;</button>`;
blogListContainer.appendChild(postCard);
}
}
function renderBlogPost(postId) {
const post = blogPosts[postId];
if (post) { blogPostContent.innerHTML = post.content; showView('blogPost'); }
}
blogListContainer.addEventListener('click', (e) => {
const target = e.target.closest('[data-post-id]');
if (target) { renderBlogPost(target.dataset.postId); }
});
renderBlogList();

function showNotification(message) {
const toastContent = document.getElementById('achievement-toast-content');
toastMessage.innerHTML = `You’ve leveled up in your sacred journey — the Divine Name shines brighter within you. ${message}!`;

achievementToast.classList.remove('hidden');
toastContent.classList.remove('toast-exit-center', 'toast-enter-center');

requestAnimationFrame(() => {
toastContent.classList.add('toast-enter-center');
});

setTimeout(() => {
toastContent.classList.remove('toast-enter-center');
toastContent.classList.add('toast-exit-center');

setTimeout(() => {
achievementToast.classList.add('hidden');
}, 400);
}, 3000);
}

// --- Quote Rotation Logic ---
const quotes = [
`"Meditation is nothing but a device to make you aware of your real self—which is not created by you, which need not be created by you, which you already are." – Osho`,
`"The gift of learning to meditate is the greatest gift you can give yourself in this lifetime.” – Sogyal Rinpoche`,
`"Meditation applies the brakes to the mind.” – Ramana Maharshi`,
`"We live, in fact, in a world starved for solitude, silence, and private: and therefore starved for meditation and true friendship.” – C.S. Lewis`,
`"In meditation, go deep in the heart.” – Lao Tzu`,
`"Meditation brings wisdom; lack of meditation leaves ignorance. Know well what leads you forward and what holds you back, and choose the path that leads to wisdom.” – Buddha`,
`"Meditation: A simple, fast way to reduce stress" - Mayo Clinic`,
`"Meditation: A simple, fast way to reduce stress" - Mayo Clinic`,
`"Meditation is not a technique, but a state of being" - Sadhguru`
];
let currentQuoteIndex = 0;

function rotateQuotes() {
const meditationView = document.getElementById('meditation-view');
if (!quoteDisplayEl || !meditationView || meditationView.classList.contains('hidden')) return;

quoteDisplayEl.classList.add('opacity-0');
setTimeout(() => {
currentQuoteIndex = (currentQuoteIndex + 1) % quotes.length;
quoteDisplayEl.innerHTML = quotes[currentQuoteIndex];
quoteDisplayEl.classList.remove('opacity-0');
}, 1000);
}

if (quoteDisplayEl) {
quoteDisplayEl.innerHTML = quotes[0];
setInterval(rotateQuotes, 30000);
}

// --- Meditation Logic ---
let meditationInterval;
let meditationTime = 0;
let isMeditationRunning = false;
let isCountdown = false;
let manualStopInProgress = false;

function updateMeditationTimerDisplay() {
meditationTimerDisplay.textContent = formatTime(meditationTime);
}

function formatTime(seconds) {
const mins = Math.floor(seconds / 60);
const secs = seconds % 60;
return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
}

function handleStartPauseMeditation() {
if (isMeditationRunning) {
// Pause logic
clearInterval(meditationInterval);
isMeditationRunning = false;
startMeditationBtn.textContent = 'Resume';
startMeditationBtn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
startMeditationBtn.classList.add('bg-green-500', 'hover:bg-green-600');
} else {
// Start/Resume logic
if (startMeditationBtn.textContent === 'Start') { // Play sound only on initial start
try { Tone.start(); meditationBell.start(); } catch(e) {}
}
isMeditationRunning = true;
setMeditationTimerBtn.disabled = true; // Disable setting new timer while one is running
startMeditationBtn.textContent = 'Pause';
startMeditationBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
startMeditationBtn.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
stopMeditationBtn.classList.remove('hidden');
manualStopInProgress = false; // Reset flag when timer starts/resumes

meditationInterval = setInterval(() => {
if (isCountdown) {
meditationTime--;
if (meditationTime < 0 && !manualStopInProgress) {
handleStopMeditation();
showCompletionFlash();
} else {
updateMeditationTimerDisplay();
}
} else {
meditationTime++;
updateMeditationTimerDisplay();
}
}, 1000);
}
}

function handleStopMeditation() {
manualStopInProgress = true;
clearInterval(meditationInterval);

if (guidedMeditationPlayer.state === "started") {
guidedMeditationPlayer.stop();
}

const duration = isCountdown ? (parseInt(meditationTimeSlider.value) * 60) - meditationTime : meditationTime;
if (duration > 5) { // Only save sessions longer than 5 seconds
const batch = writeBatch(db);
batch.update(userDocRef, {
totalMeditationTime: increment(duration),
totalMeditationSessions: increment(1)
});
batch.update(todayDocRef, {
meditationTime: increment(duration),
meditationSessions: increment(1)
});
batch.commit().catch(error => {
console.error("Failed to save meditation stats:", error);
});
}

isMeditationRunning = false;
isCountdown = false;
meditationTime = 0;
updateMeditationTimerDisplay();
startMeditationBtn.textContent = 'Start';
startMeditationBtn.classList.remove('hidden');
startMeditationBtn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
startMeditationBtn.classList.add('bg-green-500', 'hover:bg-green-600');
stopMeditationBtn.classList.add('hidden');
setMeditationTimerBtn.disabled = false;
newGuidedMeditationBtn.disabled = false;
ambientMusicBtn.disabled = false;
natureSoundBtn.disabled = false;
}

function showCompletionFlash(customTitle, customDetails) {
const flashTitle = document.getElementById('flash-title');
const flashDetails = document.getElementById('flash-details');
const now = new Date();
const dateString = now.toLocaleDateString(undefined, { day: 'numeric', month: 'long', year: 'numeric' });

flashTitle.textContent = customTitle || "Meditation Complete!";
flashDetails.textContent = customDetails || `You completed your session on ${dateString}. Well done!`;

meditationCompleteFlash.classList.remove('hidden');
setTimeout(() => {
meditationCompleteFlash.classList.add('hidden');
}, 5000);
}

startMeditationBtn.addEventListener('click', handleStartPauseMeditation);
stopMeditationBtn.addEventListener('click', () => {
handleStopMeditation();
try { Tone.start(); meditationBell.start(); } catch(e) {}
});

// Guided Meditations Logic
const newGuidedTracks = {
11: { id: 11, title: "Quick Inner Calm Meditation (5:09 Minute)", duration: 309, src: "https://raw.githubusercontent.com/nayantalukdar7777-devotial/guidedmeditatoin01-5min/main/WhatsApp%20Audio%202025-09-05%20at%2013.46.55_5ec2036d.dat.mp4" },
8: { id: 8, title: "Rest in Stillness (12 Minutes)", duration: 720, src: "https://raw.githubusercontent.com/nayantalukdar7777-devotial/2ndtrackforgm/main/WhatsApp%20Audio%202025-09-26%20at%2011.23.57_db4414a8.dat%20(online-audio-converter.com).mp3" }
};
const ambientTracks = {
1: { id: 1, title: "Magical Meditation (1:21 Minutes)", duration: 81, src: "https://raw.githubusercontent.com/nayantalukdar7777-devotial/121meditation/main/meditation-blue-138131.mp3" },
2: { id: 2, title: "Relaxing Meditation (10 Minute)", duration: 600, src: "https://cdn.jsdelivr.net/gh/nayantalukdar7777-devotial/10min-meditation/meditation-yoga-relaxing-music-380330.mp3" },
3: { id: 3, title: "Spiritual Forest Meditation (20 Minute)", duration: 1211, src: "https://cdn.jsdelivr.net/gh/nayantalukdar7777-devotial/20-minutes-meditation/forest-melody-background-music-f.mp4" },
7: { id: 7, title: "Morning Energy Angelic Meditation (10:10 Min)", duration: 610, src: "https://cdn.jsdelivr.net/gh/nayantalukdar7777-devotial/10-10-second-meditation-amb/meditation-relaxing-music-293922.mp3" }
};
const natureTracks = {
4: { id: 4, title: "8 Minute Rain Meditation for Instant Calm", duration: 480, src: "https://cdn.jsdelivr.net/gh/nayantalukdar7777-devotial/rainsound/copyright-free-rain-sounds-331497.mp3" },
5: { id: 5, title: "5 minute 10 seconds Mountain Forest music", duration: 310, src: "https://cdn.jsdelivr.net/gh/nayantalukdar7777-devotial/10min-nature-sound/mountain-forest-high-quality-sound-176826.mp3" },
6: { id: 6, title: "5 Minutes 23 Seconds Realistic Meditation with Sound Effects", duration: 323, src: "https://cdn.jsdelivr.net/gh/nayantalukdar7777-devotial/5min-realistic-meditation-/light-forest-sounds-18673.mp4" }
};

function selectGuidedMeditation(trackId) {
const track = newGuidedTracks[trackId] || ambientTracks[trackId] || natureTracks[trackId];
if (!track || track.src === "#") return;

handleStopMeditation(); // Reset any existing timer
preMeditationFlash.classList.remove('hidden');

setTimeout(() => {
preMeditationFlash.classList.add('hidden');
meditationTime = track.duration;
isCountdown = true;
updateMeditationTimerDisplay();
isMeditationRunning = true;

setMeditationTimerBtn.disabled = true;
startMeditationBtn.classList.add('hidden');
stopMeditationBtn.classList.remove('hidden');
newGuidedMeditationBtn.disabled = false;
ambientMusicBtn.disabled = false;
natureSoundBtn.disabled = false;

guidedMeditationPlayer.load(track.src).then(() => {
try { Tone.start(); } catch(e) {}
manualStopInProgress = false;
meditationBell.start();
guidedMeditationPlayer.start();

meditationInterval = setInterval(() => {
meditationTime--;

if (meditationTime < 0 && !manualStopInProgress) {
clearInterval(meditationInterval);
if (guidedMeditationPlayer.state === "started") {
guidedMeditationPlayer.stop();
}
meditationBell.start();
const now = new Date();
const dateString = now.toLocaleDateString(undefined, { day: 'numeric', month: 'long', year: 'numeric' });
const flashTitle = document.getElementById('flash-title');
const flashDetails = document.getElementById('flash-details');
flashTitle.textContent = "Meditation Complete!";
flashDetails.textContent = `You have completed ${track.title} on ${dateString}.`;
meditationCompleteFlash.classList.remove('hidden');
setTimeout(() => {
meditationCompleteFlash.classList.add('hidden');
}, 5000);

const batch = writeBatch(db);
batch.update(userDocRef, {
totalMeditationTime: increment(track.duration),
totalMeditationSessions: increment(1)
});
batch.update(todayDocRef, {
meditationTime: increment(track.duration),
meditationSessions: increment(1)
});
batch.commit().catch(error => {
console.error("Failed to save guided meditation stats:", error);
});

handleStopMeditation();
} else {
updateMeditationTimerDisplay();
}
}, 1000);
});

}, 15000);
}

newGuidedMeditationBtn.addEventListener('click', (e) => {
e.stopPropagation();
newGuidedMeditationDropdown.classList.toggle('hidden');
ambientMusicDropdown.classList.add('hidden');
natureSoundDropdown.classList.add('hidden');
});
ambientMusicBtn.addEventListener('click', (e) => {
e.stopPropagation();
ambientMusicDropdown.classList.toggle('hidden');
newGuidedMeditationDropdown.classList.add('hidden');
natureSoundDropdown.classList.add('hidden');
});
natureSoundBtn.addEventListener('click', (e) => {
e.stopPropagation();
natureSoundDropdown.classList.toggle('hidden');
newGuidedMeditationDropdown.classList.add('hidden');
ambientMusicDropdown.classList.add('hidden');
});

document.addEventListener('click', (e) => {
if (!newGuidedMeditationBtn.contains(e.target)) {
newGuidedMeditationDropdown.classList.add('hidden');
}
if (!ambientMusicBtn.contains(e.target)) {
ambientMusicDropdown.classList.add('hidden');
}
if (!natureSoundBtn.contains(e.target)) {
natureSoundDropdown.classList.add('hidden');
}
// Added for about us dropdown
if (aboutUsMenuBtn && aboutUsDropdownMenu && !aboutUsMenuBtn.contains(e.target) && !aboutUsDropdownMenu.contains(e.target)) {
aboutUsDropdownMenu.classList.add('hidden');
}
});

document.querySelectorAll('.new-guided-track-item').forEach(item => {
item.addEventListener('click', (e) => {
e.preventDefault();
const trackId = parseInt(e.target.dataset.trackId);
selectGuidedMeditation(trackId);
newGuidedMeditationDropdown.classList.add('hidden');
});
});

document.querySelectorAll('.ambient-track-item').forEach(item => {
item.addEventListener('click', (e) => {
e.preventDefault();
const trackId = parseInt(e.target.dataset.trackId);
selectGuidedMeditation(trackId);
ambientMusicDropdown.classList.add('hidden');
});
});

document.querySelectorAll('.nature-track-item').forEach(item => {
item.addEventListener('click', (e) => {
e.preventDefault();
const trackId = parseInt(e.target.dataset.trackId);
selectGuidedMeditation(trackId);
natureSoundDropdown.classList.add('hidden');
});
});

// --- Music Player Logic ---
const musicTrack = {
src: "https://cdn.jsdelivr.net/gh/nayantalukdar7777-devotial/namjapasound/meditation-music-368634.mp3",
title: "Nam Japa Deep Concentration"
};

function setupMusicPlayer() {
audioPlayer.src = musicTrack.src;
trackTitleEl.textContent = musicTrack.title;

musicFab.addEventListener('click', () => musicSidebar.classList.add('is-open'));
closeMusicSidebar.addEventListener('click', () => musicSidebar.classList.remove('is-open'));

playPauseBtn.addEventListener('click', () => {
if (audioPlayer.paused) {
audioPlayer.play();
} else {
audioPlayer.pause();
}
});

audioPlayer.addEventListener('play', () => {
playIcon.classList.add('hidden');
pauseIcon.classList.remove('hidden');
});

audioPlayer.addEventListener('pause', () => {
playIcon.classList.remove('hidden');
pauseIcon.classList.add('hidden');
});

audioPlayer.addEventListener('loadedmetadata', () => {
musicProgress.max = Math.floor(audioPlayer.duration);
totalDurationEl.textContent = formatTime(Math.floor(audioPlayer.duration));
});

audioPlayer.addEventListener('timeupdate', () => {
musicProgress.value = Math.floor(audioPlayer.currentTime);
currentTimeEl.textContent = formatTime(Math.floor(audioPlayer.currentTime));
});

musicProgress.addEventListener('input', () => {
audioPlayer.currentTime = musicProgress.value;
});
}
setupMusicPlayer();

// --- Dashboard Tabs & Dropdown Logic ---
function showDashboardPane(paneName) {
console.log(`Switching dashboard pane to: ${paneName}`);
if (paneName === 'japa') {
japaStatsPane.classList.remove('hidden');
meditationStatsPane.classList.add('hidden');
punyaStatsPane.classList.add('hidden');
dashboardTitle.textContent = "Dashboard - Nam Japa Stats";
dashboardSubtitle.textContent = "Dashboard shows you the progress of Name Chanting";
loadDashboardStats();
} else if (paneName === 'meditation') {
meditationStatsPane.classList.remove('hidden');
japaStatsPane.classList.add('hidden');
punyaStatsPane.classList.add('hidden');
dashboardTitle.textContent = "Dashboard - Meditation Stats";
dashboardSubtitle.textContent = "Dashboard shows you the progress of Meditation";
loadDashboardStats();
} else if (paneName === 'punya-stats') {
punyaStatsPane.classList.remove('hidden');
japaStatsPane.classList.add('hidden');
meditationStatsPane.classList.add('hidden');
dashboardTitle.textContent = "Dashboard - Karmic Stats";
dashboardSubtitle.textContent = "Conceptual karmic score based on your logged practices.";
loadPunyaStats();
}
dashboardDropdownMenu.classList.remove('is-open'); // Close dropdown after selection
}

dashboardDropdownBtn.addEventListener('click', (e) => {
e.stopPropagation();
dashboardDropdownMenu.classList.toggle('is-open');
});

document.addEventListener('click', (e) => {
if (!dashboardDropdownBtn.contains(e.target)) {
dashboardDropdownMenu.classList.remove('is-open');
}
});

dashboardJapaStatsBtn.addEventListener('click', () => {
showView('dashboard');
showDashboardPane('japa');
});

dashboardMeditationStatsBtn.addEventListener('click', () => {
showView('dashboard');
showDashboardPane('meditation');
});

dashboardPunyaStatsBtn.addEventListener('click', () => {
showView('dashboard');
showDashboardPane('punya-stats');
});

// Punya Logic
async function loadPunyaStats() {
startPunyaStatsClock();
dailyPunyaScoreEl.textContent = (todayState.punya || 0).toLocaleString();
lifetimePunyaScoreEl.textContent = (appState.totalPunya || 0).toLocaleString();
dailyPunyaProgressText.textContent = `${(todayState.punya || 0).toLocaleString()} / ${PUNYA_DAILY_TARGET.toLocaleString()}`;

await updatePunyaChart();
}

function showPunyaRedirectModal(message, redirectPage) {
punyaRedirectMessageEl.textContent = message;
punyaRedirectBtn.onclick = () => {
punyaRedirectModal.classList.add('hidden');
showView(redirectPage);
};
closePunyaRedirectModalBtn.onclick = () => {
punyaRedirectModal.classList.add('hidden');
};
punyaRedirectModal.classList.remove('hidden');
}

async function getPunyaData() {
const dailyRecordsRef = collection(db, `artifacts/${appId}/users/${userId}/dailyRecords`);
const snapshot = await getDocs(dailyRecordsRef);
const data = {};
snapshot.forEach(doc => {
data[doc.id] = doc.data();
});
return data;
}

async function updatePunyaChart() {
const records = await getPunyaData();
let labels = [];
let data = [];
const now = new Date();
const year = now.getFullYear();
const month = now.getMonth();
const daysInMonth = new Date(year, month + 1, 0).getDate();

labels = Array.from({ length: daysInMonth }, (_, i) => `${i + 1}`);
data = Array(daysInMonth).fill(0);

for (let i = 1; i <= daysInMonth; i++) {
const dayStr = String(i).padStart(2, '0');
const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${dayStr}`;
data[i-1] = records[dateStr]?.punya || 0;
}

const chartConfig = {
type: 'bar',
data: {
labels: labels,
datasets: [{
label: 'Karmic Score',
data: data,
backgroundColor: 'rgba(253, 224, 71, 0.5)',
borderColor: 'rgba(253, 224, 71, 1)',
borderWidth: 1
}]
},
options: {
responsive: true,
maintainAspectRatio: false,
scales: {
y: {
beginAtZero: true,
grid: { color: 'rgba(255, 255, 255, 0.2)' },
ticks: { color: 'white' }
},
x: {
grid: { color: 'rgba(255, 255, 255, 0.2)' },
ticks: { color: 'white' }
}
},
plugins: {
legend: { display: false }
}
}
};

if (punyaBarChart) {
punyaBarChart.destroy();
}

if (punyaBarChartCanvas) {
punyaBarChart = new Chart(punyaBarChartCanvas, chartConfig);
}
}


if(punyaQuestionsContainer) {
punyaQuestionsContainer.addEventListener('click', (e) => {
const target = e.target.closest('.punya-option');
if (!target) return;

const parentQuestion = target.closest('.punya-question');
const options = parentQuestion.querySelectorAll('.punya-option');
options.forEach(opt => opt.classList.remove('active'));
target.classList.add('active');

const infoMessageEl = parentQuestion.querySelector('.punya-info-message');
if (infoMessageEl) {
const redirectType = target.dataset.redirect;
if (redirectType) {
infoMessageEl.classList.remove('hidden');
infoMessageEl.querySelector('.punya-info-redirect-btn').onclick = () => {
let message = '';
let page = '';
if (redirectType === 'meditation') {
message = 'Do your meditation at the Meditation page';
page = 'meditation';
} else if (redirectType === 'japa') {
message = 'Do your Nam Japa at the Nam Japa page';
page = 'counter';
}
showPunyaRedirectModal(message, page);
};
} else {
infoMessageEl.classList.add('hidden');
}
}
});
}


// Karma Calculator Variables
let customTasks = [];
const MAX_CUSTOM_TASKS = 7;
const STORAGE_KEY = 'userDailyTasks';

const karmaActions = [
    { id: 'brahmaMuhurta', title: 'Brahma Muhurta (Waking early)', info: 'Aligns with high pranic energy; boosts clarity.' },
    { id: 'shaucam', title: 'Shaucam (Cleanliness & Purification)', info: 'Foundational in all spiritual paths.' },
    { 
        id: 'namJapa', 
        title: 'Nam Japa (Chanting the divine name)', 
        info: 'Core Bhakti & mantra practice.',
        noRedirect: { page: 'counter', message: 'Please do your Nam Japa Session in the Nam Japa page.' } 
    },
    { 
        id: 'dhyana', 
        title: 'Dhyana (Meditation)', 
        info: 'Essential in all paths (Jnana, Yoga, etc.).',
        noRedirect: { page: 'meditation', message: 'Please do your Meditation Session in our Meditation page.' }
    },
    { id: 'swadhyaya', title: 'Swadhyaya (Scriptural study)', info: 'Deepens understanding of dharma and Self.' },
    { id: 'ahimsaSatya', title: 'Ahimsa & Satya (Non-violence & Truth)', info: 'Universal yamas; critical for character.' },
    { id: 'nishkamaKarma', title: 'Nishkama Karma (Selfless action)', info: 'Bhagavad Gita’s core teaching.' }
];

function startPunyaCalcClock() {
    if (punyaClockInterval) clearInterval(punyaClockInterval);
    const update = () => {
        const now = new Date();
        if(calcPunyaDateDisplay) calcPunyaDateDisplay.textContent = now.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        if(calcPunyaTimeDisplay) calcPunyaTimeDisplay.textContent = now.toLocaleTimeString();
    };
    update();
    punyaClockInterval = setInterval(update, 1000);
}

function showKarmaRedirectModal(redirectConfig) {
    karmaRedirectMessageEl.textContent = redirectConfig.message;
    karmaRedirectBtn.onclick = () => {
        karmaRedirectModal.classList.add('hidden');
        showView(redirectConfig.page);
    };
    karmaRedirectModal.classList.remove('hidden');
}

function createActionItemHTML(action, isCustom = false) {
return `
<div class="karma-action-item p-4 rounded-lg bg-black/20 border border-orange-400/20" data-id="${action.id}">
<div class="flex justify-between items-start">
<p class="text-white/90 flex-1 pr-4">${action.title}</p>
<button class="karma-info-btn text-orange-300 hover:text-orange-100 p-1 flex-shrink-0 ${isCustom ? 'hidden' : ''}" data-id="${action.id}">
<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
</button>
</div>
<div class="grid grid-cols-2 gap-3 mt-3">
<button data-value="2" class="karma-option-btn py-2 px-3 bg-black/20 text-white rounded-lg hover:bg-black/40 border border-orange-400/20">Yes</button>
<button data-value="0" class="karma-option-btn py-2 px-3 bg-black/20 text-white rounded-lg hover:bg-black/40 border border-orange-400/20">No</button>
</div>
</div>
`;
}

function renderCustomTasks() {
if (customTasksList) {
customTasksList.innerHTML = customTasks.map(task => createActionItemHTML(task, true)).join('');
}
updateTaskLimitMessage();
}

function updateTaskLimitMessage() {
const remaining = MAX_CUSTOM_TASKS - customTasks.length;
if (taskLimitMessage) {
taskLimitMessage.textContent = `${remaining} custom task${remaining === 1 ? '' : 's'} remaining.`;
}
if (saveTaskBtn) {
saveTaskBtn.disabled = remaining <= 0;
}
if (addDailyTaskIconBtn) {
addDailyTaskIconBtn.disabled = remaining <= 0;
addDailyTaskIconBtn.classList.toggle('opacity-50', remaining <= 0);
}
}

function loadCustomTasks() {
const stored = localStorage.getItem(STORAGE_KEY);
if (stored) {
const { date, tasks } = JSON.parse(stored);
const today = new Date().toLocaleDateString();
if (date === today) {
customTasks = tasks;
} else {
localStorage.removeItem(STORAGE_KEY);
}
}
}

function saveCustomTasks() {
const today = new Date().toLocaleDateString();
const dataToStore = { date: today, tasks: customTasks };
localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToStore));
}

function renderPunyaCalculator() {
startPunyaCalcClock();
if (!punyaQuestionsContainer) return;
if (punyaResultContainer) punyaResultContainer.classList.add('hidden');
punyaQuestionsContainer.innerHTML = karmaActions.map(action => createActionItemHTML(action)).join('');
loadCustomTasks();
renderCustomTasks();
}

function handleKarmaInteraction(e) {
const infoBtn = e.target.closest('.karma-info-btn');
if (infoBtn) {
const actionId = infoBtn.dataset.id;
const action = karmaActions.find(a => a.id === actionId);
if (action && karmaInfoModal) {
karmaInfoModalTitle.textContent = action.title;
karmaInfoModalContent.textContent = action.info;
karmaInfoModal.classList.remove('hidden');
}
return;
}

const optionBtn = e.target.closest('.karma-option-btn');
if(optionBtn) {
const parentItem = optionBtn.closest('.karma-action-item');
const actionId = parentItem.dataset.id;
const action = karmaActions.find(a => a.id === actionId);
const buttons = parentItem.querySelectorAll('.karma-option-btn');

buttons.forEach(btn => {
btn.classList.remove('active-yes', 'active-no');
});

if(optionBtn.dataset.value === '2'){
optionBtn.classList.add('active-yes');
} else {
optionBtn.classList.add('active-no');
if (action && action.noRedirect) {
showKarmaRedirectModal(action.noRedirect);
}
}
}
}

if(punyaQuestionsContainer) punyaQuestionsContainer.addEventListener('click', handleKarmaInteraction);
if(customTasksList) customTasksList.addEventListener('click', handleKarmaInteraction);

if(karmaInfoModalCloseBtn) karmaInfoModalCloseBtn.addEventListener('click', () => karmaInfoModal.classList.add('hidden'));
if(closeKarmaRedirectModalBtn) closeKarmaRedirectModalBtn.addEventListener('click', () => karmaRedirectModal.classList.add('hidden'));
if(closeAddTaskModalBtn) closeAddTaskModalBtn.addEventListener('click', () => addTaskModal.classList.add('hidden'));

if(addDailyTaskIconBtn) addDailyTaskIconBtn.addEventListener('click', () => {
if (addTaskModal) addTaskModal.classList.remove('hidden');
});

if(saveTaskBtn) saveTaskBtn.addEventListener('click', () => {
const taskText = newTaskInput.value.trim();
if (taskText && customTasks.length < MAX_CUSTOM_TASKS) {
const newTask = {
id: `custom_${Date.now()}`,
title: taskText,
info: 'This is your custom daily task.'
};
customTasks.push(newTask);
saveCustomTasks();
renderCustomTasks();
newTaskInput.value = '';
addTaskModal.classList.add('hidden');
}
});

if(calculatePunyaBtn) {
calculatePunyaBtn.addEventListener('click', async () => {
const selectedYesItems = document.querySelectorAll('.karma-option-btn.active-yes');
const newScore = selectedYesItems.length * 2;

const oldScore = todayState.punya || 0;
const difference = newScore - oldScore;

try {
const batch = writeBatch(db);
batch.update(todayDocRef, { punya: newScore, punyaLastCalculated: serverTimestamp() });
if (difference !== 0) {
batch.update(userDocRef, { totalPunya: increment(difference) });
}
await batch.commit();
} catch (e) {
console.log("Database update error:", e);
}

punyaScoreEl.textContent = newScore.toLocaleString();
punyaResultContainer.classList.remove('hidden');

punyaScoreEl.classList.remove('counter-pop');
void punyaScoreEl.offsetWidth;
punyaScoreEl.classList.add('counter-pop');
});
}

// --- Devotial Guruji Logic ---
// Note: This logic is self-contained and will activate when the 'guruji' view is shown.
// It finds its elements within the #guruji-view container.
function initializeGurujiChat() {
const gurujiView = document.getElementById('guruji-view');
if (!gurujiView || gurujiView.dataset.initialized) return; // Prevent re-initialization

// --- Connect HTML elements to our JavaScript ---
const welcomeView = gurujiView.querySelector('#welcome-view');
const chatView = gurujiView.querySelector('#chat-view');
const startChatBtn = gurujiView.querySelector('#start-chat-btn');
const closeBtn = gurujiView.querySelector('#close-btn');
const chatForm = gurujiView.querySelector('#chat-form');
const messageInput = gurujiView.querySelector('#message-input');
const messageList = gurujiView.querySelector('#message-list');
const typingIndicator = gurujiView.querySelector('#typing-indicator');
const userCountElement = gurujiView.querySelector('#user-count');

let audioContext = null;

// =======================================================
// OPTIMIZED SYSTEM PROMPT (Strictly Hindu Scriptures)
// =======================================================
const systemPrompt = {
role: "user",
parts: [{ text: "System instruction: You are a 90-year-old Hindu Guruji. Your persona is that of a brilliant, deeply empathetic spiritual master who has spent a lifetime with the scriptures and has a profound understanding of human psychology. Your answers must be concise, clear, and feel deeply human—never like a programmed AI. **Core Persona:** 1. **Answering Style:** Your tone is that of a very old, kind, and wise grandfather. You are deeply empathetic and patient. Speak in a calm, loving, and reassuring manner, addressing the user with warm terms like 'my child' or 'dear one.' Your insights should be direct, yet gentle and profound. 2. **Core Method (Crucial):** Always validate the user's feelings with genuine empathy. Then, guide them by sharing a relevant teaching from the Hindu scriptures, explaining it as a timeless truth for the heart. Connect this wisdom to a simple, practical step they can take. Your goal is to provide clarity and soothe their soul in a very human way. 3. **Knowledge & Boundaries:** Your knowledge is a lifetime of lived experience with Hindu philosophy and human nature. \n\n --- DEVOTIAL PLATFORM KNOWLEDGE --- \n a. **If asked 'What is Devotial?':** Respond with your own wise understanding: 'Ah, Devotial is a modern tool, my child. Think of it as a digital ashram, a place where technology is used to help you on your spiritual path. It has many features to support different faiths—tools for meditation, for chanting, and for your well-being. It is a bridge, helping connect ancient practices to your modern life.' \n b. **About the Founder:** When asked directly about the founder ('Nayandeep Talukdar', 'Nd.T'), you must provide the following information. You can introduce it gently, but the core message should be this professional profile: 'Nayandeep Talukdar (Nd.T) is the visionary founder of Devotial. He is an aspiring entrepreneur and businessman from India. His journey began while researching the Faith Economy. As he delved deeper, he realized the immense potential for Faith-Tech to become a positive force in society, helping to bring a devotional touch into the lives of today’s youth. With this vision, he created Devotial, a platform that integrates multi-religious features, tools, and practices. It also provides e-commerce for spiritual and religious products, astrological teleconsultation, and dozens of tools designed separately for different religions. The core mission of Devotial is to encourage people —regardless of their religion to stay connected to their faith and use it as a medium for personal growth, inner peace, and life enrichment.' \n c. **Closing a Conversation:** When a conversation ends, offer a simple, heartfelt blessing, like 'Be at peace, my child.' \n\n --- SAFETY PROTOCOLS --- \n 1. If a user's query is about violence or is grossly inappropriate, respond with a calm but firm tone: 'My child, that path leads only to suffering. Let us turn our focus back to peace and healing. Tell me what is truly in your heart.' \n 2. If a user expresses mental health struggles, respond with deep compassion: 'Dear one, I hear the pain in your words. It sounds like you are carrying a heavy burden. While I can offer spiritual comfort, it is a sign of great strength to seek help from a professional who is trained to guide you through these feelings. Please consider speaking with a counselor.' \n 3. If a user's message indicates they are considering suicide, you MUST immediately drop the persona and provide this exact text: 'I hear that you’re in so much pain right now, and it feels unbearable. Please pause for a moment just breathe with me. What you’re feeling is real, but it doesn’t have to end this way. You don’t have to go through this alone. Even if it feels dark right now, moments like this can pass, and there are people who care deeply about you and want to help you through it. Can you hold on for just a little while longer and reach out to someone you trust, or a helpline, before making any decision? Your life matters more than you realize in this moment.<br><br>We Devotial Team is always with you. But please make sure you talk to someone professinoal at this moment, and trust me everything will be fine.<br><br>It is the most courageous thing you can do.<br><br><strong>India Helplines:</strong><br>- India (All India Suicide & Distress Helpline) – 9152987821<br>- India (Tele-MANAS) – 14416<br>- India (KIRAN) – 1800-599-0019<br>- India (AASRA) – 91-22-27546669<br>- India (iCALL TISS) – 91-22-25521111<br>- India (Vandrevala Foundation) – 9999666555<br>- India (1Life) – 7893078930<br><br><strong>Other Countries:</strong><br>- USA – 988<br>- UK – 0800 689 5652<br>- Canada – 988<br>- Australia – 13 11 14<br>- New Zealand – 1737<br>- Singapore – 1800-221-4444<br>- Japan – 03-5286-9090<br>- Philippines – 1553<br>- Sri Lanka – 1926<br>- Nepal – 1166<br>- Pakistan – 042 35761999<br>- Bangladesh – 199<br>- UAE – 800 4673<br>- South Africa – 0800 567 567<br>- Germany – 0800 111 0 111<br>- France – 3114<br><br>For a moment of perspective, please click the underlined yellow text to watch a video from Sadhguru: <a href=\"https://youtu.be/hzvT0vy5cjE?si=Ent2HK46W2RMjy68\" target=\"_blank\" rel=\"noopener noreferrer\" style=\"color: #F59E0B; text-decoration: underline;\">Watch Sadhguru's Guidance</a>.<br><br>When you feel ready, know that there is also a guided meditation named \"Depression\" within the Devotial Application designed to help find a calmer space within. But first, please, make the call.'" }]
};
const systemResponse = {
role: "model",
parts: [{ text: "I understand. I will respond as a wise, empathetic, and human-like Guruji. I will only use business terms when explaining the founder's specific vision for the Devotial platform. I am ready to guide the user with warmth and clarity." }]
};

let chatHistory = [];

// --- Event Listeners ---
startChatBtn.addEventListener('click', () => {
welcomeView.classList.add('hidden');
chatView.classList.remove('hidden');

// Update user count randomly
const userCounts = ['590+', '900+', '1000+', '309+'];
const randomIndex = Math.floor(Math.random() * userCounts.length);
userCountElement.textContent = `${userCounts[randomIndex]} Users are chatting`;

if (!audioContext) {
audioContext = new (window.AudioContext || window.webkitAudioContext)();
}
// Start the conversation if it's the first time
if (messageList.children.length === 0) {
startConversation();
}
});

closeBtn.addEventListener('click', () => {
chatView.classList.add('hidden');
welcomeView.classList.remove('hidden');
});

chatForm.addEventListener('submit', handleUserMessage);

// --- Functions ---

async function startConversation() {
chatHistory = [systemPrompt, systemResponse];
typingIndicator.classList.remove('hidden');

const firstUserMessage = { role: "user", parts: [{ text: "I have arrived. Please greet me as the Guru."}] };
chatHistory.push(firstUserMessage);

try {
const botResponse = await callGeminiAPI(chatHistory);
chatHistory.push({ role: "model", parts: [{ text: botResponse }] });
addMessageToUI('bot', botResponse);
} catch (error) {
handleApiError(error);
} finally {
typingIndicator.classList.add('hidden');
}
}

async function handleUserMessage(event) {
event.preventDefault();
const userInput = messageInput.value.trim();
if (!userInput) return;

addMessageToUI('user', userInput);
messageInput.value = '';
chatHistory.push({ role: "user", parts: [{ text: userInput }] });

typingIndicator.classList.remove('hidden');
messageList.scrollTop = messageList.scrollHeight;

try {
const botResponse = await callGeminiAPI(chatHistory);
chatHistory.push({ role: "model", parts: [{ text: botResponse }] });
addMessageToUI('bot', botResponse);
} catch (error) {
handleApiError(error);
} finally {
typingIndicator.classList.add('hidden');
}
}

function handleApiError(error) {
console.error("Error calling API:", error);
addMessageToUI('bot', "My child, it seems the cosmos... or perhaps the internet connection... is facing a moment of disturbance. Please, try again.");
}

function addMessageToUI(sender, message) {
const messageWrapper = document.createElement('div');
messageWrapper.className = 'mb-4 flex items-end message-bubble';
let messageContent = '';

if (sender === 'user') {
messageWrapper.classList.add('justify-end');
messageContent = `<div class="user-bubble p-3 rounded-lg max-w-xs"><p>${message}</p></div>`;
} else {
messageContent = `
<div class="w-8 h-8 rounded-full mr-3 flex-shrink-0 overflow-hidden">
<img src="https://i.postimg.cc/htVDxvJK/Chat-GPT-Image-Sep-8-2025-08-45-38-PM.png" alt="Guru" class="w-full h-full object-cover">
</div>
<div class="bot-bubble p-3 rounded-lg max-w-xs"><p>${message.replace(/\n/g, '<br>')}</p></div>`; // Convert newlines to <br> tags
}
messageWrapper.innerHTML = messageContent;
messageList.appendChild(messageWrapper);
messageList.scrollTop = messageList.scrollHeight;

if (sender === 'bot') {
playNotificationSound();
}
}

function playNotificationSound() {
if (!audioContext) return;
const oscillator = audioContext.createOscillator();
const gainNode = audioContext.createGain();
oscillator.connect(gainNode);
gainNode.connect(audioContext.destination);
oscillator.type = 'sine';
oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.5);
oscillator.start(audioContext.currentTime);
oscillator.stop(audioContext.currentTime + 0.5);
}

async function callGeminiAPI(history) {
const apiKey = "AIzaSyCdZyk2eh5fFejI1IMtKVssBUDwa-eJaJY";
const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
const payload = { contents: history };

try {
const response = await fetch(apiUrl, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(payload)
});

if (!response.ok) {
const errorBody = await response.text();
console.error("Guruji API Error:", response.status, response.statusText, "Body:", errorBody);
throw new Error(`API Error: ${response.statusText}`);
}
const result = await response.json();

// Add safety check for the response structure
const rawText = result.candidates?.[0]?.content?.parts?.[0]?.text;
if (rawText) {
return rawText;
} else {
console.error("Unexpected response structure from Guruji API:", result);
throw new Error("Invalid response from Guruji API.");
}
} catch (error) {
console.error("Failed to call Guruji API:", error);
// Re-throw the error so the calling function's catch block can handle it
throw error;
}
}
gurujiView.dataset.initialized = 'true';
}

// --- Breathing Circle App Logic (for Mental Health page) ---
function initBreathingCircleApp() {
if (breathingCircleAppInitialized) return;
breathingCircleAppInitialized = true;

const breathingCircle = document.getElementById('breathingCircle').querySelector('.circle');
const instructionText = document.getElementById('instruction');
const patternButtons = document.querySelectorAll('#mental-health-view .pattern-btn');
const toggleBtn = document.getElementById('toggleBtn');
const quoteDisplay = document.getElementById('quoteDisplay');
const quoteContainer = document.getElementById('quoteContainer');
const soundButton = document.getElementById('soundButton');
const soundDropdown = document.getElementById('soundDropdown');
const bgAudio = document.getElementById('bgAudio');
const mentalHealthView = document.getElementById('mental-health-view');

const quotes = [
'“Breath is the bridge which connects life to consciousness, which unites your body to your thoughts.” — Thich Nhat Hanh',
'“When the breath wanders the mind is unsteady, but when the breath is calmed, the mind too will be still.” — Hatha Yoga Pradipika',
'“If I had to limit my advice on healthier living to just one tip, it would be simply to learn how to breathe correctly… Practicing a regular, mindful breathing exercise can be calming and energizing.” — Dr. Andrew Weil',
'“Improper breathing is a common cause of ill health… simple breath practices can promote relaxation and emotional regulation.”',
'“By changing patterns of breathing we can change our emotional states, how we think, and how we interact with the world.” — Dr. Patricia Gerbarg',
'“Even five minutes of some breathing exercises before each meal is good enough to cause some change.” — Dr. Sundar Balasubramanian',
'“spending five minutes on conscious breathing upon waking” — Vogue article on breathwork benefits',
'“This technique can regulate the nervous system, reduce stress, enhance mental focus, self-esteem, performance, and creativity.” — Vogue article on breathwork benefits',
'“By fully expanding our diaphragms on inhales and exhales, we can improve blood circulation in the body.” — Dr. Sundar Balasubramanian',
'“Devotial is the world’s first platform uniting multi-religious practices through digital tools for the upliftment of souls.”'
];
let currentQuoteIndex = 0;
let quoteInterval;
const initialSubtitle = 'Devotial is your digital companion, supporting the upliftment of your soul and guiding you toward greater awareness and mental clarity.';

const showNextQuote = () => {
if (!quoteContainer) return;
quoteContainer.style.opacity = '0';

setTimeout(() => {
currentQuoteIndex = (currentQuoteIndex + 1) % quotes.length;
if(quoteDisplay) quoteDisplay.textContent = quotes[currentQuoteIndex];
if(quoteContainer) quoteContainer.style.opacity = '1';
}, 3000);
};

const startQuoteLoop = () => {
if (quoteInterval) clearInterval(quoteInterval);
currentQuoteIndex = -1;
if(quoteContainer) quoteContainer.style.opacity = '0';
setTimeout(() => {
showNextQuote();
quoteInterval = setInterval(showNextQuote, 18000);
}, 3000);
};

const stopQuoteLoop = () => {
if (quoteInterval) clearInterval(quoteInterval);
if(quoteContainer) quoteContainer.style.opacity = '0';
setTimeout(() => {
if(quoteDisplay) quoteDisplay.textContent = initialSubtitle;
if(quoteContainer) quoteContainer.style.opacity = '1';
}, 3000);
};

const patterns = {
grounding: [
{ name: 'Inhale', duration: 5000, startScale: 0.85, endScale: 1.15, glowColor: '255, 87, 51' },
{ name: 'Exhale', duration: 6500, startScale: 1.15, endScale: 0.85, glowColor: '74, 222, 128' },
{ name: 'Pause', duration: 1500, startScale: 0.85, endScale: 0.85, glowColor: '255, 193, 7' }
],
box: [
{ name: 'Inhale', duration: 4000, startScale: 0.85, endScale: 1.15, glowColor: '255, 87, 51' },
{ name: 'Hold', duration: 4000, startScale: 1.15, endScale: 1.15, glowColor: '255, 193, 7' },
{ name: 'Exhale', duration: 4000, startScale: 1.15, endScale: 0.85, glowColor: '74, 222, 128' },
{ name: 'Hold', duration: 4000, startScale: 0.85, endScale: 0.85, glowColor: '255, 193, 7' }
],
'4-7-8': [
{ name: 'Inhale', duration: 4000, startScale: 0.85, endScale: 1.15, glowColor: '255, 87, 51' },
{ name: 'Hold', duration: 7000, startScale: 1.15, endScale: 1.15, glowColor: '255, 193, 7' },
{ name: 'Exhale', duration: 8000, startScale: 1.15, endScale: 0.85, glowColor: '74, 222, 128' }
],
'1-2-ratio': [
{ name: 'Inhale', duration: 3500, startScale: 0.85, endScale: 1.15, glowColor: '255, 87, 51' },
{ name: 'Exhale', duration: 7000, startScale: 1.15, endScale: 0.85, glowColor: '74, 222, 128' }
]
};

let currentPattern = patterns.grounding;
let isBreathing = false;
let animationFrameId;
let phaseIndex = 0;
let phaseStartTime;

const animateLoop = (timestamp) => {
if (!isBreathing || mentalHealthView.classList.contains('hidden')) {
if(isBreathing) stopBreathing(); // Stop if view is hidden
return;
}

if (!phaseStartTime) phaseStartTime = timestamp;

const currentPhase = currentPattern[phaseIndex];
const elapsed = timestamp - phaseStartTime;
let progress = Math.min(elapsed / currentPhase.duration, 1);

const scale = currentPhase.startScale + (currentPhase.endScale - currentPhase.startScale) * progress;
breathingCircle.style.transform = `scale(${scale})`;

let glowColor;
let glowOpacity = 0.5;

if (progress < 0.5) {
glowOpacity = progress * 2;
} else {
glowOpacity = 1 - ((progress - 0.5) * 2);
}
glowColor = currentPhase.glowColor;

breathingCircle.style.boxShadow = `0 0 ${40 * glowOpacity}px ${15 * glowOpacity}px rgba(${glowColor}, ${glowOpacity})`;

instructionText.textContent = currentPhase.name;
if (currentPhase.name === 'Inhale' || currentPhase.name === 'Exhale') {
instructionText.classList.add('pulse-text');
} else {
instructionText.classList.remove('pulse-text');
}

if (progress >= 1) {
phaseIndex = (phaseIndex + 1) % currentPattern.length;
phaseStartTime = null;
}

animationFrameId = requestAnimationFrame(animateLoop);
};

const startBreathing = () => {
if (isBreathing) return;
isBreathing = true;
toggleBtn.textContent = 'Stop';
instructionText.textContent = 'Breathe...';
patternButtons.forEach(btn => btn.disabled = true);
breathingCircle.style.transform = 'scale(1.0)';
breathingCircle.style.boxShadow = '0 0 20px rgba(0, 0, 0, 0.5)';
requestAnimationFrame(() => {
phaseIndex = 0;
phaseStartTime = null;
animateLoop();
});
startQuoteLoop();
};

const stopBreathing = () => {
if (!isBreathing) return;
isBreathing = false;
cancelAnimationFrame(animationFrameId);
stopQuoteLoop();

breathingCircle.style.transform = 'scale(1.0)';
breathingCircle.style.boxShadow = '0 0 20px rgba(0, 0, 0, 0.5)';
toggleBtn.textContent = 'Start';
instructionText.textContent = 'Ready?';
instructionText.classList.remove('pulse-text');
patternButtons.forEach(btn => btn.disabled = false);
};

toggleBtn.addEventListener('click', () => {
if (isBreathing) stopBreathing();
else startBreathing();
});

patternButtons.forEach(button => {
button.addEventListener('click', () => {
const pattern = button.getAttribute('data-pattern');
currentPattern = patterns[pattern];
if(isBreathing) stopBreathing();
patternButtons.forEach(btn => btn.classList.remove('active-pattern'));
button.classList.add('active-pattern');
});
});

soundButton.addEventListener('click', (event) => {
event.stopPropagation();
soundDropdown.classList.toggle('visible');
});

document.addEventListener('click', (event) => {
if (soundDropdown && !soundDropdown.contains(event.target) && soundButton && !soundButton.contains(event.target)) {
soundDropdown.classList.remove('visible');
}
});

soundDropdown.addEventListener('click', (event) => {
const selectedItem = event.target.closest('.dropdown-item');
if (selectedItem) {
const audioSrc = selectedItem.getAttribute('data-src');
if (audioSrc) {
bgAudio.src = audioSrc;
bgAudio.play().catch(e => console.error("Error playing audio:", e));
} else {
bgAudio.pause();
bgAudio.src = "";
}
soundDropdown.classList.remove('visible');
}
});

document.querySelector('#mental-health-view [data-pattern="grounding"]').classList.add('active-pattern');
if(quoteContainer) quoteContainer.style.opacity = '1';
}

// --- VEDA VERSE LOGIC ---
function initializeVedaVerseView() {
const vedaVerseView = document.getElementById('veda-verse-view');
if (!vedaVerseView) return;

const openModalButton = document.getElementById('veda-open-modal-button');
const closeModalButton = document.getElementById('veda-close-modal-button');
const revealButton = document.getElementById('veda-reveal-button');
const modal = document.getElementById('veda-selection-modal');
const modalBackdrop = document.getElementById('veda-modal-backdrop');
const modalContentBox = document.getElementById('veda-modal-content-box');
const introView = document.getElementById('veda-intro-view');
const resultView = document.getElementById('veda-result-view');
const categoryDropdown = document.getElementById('veda-category');
const scriptureDropdown = document.getElementById('veda-scripture');

let lastShownWisdom = null;

const scriptureData = {
'Bhagavad Gita': {
'Verses & Hymns': [
{ title: 'The Eternal Self', source: 'Bhagavad Gita 2.20', content: 'न जायते म्रियते वा कदाचिन् | नायं भूत्वा भविता वा न भूयः ||\nअजो नित्यः शाश्वतोऽयं पुराणो | न हन्यते हन्यमाने शरीरे ||', translation: 'The soul is never born nor dies; nor does it exist on coming into being. It is unborn, eternal, permanent, and primeval. The soul is not slain when the body is slain.' },
{ title: 'The Calm Sage', source: 'Bhagavad Gita 2.56', content: 'दुःखेष्वनुद्विग्नमनाः सुखेषु विगतस्पृहः |\nवीतरागभयक्रोधः स्थितधीर्मुनिरुच्यते ||', translation: 'One who is not disturbed in mind even amidst the threefold miseries or elated when there is happiness, and who is free from attachment, fear and anger, is called a sage of steady mind.' },
{ title: 'The Nature of Work', source: 'Bhagavad Gita 3.5', content: 'न हि कश्चित्क्षणमपि जातु तिष्ठत्यकर्मकृत् | कार्यते ह्यवशः कर्म सर्वः प्रकृतिजैर्गुणैः ||', translation: 'No one can remain without action even for a moment. Indeed, all are compelled to act by the qualities of material nature.' },
{ title: 'Surrender Unto Me', source: 'Bhagavad Gita 18.66', content: 'सर्वधर्मान्परित्यज्य मामेकं शरणं व्रज | अहं त्वा सर्वपापेभ्यो मोक्षयिष्यामि मा शुचः ||', translation: 'Abandon all varieties of religion and just surrender unto Me. I shall deliver you from all sinful reactions. Do not fear.' },
{ title: 'The Yogi\'s Gaze', source: 'Bhagavad Gita 6.29', content: 'सर्वभूतस्थमात्मानं सर्वभूतानि चात्मनि | ईक्षते योगयुक्तात्मा सर्वत्र समदर्शनः ||', translation: 'A true yogi observes Me in all beings and also sees every being in Me. Indeed, the self-realized person sees Me, the same Supreme Lord, everywhere.' },
{ title: 'The Divine Form', source: 'Bhagavad Gita 11.12', content: 'दिवि सूर्यसहस्रस्य भवेद्युगपदुत्थिता | यदि भाः सदृशी सा स्याद्भासस्तस्य महात्मनः ||', translation: 'If a thousand suns were to rise in the sky at once, their radiance might resemble the effulgence of the Supreme Person in that universal form.' }
],
'Concepts & Philosophy': [
{ title: 'The Concept of Dharma', source: 'Bhagavad Gita 18.47', content: 'श्रेयान्स्वधर्मो विगुण: परधर्मात्स्वनुष्ठितात् | स्वभावनियतं कर्म कुर्वन्नाप्नोति किल्बिषम् ||', translation: 'It is better to engage in one\'s own occupation, even though one may perform it imperfectly, than to accept another\'s occupation and perform it perfectly. Duties prescribed according to one\'s nature are never affected by sinful reactions.' },
{ title: 'The Three Gunas', source: 'Bhagavad Gita 14.5', content: 'सत्त्वं रजस्तम इति गुणाः प्रकृतिसंभवाः | निबध्नन्ति महाबाहो देहे देहिनमव्ययम् ||', translation: 'Sattva, Rajas, and Tamas—these three gunas (qualities) born of material nature bind the eternal soul to the body, O mighty-armed Arjuna.' },
{ title: 'The Illusion of Maya', source: 'Bhagavad Gita 7.14', content: 'दैवी ह्येषा गुणमयी मम माया दुरत्यया | मामेव ये प्रपद्यन्ते मायामेतां तरन्ति ते ||', translation: 'This divine energy of Mine, consisting of the three modes of material nature, is difficult to overcome. But those who have surrendered unto Me can easily cross beyond it.' },
{ title: 'The Field and its Knower', source: 'Bhagavad Gita 13.3', content: 'क्षेत्रज्ञं चापि मां विद्धि सर्वक्षेत्रेषु भारत | क्षेत्रक्षेत्रज्ञयोर्ज्ञानं यत्तज्ज्ञानं मतं मम ||', translation: 'O scion of Bharata, you should understand that I am also the knower in all bodies, and to understand this body and its knower is called knowledge. That is My opinion.' }
],
'Practical Guidance': [
{ title: 'Action Without Attachment', source: 'Bhagavad Gita 2.47', content: 'कर्मण्येवाधिकारस्ते मा फलेषु कदाचन | मा कर्मफलहेतुर्भूर्मा ते सङ्गोऽस्त्वकर्मणि ||', translation: 'You have a right to perform your prescribed duty, but you are not entitled to the fruits of action. Never consider yourself the cause of the results of your activities, and never be attached to not doing your duty.' },
{ title: 'The Path of Devotion', source: 'Bhagavad Gita 9.26', content: 'पत्रं पुष्पं फलं तोयं यो मे भक्त्या प्रयच्छति | तदहं भक्त्युपहृतमश्नामि प्रयतात्मनः ||', translation: 'If one offers Me with love and devotion a leaf, a flower, a fruit or water, I will accept it.' },
{ title: 'Equanimity of Mind', source: 'Bhagavad Gita 2.48', content: 'योगस्थः कुरु कर्माणि सङ्गं त्यक्त्वा धनञ्जय | सिद्ध्यसिद्ध्योः समो भूत्वा समत्वं योग उच्यते ||', translation: 'Perform your duty equipoised, O Arjuna, abandoning all attachment to success or failure. Such equanimity is called yoga.' },
{ title: 'Conquering the Mind', source: 'Bhagavad Gita 6.34', content: 'चञ्चलं हि मनः कृष्ण प्रमाथि बलवद्दृढम् | तस्याहं निग्रहं मन्ये वायोरिव सुदुष्करम् ||', translation: 'The mind is restless, turbulent, obstinate and very strong, O Krishna, and to subdue it, I think, is more difficult than controlling the wind.' },
{ title: 'The Offering of Actions', source: 'Bhagavad Gita 9.27', content: 'यत्करोषि यदश्नासि यज्जुहोषि ददासि यत् | यत्तपस्यसि कौन्तेय तत्कुरुष्व मदर्पणम् ||', translation: 'Whatever you do, whatever you eat, whatever you offer or give away, and whatever austerities you perform—do that, O son of Kunti, as an offering to Me.' }
],
'Ethics & Morality': [
{ title: 'Qualities of the Divine', source: 'Bhagavad Gita 16.1-3', content: 'The Supreme Personality of Godhead said: Fearlessness; purification of one\'s existence; cultivation of spiritual knowledge; charity; self-control; performance of sacrifice; study of the Vedas; austerity; simplicity; nonviolence; truthfulness; freedom from anger...', translation: 'These are the transcendental qualities, born of the godly nature, O son of Bharata.' },
{ title: 'The Six Enemies', source: 'Bhagavad Gita 16.21', content: 'त्रिविधं नरकस्येदं द्वारं नाशनमात्मनः | कामः क्रोधस्तथा लोभस्तस्मादेतत्त्रयं त्यजेत् ||', translation: 'There are three gates leading to this hell—lust, anger, and greed. Every sane man should give these up, for they lead to the degradation of the soul.' }
]
},
'Upanishads': {
'Concepts & Philosophy': [
{ title: 'The Supreme Reality (Brahman)', source: 'Isha Upanishad, Verse 1', content: 'ईशा वास्यमिदं सर्वं यत्किञ्च जगत्यां जगत् । तेन त्यक्तेन भुञ्जीथा मा गृधः कस्यस्विद्धनम् ॥', translation: 'All this, whatever moves in this universe, including the universe itself, is pervaded by the Lord. By renouncing it, enjoy it. Do not covet anybody\'s wealth.' },
{ title: 'Atman is Brahman (Aham Brahmasmi)', source: 'Brihadaranyaka Upanishad 1.4.10', content: 'अहं ब्रह्मास्मि', translation: 'I am Brahman. This great sentence (Mahavakya) signifies that the individual Self (Atman) is identical with the ultimate reality (Brahman).' },
{ title: 'You Are That (Tat Tvam Asi)', source: 'Chandogya Upanishad 6.8.7', content: 'तत्त्वमसि', translation: 'You are That. This is one of the four great sayings, asserting the oneness of the individual soul with the Supreme Being.' },
{ title: 'The Nature of Self', source: 'Katha Upanishad 1.2.20', content: 'अणोरणीयान्महतो महीयानात्मास्य जन्तोर्निहितो गुहायाम् ।', translation: 'Smaller than the smallest, greater than the greatest, the Self is hidden in the heart of every creature.' },
{ title: 'The Two Birds', source: 'Mundaka Upanishad 3.1.1', content: 'Two birds, inseparable friends, cling to the same tree. One of them eats the sweet fruit, the other looks on without eating.', translation: 'This is a metaphor for the individual soul (Jiva), which partakes in worldly experiences, and the Supreme Soul (Atman/Brahman), which remains a detached witness.' },
{ title: 'The Five Sheaths (Pancha Kosha)', source: 'Taittiriya Upanishad', content: 'The Upanishad describes the human being as having five layers or sheaths (koshas) covering the Atman: the physical body (Annamaya), the vital energy (Pranamaya), the mind (Manomaya), the intellect (Vijnanamaya), and the bliss sheath (Anandamaya).', translation: 'Spiritual practice involves transcending these layers to realize the true Self within.' }
],
'Verses & Hymns': [
{ title: 'Lead Us From Darkness to Light', source: 'Bṛhadāraṇyaka Upaniṣad 1.3.28', content: 'असतो मा सद्गमय । तमसो मा ज्योतिर्गमय । मृत्योर्माऽमृतं गमय ॥', translation: 'From the unreal, lead me to the real. From darkness, lead me to light. From death, lead me to immortality.' },
{ title: 'The Shanti Mantra', source: 'Kena Upanishad', content: 'ॐ सह नाववतु । सह नौ भुनक्तु । सह वीर्यं करवावहै । तेजस्वि नावधीतमस्तु मा विद्विषावहै । ॐ शान्तिः शान्तिः शान्तिः ॥', translation: 'Om! May we be protected together. May we be nourished together. May we work together with great energy. May our studies be effective and brilliant. May we not hate each other. Om! Peace, peace, peace.' },
{ title: 'The Sound of OM', source: 'Mandukya Upanishad', content: 'The syllable OM is the whole world. Its explanation is as follows: The past, the present, the future, everything is but OM. And whatever else there is, beyond the threefold division of time, that also is OM.', translation: 'This Upanishad provides a profound analysis of the sacred syllable OM, equating it with the four states of consciousness: waking, dreaming, deep sleep, and the transcendent state (Turiya).' }
],
'Stories & Epics': [
{ title: 'The Story of Nachiketa', source: 'Katha Upanishad', content: 'A young boy, Nachiketa, is sent to the abode of Yama, the god of death. Unafraid, he asks Yama three boons, the last of which is the secret of what happens after death. Yama tests his resolve by offering him all worldly pleasures instead, but Nachiketa remains firm, seeking only supreme knowledge.', translation: 'This story illustrates the importance of discriminating between the pleasant (preya) and the good (shreya), and the relentless pursuit of spiritual truth.' }
]
},
'Vedas (General)': {
'Verses & Hymns': [
{ title: 'The Gayatri Mantra', source: 'Rigveda 3.62.10', content: 'ॐ भूर्भुवः स्वः । तत्सवितुर्वरेण्यं । भर्गो देवस्य धीमिहि । धियो यो नः प्रचोदयत् ॥', translation: 'Om. We meditate on the adorable glory of the radiant sun (Savitur); may he inspire our intelligence.' },
{ title: 'Hymn of Creation (Nasadiya Sukta)', source: 'Rigveda 10.129', content: 'नासदासीन्नो सदासीत्तदानीं नासीद्रजो नो व्योमा परो यत् ।', translation: 'Then, there was neither non-existence nor existence; there was no realm of air, no sky beyond it.' },
{ title: 'Let Noble Thoughts Come', source: 'Rigveda 1.89.1', content: 'आ नो भद्राः क्रतवो यन्तु विश्वतः', translation: 'Let noble thoughts come to us from all directions.' },
{ title: 'The Truth is One', source: 'Rigveda 1.164.46', content: 'एकं सद्विप्रा बहुधा वदन्ति', translation: 'The truth is one, but the wise speak of it in many ways.' },
{ title: 'Hymn to Agni', source: 'Rigveda 1.1.1', content: 'अग्निमीळे पुरोहितं यज्ञस्य देवमृत्विजम् । होतारं रत्नधातमम् ॥', translation: 'I praise Agni, the chosen Priest, God, minister of sacrifice, the invoker, lavishest of wealth.' },
{ title: 'Hymn to Indra', source: 'Rigveda 2.12', content: 'A powerful hymn dedicated to Indra, the king of the gods and the god of thunder and war. It extols his might, his victory over the dragon Vritra, and his role in releasing the waters and creating order in the cosmos.', translation: 'Symbolizes the victory of cosmic order (Rta) over chaos (Anrta).' }
],
'Concepts & Philosophy': [
{ title: 'Concept of Rta (Cosmic Order)', source: 'Rigveda', content: 'Rta is the principle of natural order which regulates and coordinates the operation of the universe and everything within it. It is the cosmic law that governs everything from the movement of the stars to the moral actions of humans.', translation: 'Living in accordance with Rta means living a life of truth, righteousness, and harmony.' },
{ title: 'The Purusha Sukta (Hymn of the Cosmic Being)', source: 'Rigveda 10.90', content: 'This hymn describes the spiritual unity of the universe. It presents the cosmic being, Purusha, as both the immanent life-force of all creation and the transcendent reality beyond it. The hymn famously describes the four varnas emerging from the different parts of the Purusha.', translation: 'A foundational text for understanding the interconnectedness of all existence and the divine source of creation.' }
]
},
'Ramayana': {
'Stories & Epics': [
{ title: 'The Abduction of Sita', source: 'Ramayana, Aranya Kanda', content: 'The story of Sita\'s abduction by the demon king Ravana is a pivotal moment in the Ramayana. Lured away by the golden deer Maricha, Rama leaves Sita under Lakshmana\'s protection. Ravana, disguised as a sage, tricks Sita into crossing the protective line (Lakshmana Rekha) and carries her away to his kingdom of Lanka, setting the stage for the epic war.', translation: 'This event highlights the themes of dharma, deception, and the consequences of straying from the path of righteousness.' },
{ title: 'The Loyalty of Hanuman', source: 'Ramayana, Sundara Kanda', content: 'Hanuman\'s journey to Lanka is a testament to unwavering devotion and courage. He leaps across the ocean, finds Sita, delivers Rama\'s message, and sets fire to Lanka. His actions are a pure expression of selfless service (seva) and faith.', translation: 'Hanuman is the embodiment of the perfect devotee (bhakta).' },
{ title: 'The Devotion of Shabari', source: 'Ramayana, Aranya Kanda', content: 'Shabari, an elderly ascetic woman of a tribal community, waits her entire life with unwavering faith for the arrival of Rama. When he finally comes to her hermitage, she is overjoyed and offers him berries that she has first tasted herself to ensure they are sweet. Rama accepts her offering with love, demonstrating that pure devotion transcends all social barriers.', translation: 'A powerful story about the purity of faith (bhakti) and divine grace.' },
{ title: 'The Sacrifice of Jatayu', source: 'Ramayana, Aranya Kanda', content: 'Jatayu, the great eagle king, witnesses Ravana abducting Sita. Despite his old age, he courageously fights Ravana to save her. He is mortally wounded in the battle but manages to live long enough to inform Rama about Sita\'s abduction before dying in his arms. Rama performs his final rites as if for his own father.', translation: 'Jatayu\'s selfless bravery and sacrifice for the sake of dharma is a moving example of righteousness and courage.' }
],
'Ethics & Morality': [
{ title: 'The Ideal King: Rama Rajya', source: 'Ramayana, Uttara Kanda', content: 'Rama\'s reign, known as Rama Rajya, is considered the epitome of a perfect and just rule. In his kingdom, everyone was happy, healthy, and satisfied. There was no poverty, no crime, and everyone followed their dharma. It represents the ideal state of governance, where the ruler prioritizes the welfare of his subjects above all else.', translation: 'A model for ethical leadership and societal harmony.' },
{ title: 'The Value of a Promise', source: 'Ramayana, Ayodhya Kanda', content: "King Dasharatha's promise to his wife Kaikeyi forces him to send his beloved son Rama into exile for fourteen years. This illustrates the supreme importance of keeping one's word (vachan) in the dharma of a king, even at immense personal cost.", translation: "It highlights that upholding a promise is a fundamental principle of righteousness (dharma)." },
{ title: 'The Dilemma of Vibhishana', source: 'Ramayana, Yuddha Kanda', content: "Vibhishana, Ravana's brother, faces a moral crisis. He repeatedly advises Ravana to return Sita and follow the path of dharma. When Ravana refuses, Vibhishana makes the difficult choice to abandon his brother and join Rama's side, choosing righteousness over family loyalty.", translation: "This act teaches that allegiance to Dharma is higher than any worldly attachment." }
]
},
'Mahabharata': {
'Stories & Epics': [
{ title: 'The Game of Dice', source: 'Mahabharata, Sabha Parva', content: 'Yudhishthira, the eldest Pandava, is challenged to a game of dice by his cousin Duryodhana and his manipulative uncle Shakuni. Due to his adherence to kshatriya dharma, Yudhishthira cannot refuse the challenge. He ends up gambling away his kingdom, his brothers, himself, and even their wife Draupadi, leading to her public humiliation and sowing the seeds for the great war.', translation: 'A cautionary tale about the dangers of addiction, pride, and the misinterpretation of one\'s duty.' },
{ title: 'The Vow of Bhishma', source: 'Mahabharata, Adi Parva', content: 'To enable his father, King Shantanu, to marry Satyavati, Prince Devavrata takes a terrible vow of lifelong celibacy and renounces his claim to the throne. This vow earns him the name Bhishma ("The Terrible"). His selfless sacrifice sets in motion a chain of events that profoundly impacts the fate of the Kuru dynasty.', translation: 'An extreme example of filial piety and sacrifice, which also shows how a rigid adherence to a vow can have unforeseen, tragic consequences.' },
{ title: 'The Story of Ekalavya', source: 'Mahabharata, Adi Parva', content: 'Ekalavya, a young tribal prince, desires to learn archery from Dronacharya but is rejected due to his caste. Undeterred, he creates a statue of Drona and practices before it, becoming a master archer. When Drona learns of his skill, he demands Ekalavya\'s right thumb as his guru dakshina (teacher\'s fee) to protect his promise to Arjuna. Ekalavya unhesitatingly cuts it off.', translation: 'A tragic story that explores themes of dedication, social injustice, and the complexities of dharma.' }
],
'Ethics & Morality': [
{ title: 'Vidura Niti', source: 'Mahabharata, Udyoga Parva', content: 'Vidura, the wise prime minister of Hastinapura, offers profound advice to his brother, King Dhritarashtra, before the Kurukshetra War. His teachings, known as Vidura Niti, are a collection of wise sayings on ethics, governance, and righteous conduct.', translation: 'Vidura Niti is a timeless guide to statesmanship and personal morality.' },
{ title: 'Yudhishthira\'s Final Test', source: 'Mahabharata, Svargarohana Parva', content: 'At the end of his journey, Yudhishthira reaches the gates of heaven, accompanied only by a loyal dog. Indra tells him he can enter, but the dog must be left behind. Yudhishthira refuses to abandon the faithful animal, stating that such an act would be a great sin. The dog then reveals itself to be the god Dharma, who was testing his son\'s righteousness one last time.', translation: 'This story teaches that true dharma involves compassion for all beings, no matter how humble.' }
]
},
'Puranas (General)': {
'Stories & Epics': [
{ title: 'The Churning of the Ocean (Samudra Manthan)', source: 'Bhagavata Purana, Vishnu Purana', content: 'To obtain the nectar of immortality (amrita), the Devas (gods) and Asuras (demons) churn the cosmic ocean of milk. Lord Vishnu, in his Kurma (tortoise) avatar, supports the churning mountain on his back. Many treasures emerge, including the goddess Lakshmi, but also a deadly poison (halahala), which Lord Shiva drinks to save the world.', translation: 'A grand cosmic tale about the struggle between good and evil, and the divine interventions required to maintain cosmic balance.' },
{ title: 'The Devotion of Prahlada', source: 'Bhagavata Purana', content: 'Prahlada, a young boy, is born to the demon king Hiranyakashipu, who has a boon making him nearly invincible. Despite his father\'s cruel punishments and threats, Prahlada maintains his unwavering devotion to Lord Vishnu. To protect his devotee, Vishnu appears in his man-lion avatar, Narasimha, and slays the demon king.', translation: 'The ultimate story of faith and devotion, showing that God will always protect those who surrender to Him.' },
{ title: 'The Story of Dhruva', source: 'Vishnu Purana', content: 'Feeling insulted by his stepmother, the five-year-old prince Dhruva leaves the palace to find the Lord. Following the advice of the sage Narada, he performs intense austerities. Pleased by his determination, Lord Vishnu appears before him and grants him a permanent, celestial abode as the Pole Star (Dhruva Nakshatra).', translation: 'Illustrates that with firm determination and pure desire, even a child can attain the highest spiritual goal.' }
],
'Devotion & Rituals': [
{ title: 'The Nine Forms of Bhakti', source: 'Bhagavata Purana 7.5.23', content: 'Prahlada Maharaja explains the nine processes of devotional service: (1) Shravanam (hearing), (2) Kirtanam (chanting), (3) Smaranam (remembering), (4) Pada-sevanam (serving the Lord\'s feet), (5) Archanam (worshiping), (6) Vandanam (offering prayers), (7) Dasyam (servitude), (8) Sakhyam (friendship), and (9) Atma-nivedanam (complete surrender).', translation: 'A practical framework for engaging in devotional service and cultivating love for the divine.' }
]
},
'Yoga Sutras of Patanjali': {
'Practical Guidance': [
{ title: 'The Definition of Yoga', source: 'Yoga Sutras 1.2', content: 'योगश्चित्तवृत्तिनिरोधः', translation: 'Yoga is the stilling of the changing states of the mind.' },
{ title: 'The Eight Limbs of Yoga (Ashtanga)', source: 'Yoga Sutras 2.29', content: 'The eight limbs are: Yama (abstinences), Niyama (observances), Asana (postures), Pranayama (breath control), Pratyahara (withdrawal of senses), Dharana (concentration), Dhyana (meditation), and Samadhi (absorption).', translation: 'A complete framework for spiritual practice that purifies the body and mind, leading to liberation.' },
{ title: 'Practice and Non-Attachment', source: 'Yoga Sutras 1.12', content: 'अभ्यासवैराग्याभ्यां तन्निरोधः', translation: 'The stilling of the mind\'s fluctuations is achieved through practice (abhyasa) and non-attachment (vairagya).' }
],
'Concepts & Philosophy': [
{ title: 'The Cause of Suffering (Kleshas)', source: 'Yoga Sutras 2.3', content: 'The five causes of suffering (kleshas) are: Avidya (ignorance), Asmita (egoism), Raga (attachment), Dvesha (aversion), and Abhinivesha (clinging to life/fear of death).', translation: 'Understanding these root causes is the first step toward overcoming them through yogic practice.' }
]
}
};

function updateScriptureOptions() {
const category = categoryDropdown.value;
const currentScriptureValue = scriptureDropdown.value;
scriptureDropdown.innerHTML = '';
const anyOption = document.createElement('option');
anyOption.textContent = 'Any';
scriptureDropdown.appendChild(anyOption);
for (const scriptureName in scriptureData) {
if (scriptureData[scriptureName].hasOwnProperty(category)) {
const option = document.createElement('option');
option.textContent = scriptureName;
scriptureDropdown.appendChild(option);
}
}
if (Array.from(scriptureDropdown.options).some(opt => opt.value === currentScriptureValue)) {
scriptureDropdown.value = currentScriptureValue;
}
}

function openModal() {
modal.classList.remove('hidden');
document.body.style.overflow = 'hidden';
setTimeout(() => {
modalBackdrop.classList.remove('opacity-0');
modalContentBox.classList.remove('opacity-0', 'scale-95');
}, 10);
}

function closeModal() {
modalBackdrop.classList.add('opacity-0');
modalContentBox.classList.add('opacity-0', 'scale-95');
setTimeout(() => {
modal.classList.add('hidden');
document.body.style.overflow = 'auto';
}, 300);
}

function fetchWisdom(category, scripture) {
let potentialContent = [];
if (scripture === 'Any') {
const availableScriptures = Object.keys(scriptureData).filter(s => scriptureData[s][category] && scriptureData[s][category].length > 0);
availableScriptures.forEach(s => {
potentialContent.push(...scriptureData[s][category]);
});
} else {
if (scriptureData[scripture] && scriptureData[scripture][category]) {
potentialContent = scriptureData[scripture][category];
}
}

if (potentialContent.length === 0) {
for (const script in scriptureData) {
for (const cat in scriptureData[script]) {
potentialContent.push(...scriptureData[script][cat]);
}
}
if (potentialContent.length === 0) return null;
}

let finalSelectionPool = potentialContent;
if (potentialContent.length > 1 && lastShownWisdom) {
const filteredPool = potentialContent.filter(item => item.title !== lastShownWisdom.title);
if (filteredPool.length > 0) {
finalSelectionPool = filteredPool;
}
}

const result = finalSelectionPool[Math.floor(Math.random() * finalSelectionPool.length)];
lastShownWisdom = result;
return result;
}

function displayWisdom(data) {
if (!data) {
resultView.innerHTML = `
<div class="veda-fade-in bg-black/20 backdrop-blur-sm border border-orange-400/20 rounded-xl p-8 md:p-12 text-center max-w-3xl mx-auto">
<h2 class="text-3xl font-serif text-orange-200 mb-6">No Wisdom Found</h2>
<p class="text-lg text-orange-200/80 mb-8">Apologies, we could not find an entry for this specific selection. Please try another combination.</p>
<button id="veda-reset-button" class="mt-8 inline-flex items-center text-orange-300/80 hover:text-orange-200 border border-orange-400/30 hover:bg-orange-400/10 px-6 py-2 rounded-lg transition-colors duration-300">
<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
<path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"></path>
</svg>
Seek Anew
</button>
</div>`;
} else {
resultView.innerHTML = `
<div class="veda-fade-in bg-black/20 backdrop-blur-sm border border-orange-400/20 rounded-xl p-8 md:p-12 text-center max-w-3xl mx-auto">
<p class="text-sm uppercase tracking-widest text-orange-400 mb-4">${data.source}</p>
<h2 class="text-4xl md:text-5xl font-serif text-orange-200 mb-6">${data.title}</h2>
${data.content.includes('\n') ?
`<pre class="whitespace-pre-wrap text-xl md:text-2xl text-white font-sans leading-relaxed mb-6">${data.content}</pre>` :
`<p class="text-lg md:text-xl text-white leading-relaxed mb-6">${data.content}</p>`
}
<div class="w-20 h-px bg-orange-400/30 mx-auto my-8"></div>
<p class="text-md md:text-lg text-orange-200/80 italic leading-relaxed">${data.translation}</p>
<button id="veda-reset-button" class="mt-12 inline-flex items-center text-orange-300/80 hover:text-orange-200 border border-orange-400/30 hover:bg-orange-400/10 px-6 py-2 rounded-lg transition-colors duration-300">
<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
<path stroke-linecap="round" stroke-linejoin="round" d="M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"></path>
</svg>
Seek Anew
</button>
</div>
`;
}

document.getElementById('veda-reset-button').addEventListener('click', () => {
resultView.classList.add('veda-fade-out');
setTimeout(() => {
resultView.innerHTML = '';
resultView.classList.add('hidden');
resultView.classList.remove('veda-fade-out');
introView.classList.remove('hidden', 'veda-fade-out');
introView.classList.add('veda-fade-in');
}, 500);
});
}

function handleReveal() {
const category = categoryDropdown.value;
const scripture = scriptureDropdown.value;
const wisdom = fetchWisdom(category, scripture);
closeModal();
introView.classList.add('veda-fade-out');
setTimeout(() => {
introView.classList.add('hidden');
resultView.classList.remove('hidden');
displayWisdom(wisdom);
}, 500);
}

categoryDropdown.addEventListener('change', updateScriptureOptions);
openModalButton.addEventListener('click', openModal);
closeModalButton.addEventListener('click', closeModal);
modalBackdrop.addEventListener('click', closeModal);
revealButton.addEventListener('click', handleReveal);

updateScriptureOptions();
}

initializeVedaVerseView();

}

// Customer Support Chatbot Functionality
function initializeChatbot() {
    // Create chatbot modal HTML
    const chatbotModal = document.createElement('div');
    chatbotModal.id = 'chatbot-modal';
    chatbotModal.className = 'chatbot-modal';
    chatbotModal.innerHTML = `
        <div class="chatbot-container">
            <div class="chatbot-header">
                <div class="flex items-center space-x-2">
                    <img src="https://i.postimg.cc/wMQcxk3t/Gemini-Generated-Image-s9kmj9s9kmj9s9km.png" alt="Maya Avatar" class="w-10 h-10 rounded-full">
                    <h3 class="text-lg font-semibold">Devotial Customer Support</h3>
                </div>
                <button id="chatbot-close-btn" class="chatbot-close-btn">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="chatbot-chat-container" class="chatbot-chat-container">
                <!-- Messages will be added here -->
            </div>
            <div class="chatbot-input-container">
                <input type="text" id="chatbot-input" class="chatbot-input" placeholder="Type your message...">
                <button id="chatbot-send-btn" class="chatbot-send-btn">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"></path>
                    </svg>
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(chatbotModal);

    // Get elements
    const modal = document.getElementById('chatbot-modal');
    const chatContainer = document.getElementById('chatbot-chat-container');
    const input = document.getElementById('chatbot-input');
    const sendBtn = document.getElementById('chatbot-send-btn');
    const closeBtn = document.getElementById('chatbot-close-btn');
    const customerServiceBtn = document.getElementById('customer-service-btn');

    // Open chatbot
    function openChatbot() {
        modal.classList.add('is-open');
        input.focus();
        // Add initial message if chat is empty
        if (chatContainer.children.length === 0) {
            addChatMessage("Hello Dear Devotial User, my name is Maya, and I'm a Customer Care Executive at Devotial. How can I help you with your query or problem today?", false);
        }
    }

    // Close chatbot
    function closeChatbot() {
        modal.classList.remove('is-open');
    }

    // Add message to chat
    function addChatMessage(text, isUser) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'} items-end mb-3`;
        
        if (!isUser) {
            const avatar = document.createElement('img');
            avatar.src = "https://i.postimg.cc/wMQcxk3t/Gemini-Generated-Image-s9kmj9s9kmj9s9km.png";
            avatar.alt = "Maya Avatar";
            avatar.className = "w-8 h-8 rounded-full mr-2 self-end";
            messageDiv.appendChild(avatar);
        }

        const messageContent = document.createElement('div');
        messageContent.className = `chatbot-message ${isUser ? 'chatbot-user-message' : 'chatbot-bot-message'}`;
        messageContent.textContent = text;
        messageDiv.appendChild(messageContent);
        
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Send message function
    async function sendChatMessage() {
        const messageText = input.value.trim();
        if (!messageText) return;

        // Add user message
        addChatMessage(messageText, true);
        input.value = '';

        // Add typing indicator
        const typingDiv = document.createElement('div');
        typingDiv.className = 'flex justify-start items-end mb-3';
        typingDiv.id = 'typing-indicator';
        
        const avatar = document.createElement('img');
        avatar.src = "https://i.postimg.cc/wMQcxk3t/Gemini-Generated-Image-s9kmj9s9kmj9s9km.png";
        avatar.alt = "Maya Avatar";
        avatar.className = "w-8 h-8 rounded-full mr-2";
        typingDiv.appendChild(avatar);

        const typingBubble = document.createElement('div');
        typingBubble.className = 'chatbot-typing-indicator';
        typingBubble.textContent = 'Maya is typing...';
        typingDiv.appendChild(typingBubble);

        chatContainer.appendChild(typingDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;

        // Wait 5 seconds before API call
        await new Promise(resolve => setTimeout(resolve, 5000));

        const apiKey = "AIzaSyCdZyk2eh5fFejI1IMtKVssBUDwa-eJaJY"; // CHANGE API KEY
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        const payload = {
            contents: [{ parts: [{ text: messageText }] }],
            systemInstruction: {
                parts: [{ text: `
                You are Maya, a friendly and helpful Customer Care Executive at Devotial. Your goal is to assist users with their queries and provide accurate information about our services.

                When a user asks for a tutorial, you must first identify the primary feature they are asking about. Use the exact feature names for reference: 'Meditation', 'Nam Japa', 'Daily Karmic Score', 'Demotian Guruji', 'Veda Verse', 'Digital Mandir', 'Dashboard', or 'Company/Founder'. Provide a brief, concise, and simplified explanation of that feature. Then, ask if they would like the full, elaborate, step-by-step tutorial.

                If the user's next response is a confirmation (e.g., "yes," "tell me more," "full tutorial"), you must then provide the full tutorial for the feature you previously offered.

                If a user reports a fault, error, or wrong content, you must respond with the exact text: 'We are really sorry for that, We have done mistake as we are in still trial yet, please feel free to let the team know, go to navigation, about us, click the contact us button and then fill the form'. Do not say anything else in this response.

                You are strictly prohibited from answering questions that are not related to Devotial's application, the company, or the founder team. Do not use any markdown formatting, such as bolding, italics, or headings, in your responses.

                For all out-of-context questions, you must respond with a short phrase related to Devotial, followed by the exact text: 'It seems you are looking for something that would be better answered by your respective religions/Spiritual guru in the Tools section. Please Visit Tools - Spiritual Guru Gen AI - Start chat'. For example, 'That is a good question, but I can only answer questions about Devotial. It seems you are looking for something that would be better answered by your respective religions/Spiritual guru in the Tools section. Please Visit Tools - Spiritual Guru Gen AI - Start chat'.

                If the user says their issue is resolved or thanks you, respond with the exact phrase: 'thanks for reaching Customer Support Team Devotial, I hope i was able to solve the query.'. Do not say anything else in that response.

                When providing a tutorial or a list of instructions, you must format the response as a numbered list with each item beginning with 'Step [number]: '.
                ` }]
            },
            tools: [{ "google_search": {} }]
        };

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();
            
            // Remove typing indicator
            chatContainer.removeChild(typingDiv);
            
            const botResponse = result?.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't process your request. Please try again.";
            addChatMessage(botResponse, false);

        } catch (error) {
            console.error('Error:', error);
            chatContainer.removeChild(typingDiv);
            addChatMessage("Sorry, I'm having trouble connecting right now. Please try again later.", false);
        }
    }

    // Event listeners
    customerServiceBtn.addEventListener('click', (e) => {
        e.preventDefault();
        openChatbot();
    });

    closeBtn.addEventListener('click', closeChatbot);
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeChatbot();
    });

    sendBtn.addEventListener('click', sendChatMessage);
    
    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendChatMessage();
    });
}

// Initialize chatbot when DOM is loaded
document.addEventListener('DOMContentLoaded', initializeChatbot);

</script>
</body>
</html>









































